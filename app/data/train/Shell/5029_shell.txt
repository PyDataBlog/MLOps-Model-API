#!/usr/bin/env bash
set -eou pipefail

# Update etc
go() {

	saferun sudo port -v selfupdate &&
	saferun sudo port -Rv upgrade outdated &&
    saferun sudo port -v rev-upgrade

}

# Sanity checks
sanity() {
    # Ensure the user is running this script on OS X
    if [ $(uname -s) != "Darwin" ]; then
	echo "This script is for use with OS X!"
	exit 1
    fi
}

# Safe run function to ensure commands are executed successfully
saferun() {
    typeset cmnd="$*"
    typeset ret_code

    eval  $cmnd
    ret_code=$?
    
    if [ $ret_code != 0 ]; then
	echo -e "It looks like there was an issue running: $*\n\nExiting..."
	exit $?
    fi
}

main() {
	sanity
	go
}

# Actual run
main $@