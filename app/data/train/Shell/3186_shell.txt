#!/bin/bash

fq1=$1
fq2=$2
ref=$3
gtf=$4

star --runThreadN 8 --genomeDir $ref --genomeLoad NoSharedMemory --readFilesIn $fq1 $fq2 --outFileNamePrefix tmp --outSAMtype BAM Unsorted --outSAMstrandField intronMotif --outSAMattributes NH   HI   NM   MD   AS   XS --outSAMunmapped Within --outFilterMultimapNmax 10 --sjdbOverhang 20
samtools sort -n -T srttmp -o tmp.ns.bam tmpAligned.out.bam
samtools view -F 4 tmp.ns.bam | htseq-count -m intersection-nonempty --stranded=no --samout output.sam --idattr=gene_id - annot.gtf >count
