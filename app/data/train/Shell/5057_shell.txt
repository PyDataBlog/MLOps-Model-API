#!/usr/bin/env bash

RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# symbol link to home
function _stoh() {
  if [ -L $2 ] ; then
    if [ $(readlink -f $2) == $1 ]; then
      echo -e "$2 ${GREEN}already exists${NC}"
      return 1
    else
      _backup $2
    fi
  fi

  if [ -e $2 ] ; then
    _backup $2
  fi

  ln -s $1 $2
  echo -e "link $1 -> $2 ${GREEN}ok${NC}"
}

function _backup() {
  if [[ ! -d $HOME/dotfiles/.backup ]]; then
    mkdir -p $HOME/dotfiles/.backup
  fi

  newpath=$HOME/dotfiles/.backup/$(basename $1)-$(date +%s)
  echo "backup $1 to ${newpath}"
  mv $1 ${newpath}
}

# bootstrap config files
function bootstrap() {
  _stoh "$HOME/dotfiles/.Xresources"       "$HOME/.Xresources"
  _stoh "$HOME/dotfiles/.bash_login"       "$HOME/.bash_login"
  _stoh "$HOME/dotfiles/.bashrc"           "$HOME/.bashrc"
  _stoh "$HOME/dotfiles/.config/alacritty" "$HOME/.config/alacritty"
  _stoh "$HOME/dotfiles/.config/bspwm"     "$HOME/.config/bspwm"
  _stoh "$HOME/dotfiles/.config/nvim"      "$HOME/.config/nvim"
  _stoh "$HOME/dotfiles/.config/picom"     "$HOME/.config/picom"
  _stoh "$HOME/dotfiles/.config/polybar"   "$HOME/.config/polybar"
  _stoh "$HOME/dotfiles/.config/ranger"    "$HOME/.config/ranger"
  _stoh "$HOME/dotfiles/.config/rofi"      "$HOME/.config/rofi"
  _stoh "$HOME/dotfiles/.config/sxhkd"     "$HOME/.config/sxhkd"
  _stoh "$HOME/dotfiles/.config/xmobar"    "$HOME/.config/xmobar"
  _stoh "$HOME/dotfiles/.config/xmonad"    "$HOME/.config/xmonad"
  _stoh "$HOME/dotfiles/.ctags.d"          "$HOME/.ctags.d"
  _stoh "$HOME/dotfiles/.fehbg"            "$HOME/.fehbg"
  _stoh "$HOME/dotfiles/.vimrc"            "$HOME/.vimrc"
  _stoh "$HOME/dotfiles/.xinitrc"          "$HOME/.xinitrc"
  _stoh "$HOME/dotfiles/.zshrc"            "$HOME/.zshrc"
}

function config_git() {
  git config --global alias.aa add -all
  git config --global alias.br branch
  git config --global alias.ci commit
  git config --global alias.cm 'commit -m'
  git config --global alias.co checkout
  git config --global alias.d 'diff'
  git config --global alias.last 'log -1 HEAD --stat'
  git config --global alias.ll 'log --oneline'
  git config --global alias.rv 'remote -v'
  git config --global alias.sb 'status -sb'
  git config --global alias.se '!git rev-list --all | xargs git grep -F'
  git config --global alias.st status
  git config --global alias.unstage 'reset HEAD --'
  git config --global help.autocorrect 20
  git config --global credential.helper store
  git config --global core.autocrlf false
  git config --global pull.ff only
}

function install_fonts() {
  mkdir -p $XDG_DATA_HOME/fonts
  unzip fonts/JetBrainsMono.zip -d $XDG_DATA_HOME/fonts/JetBrainsMono
  cp fonts/*.ttf $XDG_DATA_HOME/fonts
}

"$@"
