#!/bin/bash
#date: 2016-10-12
#auther: zhenping
#description: 用于与aliyun ftp 服务器同步SQL的增量备份。

sync_date=$(date '+%Y-%m-%d')
inc_path="/backup/incre/"
latest_back_dir=$(ls -lt /backup/incre/ | grep -v -E "total|*.gz$" | awk '{print $NF}' | head -1)
sync_list="/backup/dbsync.list"
sync_log="/backup/dbsync.${sync_date}.log"
pro_num=$(ps -ef | grep "/usr/bin/rsync -auvzP" | grep -v "grep" | wc -l)

if [ $pro_num -ge 1 ];then
    exit 0
fi

/usr/bin/rsync -auvzP  --bwlimit=512 /backup/incre --password-file=/home/rsync.conf  logback@121.42.231.185::v2_incr &> $sync_log
