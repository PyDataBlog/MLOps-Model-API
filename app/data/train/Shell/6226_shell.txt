#!/bin/bash
# Author: Seong Bae
# URL: http://www.drumo.net
#

NGINX_ALL_VHOSTS='/etc/nginx/sites-available'
NGINX_ENABLED_VHOSTS='/etc/nginx/sites-enabled'
WEB_DIR='/var/www'
SED=`which sed`
NGINX=`sudo which nginx`
CURRENT_DIR=`dirname $0`
CURRENT_USER=`whoami`
DRUMO_BASE_DIR='/home/seongbae/drumo'
DRUMO_BASE='drumo-server-7.x-0.1'
WEBUSER=nginx

if [ -z $1 ]; then
        echo "No install name given"
        exit 1
fi

if [ -z $2 ]; then
        echo "No default password given"
        exit 1
fi

INSTALL_NAME=$1
DEFAULT_DB_PASSWORD=$2

# Create user
sudo createuser -U postgres -S -D -R -E $INSTALL_NAME

# Set password for user
sudo -u postgres psql -c "ALTER USER $INSTALL_NAME WITH PASSWORD '$DEFAULT_DB_PASSWORD';"

# Create database
createdb -U postgres $INSTALL_NAME

# Grant privileges
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE $INSTALL_NAME to $INSTALL_NAME;"
