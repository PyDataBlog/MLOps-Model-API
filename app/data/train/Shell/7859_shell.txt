#/bin/bash

# clone github repository and return latest commit on $BRANCH
# TODO Add option to checkup to speciffic commit
# TODO exit 0 on success, 1 on failure
# TODO Add error checking

# TODO Do checking first
# git ls-remote git://github.com/<user>/<project>.git | grep HEAD

REMOTEREPO="https://github.com/jb68/pocbapp.git"
REPO="pocbapp"
BRANCH="dev"
WORKDIR="$(dirname $0)/staging"

if [ -d "$WORKDIR/$REPO" ]; then
  # Another CICD process is ongoing.
  echo "Found $WORKDIR/$REPO directory. Other CI instance running?"
  # exit with non 0 non 1 code
  exit 11
fi

cd $WORKDIR
# TODO add error checking and echo to a log
git clone $REMOTEREPO &> /dev/null
cd $REPO
# TODO add error checking and echo to a log
git checkout $BRANCH &> /dev/null
HEAD=$(git rev-parse --verify HEAD)
echo "HEAD=$HEAD"