// ZServerEar.cpp : implementation file
//

#include "stdafx.h"
#include "ZenServer.h"
#include "ZServerEar.h"
#include "ChildView.h"

#ifdef _DEBUG
#define new DEBUG_NEW
#undef THIS_FILE
static char THIS_FILE[] = __FILE__;
#endif

/////////////////////////////////////////////////////////////////////////////
// ZServerEar

ZServerEar::ZServerEar()
{
	theUsers.Setup(this);
}

ZServerEar::~ZServerEar()
{
}


// Do not edit the following lines, which are needed by ClassWizard.
#if 0
BEGIN_MESSAGE_MAP(ZServerEar, CSocket)
	//{{AFX_MSG_MAP(ZServerEar)
	//}}AFX_MSG_MAP
END_MESSAGE_MAP()
#endif	// 0

/////////////////////////////////////////////////////////////////////////////
// ZServerEar member functions

void ZServerEar::OnAccept(int nErrorCode) 
{
	// TODO: Add your specialized code here and/or call the base class
	Accept(theUsers.InsertUser()->theSocket);
	CString l;
	l = "ZHELLO";
	theUsers.GetHead()->SendMessage(l);
	Refresh();
	CSocket::OnAccept(nErrorCode);
}

void ZServerEar::SendGMessage(CString &msg)
{
theUsers.SendGlobalMessage(msg);
}

void ZServerEar::Render(CPaintDC &dc)
{
theUsers.Render(dc);
}

void ZServerEar::Refresh()
{
	theView->Invalidate();
}