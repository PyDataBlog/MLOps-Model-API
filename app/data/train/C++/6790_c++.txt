#include "scene.h"

#include "vector3.h"

namespace Solar {

Scene::Scene(Camera *SceneCamera) : mCam(SceneCamera) {}

void Scene::AddMesh (Mesh ToAdd) {

    VecMeshes.push_back(ToAdd);

}

// TODO: Reduce parameters for less overhead?
inline void Scene::DrawPixel (Vector3 *Orientation, int x, int y, Color *Address) {

    Dis SmallestDist = -1;
    for(auto m : VecMeshes) {
        for(int i=0; i < m.Size; i++) {

            Dis temp = m.Atoms[i].DistanceToLineSqr(mCam->mPos, *Orientation);
            if (temp < 3000) {
                Dis Dist = (m.Atoms[i] - mCam->mPos).AbsSqr();
                if (SmallestDist == -1 || Dist < SmallestDist) {
                    SmallestDist = Dist;
                    *Address = m.Colors[i];
                }
            }
        }
    }

    if (SmallestDist == -1) {
        Address->r = 0;
        Address->g = 0;
        Address->b = 0;
    }


}

}
