use nova;

-- nova instances insert vm
DELIMITER $
DROP TRIGGER IF EXISTS vm_insert $
CREATE TRIGGER vm_insert
AFTER INSERT ON instances
FOR EACH ROW
BEGIN
  DECLARE result VARCHAR(1024);
  SET result = (SELECT mysendmsg('nova', 'insert', new.id));
END $
DELIMITER ;

-- nova instances delete vm(update deleted > 0)
DELIMITER $
drop TRIGGER IF EXISTS vm_delete $
CREATE TRIGGER vm_delete
BEFORE UPDATE ON instances
FOR EACH ROW
BEGIN
  DECLARE result VARCHAR(1024);
  SET result = (SELECT IF(new.deleted>0, mysendmsg('nova', 'delete', old.id), '-'));
END $
DELIMITER ;
