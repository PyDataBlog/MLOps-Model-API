-- for foreign_keys support (on delete cascade)
--con.execute("PRAGMA foreign_keys = ON") for python


PRAGMA foreign_keys = ON;
--
drop table all_links;
drop table sub_categories;
drop table categories;

create table if not exists categories(
c_id integer primary key AUTOINCREMENT not null
,cat_name text not null
,cat_active boolean default 1
,cat_alias text
);


insert into categories (cat_name, cat_alias) values('Trending on Reddit', 'trending_reddit');
insert into categories (cat_name, cat_alias) values('Standup Comedy', 'standup');
insert into categories (cat_name, cat_alias) values('TED talks', 'ted');
insert into categories (cat_name, cat_alias) values('Music','music');
insert into categories (cat_name, cat_alias) values('YouTube Channels','yt_shows');
insert into categories (cat_name, cat_alias) values('Best Of','bestof');
insert into categories (cat_name, cat_alias) values('Science!','science');
insert into categories (cat_name, cat_alias) values('TheLateNightShow','late');
insert into categories (cat_name, cat_alias) values('Trailers', 'trailers');

create table if not exists sub_categories(
 sub_cat_id integer not null
,cat_id integer
,sub_cat_name text default 'Undefined'
,foreign key(cat_id) references categories(c_id) on delete cascade
,primary key (cat_id, sub_cat_id)
);

alter table sub_categories add yt_urls TEXT;

--final table
drop table all_links;

create table if not exists all_links(
link_id integer primary key AUTOINCREMENT not null
,c_fid integer
,s_fid integer
,link_title text not null
,link_url text not null
,foreign key(c_fid) references categories(c_id) on delete cascade
,foreign key(c_fid,s_fid) references sub_categories(cat_id, sub_cat_id) on delete cascade
);

--Trending on Reddit --Scraped off reddit everytime
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (1,'videos',1);
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (1,'catvideos',2);
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (1,'contagiouslaughter',3);
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (1,'musicvideos',4);


--Standup 2
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (2,'Short Clips',1);
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (2,'Full Gigs',2);
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (2,'Skits',3);

--TED 3
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (3,'Rated 9 or above',1);
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (3,'Rated 8 or above',2);
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (3,'Rated 7 or above',3);
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (3,'Rated 6 or above',4);

--Music 4
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (4,'All time hits',1);
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (4,'Acoustic Covers',2);
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id') values (4,'Cover Songs',3);

--YT shows 5

insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (5,'Vsauce',1,'vsauce');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (5,'ThePianoGuys',2,'ThePianoGuys');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (5,'Soul Pancake',3,'soulpancake');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (5,'The Slo Mo Guys',4,'theslowmoguys');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (5,'In59seconds',5,'In59seconds');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (5,'Jamie Oliver',6,'JamieOliver');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (5,'How to Adult?',7,'learnhowtoadult');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (5,'All India Bakchod',8,'allindiabakchod');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (5,'TheViralFeverVideos',9,'TheViralFeverVideos');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (5,'Devin Super Tramp',10,'devinsupertramp');

--bestof 6
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (6,'AIB Most Popular',1,'allindiabakchod');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (6,'TVF Most Popular',2,'TheViralFeverVideos');

--science 7
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (7,'Veritasium',1,'1veritasium');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (7,'In a Nutshell',2,'Kurzgesagt');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (7,'Sick Science!',3,'SteveSpanglerScience');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (7,'Deep Look',4,'KQEDDeepLook');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (7,'AsapSCIENCE',5,'AsapSCIENCE');


-- TheLateNightShow - 8
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (8,'John Oliver',1,'LastWeekTonight');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (8,'Conan',2,'teamcoco');
insert into sub_categories ('cat_id','sub_cat_name','sub_cat_id','yt_urls') values (8,'Jimmy Fallon',3,'latenight');






--run data import scripts
--standup comedy all time 500
--music videos all time 20

--SELECTS

--list all cat_name and sub_cat_name
select c.c_id, c.cat_name,c.cat_alias,
s.sub_cat_id,s.sub_cat_name
from categories c,sub_categories s
where c.c_id = s.cat_id
order by 1,3;


select c.c_id, c.cat_name,c.cat_alias,
s.sub_cat_id,s.sub_cat_name
from categories c,sub_categories s
where c.c_id = s.cat_id
and c.c_id = 6
order by 1,3;

-- verbose all links table description
select a.c_fid,c.cat_name, a.s_fid, s.sub_cat_name, count(1)
from all_links a, categories c, sub_categories s
where a.link_url is not null
and c.c_id = a.c_fid
and s.sub_cat_id = a.s_fid
and c.c_id = s.cat_id
group by c.cat_name,a.c_fid, a.s_fid, s.sub_cat_name;


--extract data for 'Trending on Reddit'


--sub_cat Top_all_time links

select --count(1)
a.link_title, a.link_url
from all_links a, sub_categories s, categories c
where c.cat_alias = 'music'
and s.sub_cat_name = 'All time hits'
and c.c_id = a.c_fid
and a.s_fid = s.sub_cat_id;


select c.cat_name,
s.sub_cat_name,
a.link_title,
a.link_url
from categories c, sub_categories s, all_links a
where c.cat_alias = 'music'
and s.cat_id = c.c_id
and a.c_fid = c.c_id;
