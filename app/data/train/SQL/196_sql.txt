-- 2015.09.02
--
-- встановлюю значення змінної progid сеансу
--
drop function if exists app.setprog(p_prog varchar);
--
create or replace function app.setprog(p_prog varchar)
  returns int as $$
declare
  l_sid int;
  l_varid int;
  l_connid int;
begin
  select app.getcid() into l_sid;
  select varid into l_varid from staff.sessiondef where vname='progid';
  -- sessionlog.idconn
  delete from staff.sessionvar where sid=l_sid and varid=l_varid;
  insert into staff.sessionvar (sid,varid,vdata) values (l_sid,l_varid,p_prog);
  update staff.sessionlog set prog=p_prog where sid=l_sid and prog is null;
  return 0;
end
$$ language plpgsql;
--
grant execute on function app.setprog(p_prog varchar) to approle;
--

