CREATE TABLE [Audit].[JobLog] (
    [JobLogId]            INT       IDENTITY (1, 1) NOT NULL,
    [JobId]               INT       NOT NULL,
    [ExecutionStartTime]  DATETIME  DEFAULT (getdate()) NOT NULL,
    [CanExecute]          BIT       DEFAULT ((0)) NOT NULL,
    [ExecutionEndTime]    DATETIME  NULL,
    [ElapsedTimeSec]      INT       NULL,
    [MetaCreatedDate]     DATETIME  DEFAULT (getdate()) NOT NULL,
    [MetaCreatedBy]       [sysname] DEFAULT (user_name()) NOT NULL,
    [MetaLastUpdatedDate] DATETIME  DEFAULT (getdate()) NOT NULL,
    [MetaLastUpdatedBy]   [sysname] DEFAULT (user_name()) NOT NULL,
    [ExecutionStatusId]   INT       NULL,
    CONSTRAINT [AuditJobLogPK] PRIMARY KEY CLUSTERED ([JobLogId] ASC),
    CONSTRAINT [JobLogExecutionStatusFK] FOREIGN KEY ([ExecutionStatusId]) REFERENCES [Audit].[ExecutionStatus] ([ExecutionStatusId]),
    CONSTRAINT [JobLogJobFK] FOREIGN KEY ([JobId]) REFERENCES [Audit].[Job] ([JobId])
);


GO
CREATE TRIGGER [Audit].AuditJobLogUpd
ON Audit.JobLog
FOR UPDATE
AS
UPDATE Audit.JobLog
SET MetaLastUpdatedDate = GETDATE(),
	MetaLastUpdatedBy = CURRENT_USER
WHERE JobId IN (SELECT JobId FROM INSERTED)
