
CREATE TABLE project_scenario (
    project_id      NUMBER PRIMARY KEY
  , created         TIMESTAMP NOT NULL
  , updated         TIMESTAMP NOT NULL
  , active_scenario NUMBER    NULL
);

CREATE TABLE scenario (
    id                  NUMBER PRIMARY KEY
  , created             TIMESTAMP          NOT NULL
  , updated             TIMESTAMP          NOT NULL
  , name                VARCHAR2(255 CHAR) NOT NULL
  , description         VARCHAR2(255 CHAR) NOT NULL
  , project_scenario_id NUMBER             NOT NULL
  , CONSTRAINT project_scenario_scenario_fk FOREIGN KEY (project_scenario_id) REFERENCES project_scenario (project_id)
);

ALTER TABLE project_scenario ADD CONSTRAINT project_scenario_active_fk FOREIGN KEY (active_scenario) REFERENCES scenario (id);

CREATE TABLE week_parameters (
    id                  NUMBER PRIMARY KEY
  , created             TIMESTAMP    NOT NULL
  , updated             TIMESTAMP    NOT NULL
  , workload            DECIMAL(9,3) NULL
  , efficiency          DECIMAL(5,4) NULL
  , weekly_capacity     DECIMAL(9,3) NULL
  , defect_rate         DECIMAL(5,4) NULL
  , budget              DECIMAL(5,4) NULL
  , scope               DECIMAL(5,4) NULL
  , defect              DECIMAL(5,4) NULL
  , time_line           DECIMAL(5,4) NULL
  , scope_conservative  DECIMAL(5,4) NULL
  , scope_optimistic    DECIMAL(5,4) NULL
  , budget_conservative DECIMAL(5,4) NULL
  , budget_optimistic   DECIMAL(5,4) NULL
);

CREATE TABLE scenario_week (
    week          DATE   NOT NULL
  , parameters_id NUMBER NOT NULL
  , scenario_id   NUMBER NOT NULL
  , CONSTRAINT week_parameters_scenario_fk FOREIGN KEY (parameters_id) REFERENCES week_parameters (id)
  , CONSTRAINT scenario_week_scenario_fk FOREIGN KEY (scenario_id) REFERENCES scenario(id)
  , CONSTRAINT scenario_week_uk UNIQUE (scenario_id, week)
);

CREATE TABLE logbook (
    id                  NUMBER    PRIMARY KEY
  , created             TIMESTAMP NOT NULL
  , updated             TIMESTAMP NOT NULL
  , week                DATE      NOT NULL
  , assumptions         CLOB      NULL
  , risks               CLOB      NULL
  , actions             CLOB      NULL
  , project_scenario_id NUMBER    NOT NULL
  , parameters_id       NUMBER    NOT NULL
  , CONSTRAINT week_parameters_logbook_fk FOREIGN KEY (parameters_id) REFERENCES week_parameters (id)
  , CONSTRAINT project_scenario_logbook_fk FOREIGN KEY (project_scenario_id) REFERENCES project_scenario (project_id)
  , CONSTRAINT scenario_logbook_uk UNIQUE (project_scenario_id, week)
);
