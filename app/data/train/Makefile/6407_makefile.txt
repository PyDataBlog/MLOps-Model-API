PLTHOME          = /usr/local/plt-4.2.5
PLT_GC_SUFFIX    = cgc

COLLECTS_DIR     = $(CURDIR:/scheme-pg=)
PLTCOLLECTS      = $(COLLECTS_DIR):

DRSCHEME         = $(PLTHOME)/bin/drscheme$(PLT_GC_SUFFIX)
MZSCHEME         = $(PLTHOME)/bin/mzscheme$(PLT_GC_SUFFIX)
SETUP_PLT        = $(PLTHOME)/bin/setup-plt$(PLT_GC_SUFFIX)

.DEFAULT_GOAL = compile

.PHONY: clean
clean:
	/bin/rm -f *~ core
	/bin/rm -rf compiled

.PHONY: compile
compile:
	PLTCOLLECTS='$(PLTCOLLECTS)' $(SETUP_PLT) -D -l scheme-pg

.PHONY: drscheme
drscheme:
	PLTCOLLECTS='$(PLTCOLLECTS)' nohup $(DRSCHEME) > /dev/null 2>&1 &
	sleep 1

.PHONY: gdb
gdb:
	gdb $(MZSCHEME) core

.PHONY: test
test:
	(ulimit -c unlimited ; PLTCOLLECTS='$(PLTCOLLECTS)' $(MZSCHEME) examples.ss)
	 @echo '# psql -d schemepg -c "select * from pers"'

.PHONY: test-lo
test-lo:
	(ulimit -c unlimited ; PLTCOLLECTS='$(PLTCOLLECTS)' $(MZSCHEME) test-lo.ss)

