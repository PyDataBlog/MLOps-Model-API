VERSION="0.1.0"

GENERATED_FILES = \
	src/version.js \
	viz.js \
	viz.min.js

all: $(GENERATED_FILES)

.PHONY: clean all test

test:
	@npm test

src/version.js: 
	@node bin/version $(VERSION) > $@

viz.js: $(shell node_modules/.bin/smash --ignore-missing --list src/viz.js) package.json
	@rm -f $@
	node_modules/.bin/smash src/viz.js | node_modules/.bin/uglifyjs - -b indent-level=2 -o $@
	@chmod a-w $@

viz.min.js: viz.js bin/uglify
	@rm -f $@
	bin/uglify $< > $@

%.json: bin/% package.json
	@rm -f $@
	bin/$* > $@
	@chmod a-w $@

clean:
	rm -f -- $(GENERATED_FILES)
