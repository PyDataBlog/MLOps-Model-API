#   PTG - Project Template Generator
#   Copyright (C) 2009  Mariusz Ceier
#
#   This program is free software: you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation, either version 3 of the License, or
#   (at your option) any later version.
#
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
#
#   You should have received a copy of the GNU General Public License
#   along with this program.  If not, see <http://www.gnu.org/licenses/>.

CC = gcc
CFLAGS += -g -I. `xml2-config --cflags` -Wall -pedantic -pedantic-errors -DPTG_EXTRA_CHECKS=1
LDFLAGS += `xml2-config --libs`
SRCS = PTG/Main.c PTG/ListIDs.c PTG/OS.c PTG/Status.c PTG/List.c PTG/Option.c PTG/Options.c PTG/Class.c PTG/Classes.c PTG/Namespace.c PTG/Namespaces.c PTG/Project.c PTG/Projects.c PTG/Workspace.c PTG/Generator.c PTG/XML.c PTG/Template.c
OBJS = $(SRCS:.c=.o)
PROGRAM = ptg

.PHONY: all

all: $(PROGRAM)
	
$(PROGRAM): $(OBJS)
	$(CC) $(CFLAGS) $(LDFLAGS) -o $(PROGRAM) $(OBJS)

%.o: %.c
	$(CC) $(CFLAGS) -o $@ -c $<

.PHONY: docs clean distclean depend rebuild package

docs:
	doxygen Doxyfile

clean:
	-rm -f $(PROGRAM)
	-rm -f $(OBJS)
	-rm -f .deps

distclean: clean
	-rm -r -f Docs docs $(PROGRAM).tar.gz

depend:
	$(CC) $(CFLAGS) -MM -MT $(SRCS) > .deps

rebuild: clean all

package: distclean
	@mkdir .tmp
	tar -zcvf .tmp/$(PROGRAM).tar.gz --exclude .tmp $(PWD)
	@mv .tmp/$(PROGRAM).tar.gz .
	@rm -r .tmp

-include .deps

