.PHONY: all clean

CC=gcc
CXX=g++
CFLAGS=-MMD -Wall -Wextra -pedantic -O3 -march=native
CXXFLAGS=-std=c++11
BIN_DIR=build
EXEC=$(BIN_DIR)/timelock
OBJ_FILES=$(patsubst %.cpp, $(BIN_DIR)/%.o, $(wildcard *.cpp))
OBJ_FILES+=$(patsubst %.c, $(BIN_DIR)/%.o, $(wildcard *.c))
DEP_FILES=$(wildcard $(BIN_DIR)/*.d)

all: $(EXEC)

include $(DEP_FILES)

$(EXEC): $(OBJ_FILES)
	$(CXX) $(CFLAGS) $(CXXFLAGS) -o $@ $^

$(BIN_DIR)/%.o: %.c
	@mkdir -p $(BIN_DIR)
	$(CC) $(CFLAGS) -o $@ -c $<

$(BIN_DIR)/%.o: %.cpp
	@mkdir -p $(BIN_DIR)
	$(CXX) $(CFLAGS) $(CXXFLAGS) -o $@ -c $<

clean:
	rm -rf $(BIN_DIR)
