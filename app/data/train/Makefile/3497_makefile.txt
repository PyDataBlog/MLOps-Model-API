############################################################################
# This file is part of "Velox Linux Build Environment"
#
# Copyright (C) 2012-2017 Stewart Maguire <stewart.maguire@s2ack.com>
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
# 02110-1301, USA.
#
############################################################################

ifeq ($(VELOX_COREDIR),)
$(error error : VELOX_COREDIR undefined,  source configure-velox-project.sh in Velox Project)
else
include $(VELOX_COREDIR)/etc/common_defines.mk
include $(VELOX_COREDIR)/$(LOCAL_PORTS_DIR)/etc/defines.mk
endif

PORTNAME=libpciaccess
PORTVERSION=0.13.4
DISTNAME=$(PORTNAME)-$(PORTVERSION)
DISTFILE=$(DISTNAME).tar.bz2
DISTURL=http://xorg.freedesktop.org/releases/individual/lib/
DISTMD5=ace78aec799b1cf6dfaea55d3879ed9f
MAINTAINER=Stewart Maguire <stewart.maguire@s2ack.com>
DISTMTS=yes
DEPENDS=dispsys/X11/util-macros

ifneq ($(VELOX_ARCH), $(VELOX_ARCH_NATIVE))
all: build
else
all: build
endif

VELOX_CONFIG_ARGS+= \
CFLAGS="$(VELOX_CFLAGS)" CPPFLAGS="$(VELOX_CPPFLAGS)" LDFLAGS="$(VELOX_LDFLAGS)"
ifneq ($(VELOX_ARCH),$(VELOX_ARCH_NATIVE))
VELOX_CONFIG_ARGS+= --host=$(VELOX_HOST_TRIPLET) --build=$(VELOX_BUILD_TRIPLET)
else
VELOX_CONFIG_ARGS+= --build=$(VELOX_BUILD_TRIPLET)
endif

extract: genericextract

$(CONFIGURE):
	cd $(VELOX_WORK)/$(DISTNAME) && $(VELOX_AUTORECONF) && $(VELOX_CONFIGURE) $(VELOX_CONFIG_ARGS)

build: genericbuild
	$(MAKE) $(JOBS) -C $(VELOX_WORK)/$(DISTNAME)/

install:
	$(PORTINSTALL) $(MAKE) -C $(VELOX_WORK)/$(DISTNAME)/ $(VELOX_INSTALL_ENV) install
	$(MAKE) portinstalled

include $(VELOX_COREDIR)/$(LOCAL_PORTS_DIR)/etc/rules.mk
