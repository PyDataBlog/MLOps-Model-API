#!/usr/bin/perl -w

use strict; 
use lib '/usr/local/seguridad/bin';
use Ix;

my $quiet;

if ($ARGV[0] eq '-q') {
	$quiet=1;
	shift @ARGV;
} else {
	$quiet=0;
}

my $st="SELECT tpdusuario,nrousuario,codusuario,apeusuario,nomusuario,coddepend,codcargo,fecinicio,fecfin  FROM tusuario where nrousuario = %s";

my $consulta=sprintf($st,lc($ARGV[0]));

my $db=new Ix('seguusua');
my @registros=$db->query($consulta);

print "+--------------+--------+---------------+---------------+----------+----------+\n" unless $quiet;
print "| Documento    | Login  | Apellido      | Nombre        | F.Inicio | F. Fin   |\n" unless $quiet;
print "+--------------+--------+---------------+---------------+----------+----------+\n" unless $quiet;
foreach my $fila (@registros) {
	my $tipodoc;
	my $nrodoc;
	my $login;
	my $apellido;
	my $nombre;
	my $coddepend;
	my $codcargo;
	my $fecinicio;
	my $fecfin;
	($tipodoc, $nrodoc, $login, $apellido, $nombre, $coddepend, $codcargo, $fecinicio, $fecfin)=split(/\|/,$fila);
	$apellido=substr($apellido,0,22);
	$nombre=substr($nombre,0,24);
	$coddepend=0 if $coddepend eq '';
	if ($quiet) {
		my $format = "%s|%d|%s|%s|%s|%d|%d|%s|%s\n";
		printf($format ,$tipodoc, $nrodoc, $login, $apellido, $nombre, $coddepend, $codcargo, $fecinicio, $fecfin);
	} else {
		my $format = "| %-3s %8d |%-8s| %-14s| %-14s|%10s|%10s|\n";
		printf($format ,$tipodoc, $nrodoc, $login, $apellido, $nombre, $fecinicio, $fecfin);
	}
} 

print "+--------------+--------+---------------+---------------+----------+----------+\n" unless $quiet;

exit(@registros);

