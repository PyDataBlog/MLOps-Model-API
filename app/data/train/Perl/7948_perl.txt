#!/usr/bin/perl

use strict;

use Time::HiRes qw ( time );

sub extwtime {
    my $cmd = @_[0];

    my $s = time();
    my $o = `$cmd`;
    my $e = time();

    my %ret = ('result' => $o, 'elapsed' => $e - $s);
    return %ret;
}

sub parse {
    my $lang = @_[0];
    my $result = @_[1];
    my $timing = @_[2];

    my $pt = sprintf("%05f", $timing);

    # TODO: Print out failed vectors.

    my ($stats) = ($result =~ m/(!?\s{3,4}\d+ of \d+ passed)/);
    $stats =~ s/[! ](?<=\s{2})\s/  $lang - $pt sec -/;

    print "$stats\n";

    return;
}

sub c {
    my $dir = "./c";

    my $cmd  = "make test -C $dir";
    my $post = "make clean -C $dir";

    my %ret = extwtime($cmd);

    parse("c", $ret{'result'}, $ret{'elapsed'});

    $_ = `$post`;
    return;
}

sub main {
    my %langs = ( 'c' => \&c );

    print "\nTest Results\n\n";

    my ($inp) = @ARGV;

    unless (defined $inp) {
        foreach my $lang (values %langs) { $lang->(); }
        return;
    }

    my $op = $langs{$inp};
    if (defined $op) { return $op->(); }
}

main();
print "\n";
