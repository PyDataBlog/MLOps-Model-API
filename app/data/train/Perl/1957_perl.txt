#!/usr/env/perl

# (C) 2016 http://www.enviroware.com
# Version 20160526

# Type perl wps_help.pl -info=VARIABLE to get help on WPS VARAIBLE (WRF 3.8).
# Type perl wps_help.pl --help to get a list of variables

use strict;
use Data::Dumper;
use Getopt::Long;

my %manual;
load_manual();

my %input;
my @input_list;
my $show_help_info = '';
init_input();
GetOptions(@input_list,'help'=>\$show_help_info);
print_info();

#ADD---------------------------------------------------------------------
#---------------------------------------------------------------------

sub init_input {

    %input = (

	info => '',

	# SHARE section
        wrf_core => 'ARW',
        max_dom => 1,
        start_year => '',
        start_month => '',
        start_day => '',
        start_hour => '',
        end_year => '',
        end_month => '',
        end_day => '',
        end_hour => '',
        start_date => '',
        end_date => '',
        interval_seconds => '',
        active_grid => 'T',
        io_form_geogrid => 2,
	opt_output_from_geogrid_path => './',
	debug_level => 0,
    

        # GEOGRID section
        parent_id => 1,
	parent_grid_ratio => '',
	i_parent_start => '',
	j_parent_start => '',
        s_we => 1,
        e_we => '',
        s_sn => 1,
        e_sn => '',
        geog_data_res => 'default',
        dx => '',
        dy => '',
        map_proj => 'lambert',
	ref_lat => -999,
	ref_lon => -999,
	ref_x => '',
	ref_y => '',
	truelat1 => '',
	truelat2 => '',
	stand_lon => '',
	pole_lat => '',
	pole_lon => '',
        geog_data_path => '',
        opt_geogrid_tbl_path => './geogrid/',

	# UNGRIB section
	out_format => 'WPS',
	prefix => 'FILE',

	# METGRID section
	fg_name => '',
	constants_name => '',
	io_form_metgrid => 2,
	opt_output_from_metgrid_path => './',
	opt_metgrid_tbl_path => './metgrid/',
	process_only_bdy => 0,

	# 

    );

    my @numerics = qw(
	max_dom 
	start_year start_month start_day start_hour
	end_year end_month end_day end_hour
	interval_seconds io_form_geogrid 
	debug_level
	parent_id parent_grid_ratio i_parent_start j_parent_start
	s_we e_we s_sn e_sn 
	ref_lon ref_lat dx dy ref_x ref_y truelat1 truelat2 stang_lon pole_lat pole_lon 
        io_form_metgrid process_only_bdy
    );
    map {
        push @input_list, "$_=i" => \$input{$_};
    } (@numerics);

    my @flags = qw(
	info wrf_core opt_output_from_geogrid_path geogrid map_proj geog_data_path
	opt_geogrid_tbl_path start_date end_date out_format prefix fg_name constants_name
	opt_output_from_geogrid_path opt_metgrid_tbl_path
    );
    map {
        push @input_list, "$_=s" => \$input{$_};
    } (@flags);

}

# ---------------------------------------------------------------------------- #

sub print_info {


    if ($show_help_info) {
	print "\nType perl wps_manager.pl -info=VARIABLE to get help.\n
	The help is available for

	** SHARE section:

	This section describes variables that are used by more than one WPS program. 
	For example, the wrf_core variable specifies whether the WPS is to produce data 
	for the ARW or the NMM core – information which is needed by both the geogrid 
	and metgrid programs.

        VARIABLES: wrf_core, max_dom, start_year, start_month, start_day, start_hour,
        end_year, end_month, end_day, end_hour, start_date, end_date, 
        interval_seconds, active_grid, io_form_geogrid, 
	opt_output_from_geogrid_path, debug_level


        ** GEOGRID section:

	This section specifies variables that are specific to the geogrid program. 
	Variables in the geogrid section primarily define the size and location 
	of all model domains, and where the static geographical data are found. 

        VARIABLES: parent_id, parent_grid_ratio, i_parent_start, j_parent_start,
        s_we, e_we, s_sn, e_sn, geog_data_res, dx, dy, map_proj,
	ref_lat, ref_lon, ref_x, ref_y, truelat1, truelat2, stand_lon, 
	pole_lat, pole_lon, geog_data_path, opt_geogrid_tbl_path


	** UNGRIB section:
	out_format, prefix

	** METGRID section:

	fg_name, constants_name, io_form_metgrid,
	opt_output_from_metgrid_path, opt_metgrid_tbl_path,
	process_only_bdy

	";
	exit;	
    }	

    return unless ($input{info});

    my $item = uc($input{info}) || '';

    return unless ($item);

    my $content = $manual{$item} || '';
 
    print "** $item **\n";
    if ($content) {
	print $manual{$item},"\n";
    } else {
	print "No manual entry.\n";
    }
     
    exit;

}

# ---------------------------------------------------------------------------- #

sub load_manual {

	# from http://www2.mmm.ucar.edu/wrf/users/docs/user_guide_V3.8/users_guide_chap3.htm#_Description_of_the_1
    %manual = (
	# SHARE section
        WRF_CORE => qq(A character string set to either 'ARW' or 'NMM' that tells the WPS which dynamical core the input data are being prepared for. Default value is 'ARW'.),
        MAX_DOM => qq(An integer specifying the total number of domains/nests, including the parent domain, in the simulation. Default value is 1.),
        START_YEAR => qq(A list of MAX_DOM 4-digit integers specifying the starting UTC year of the simulation for each nest. No default value.),
        START_MONTH => qq(A list of MAX_DOM 2-digit integers specifying the starting UTC month of the simulation for each nest. No default value.),
        START_DAY => qq(A list of MAX_DOM 2-digit integers specifying the starting UTC day of the simulation for each nest. No default value.),
        START_HOUR => qq(A list of MAX_DOM 2-digit integers specifying the starting UTC hour of the simulation for each nest. No default value.),
        END_YEAR => qq(A list of MAX_DOM 4-digit integers specifying the ending UTC year of the simulation for each nest. No default value.),
        END_MONTH => qq(A list of MAX_DOM 2-digit integers specifying the ending UTC month of the simulation for each nest. No default value.),
        END_DAY => qq(A list of MAX_DOM 2-digit integers specifying the ending UTC day of the simulation for each nest. No default value.),
        END_HOUR => qq(A list of MAX_DOM 2-digit integers specifying the ending UTC hour of the simulation for each nest. No default value.),
        START_DATE => qq(A list of MAX_DOM character strings of the form 'YYYY-MM-DD_HH:mm:ss' specifying the starting UTC date of the simulation for each nest. The start_date variable is an alternate to specifying start_year, start_month, start_day, and start_hour, and if both methods are used for specifying the starting time, the start_date variable will take precedence. No default value.),
        END_DATE => qq(A list of MAX_DOM character strings of the form 'YYYY-MM-DD_HH:mm:ss' specifying the ending UTC date of the simulation for each nest. The end_date variable is an alternate to specifying end_year, end_month, end_day, and end_hour, and if both methods are used for specifying the ending time, the end_date variable will take precedence. No default value.),
	INTERVAL_SECONDS => qq(The integer number of seconds between time-varying meteorological input files. No default value.),
        ACTIVE_GRID => qq(A list of MAX_DOM logical values specifying, for each grid, whether that grid should be processed by geogrid and metgrid. Default value is .TRUE..),
        IO_FORM_GEOGRID => qq(The WRF I/O API format that the domain files created by the geogrid program will be written in. Possible options are: 1 for binary; 2 for NetCDF; 3 for GRIB1. When option 1 is given, domain files will have a suffix of .int; when option 2 is given, domain files will have a suffix of .nc; when option 3 is given, domain files will have a suffix of .gr1. Default value is 2 (NetCDF).),
        OPT_OUTPUT_FROM_GEOGRID_PATH => qq(A character string giving the path, either relative or absolute, to the location where output files from geogrid should be written to and read from. Default value is './'.),
        DEBUG_LEVEL => qq(An integer value indicating the extent to which different types of messages should be sent to standard output. When debug_level is set to 0, only generally useful messages and warning messages will be written to standard output. When debug_level is greater than 100, informational messages that provide further runtime details are also written to standard output. Debugging messages and messages specifically intended for log files are never written to standard output, but are always written to the log files. Default value is 0.),


	# GEOGRID section
	PARENT_ID => qq(A list of MAX_DOM integers specifying, for each nest, the domain number of the nest’s parent; for the coarsest domain, this variable should be set to 1. Default value is 1.),
	PARENT_GRID_RATIO => qq(A list of MAX_DOM integers specifying, for each nest, the nesting ratio relative to the domain’s parent. No default value.),
	I_PARENT_START => qq(A list of MAX_DOM integers specifying, for each nest, the x-coordinate of the lower-left corner of the nest in the parent unstaggered grid. For the coarsest domain, a value of 1 should be specified. No default value.),
	J_PARENT_START => qq(A list of MAX_DOM integers specifying, for each nest, the y-coordinate of the lower-left corner of the nest in the parent unstaggered grid. For the coarsest domain, a value of 1 should be specified. No default value.),
	S_WE => qq(A list of MAX_DOM integers which should all be set to 1. Default value is 1.),
	E_WE => qq(A list of MAX_DOM integers specifying, for each nest, the nest’s full west-east dimension. For nested domains, e_we must be one greater than an integer multiple of the nest's parent_grid_ratio (i.e., e_we = n*parent_grid_ratio+1 for some positive integer n). No default value.),
	S_SN => qq(A list of MAX_DOM integers which should all be set to 1. Default value is 1.),
	E_SN => qq(A list of MAX_DOM integers specifying, for each nest, the nest’s full south-north dimension. For nested domains, e_sn must be one greater than an integer multiple of the nest's parent_grid_ratio (i.e., e_sn = n*parent_grid_ratio+1 for some positive integer n). No default value.),
	GEOG_DATA_RES => qq(A list of MAX_DOM character strings specifying, for each nest, a corresponding resolution or list of resolutions separated by + symbols of source data to be used when interpolating static terrestrial data to the nest’s grid. For each nest, this string should contain a resolution matching a string preceding a colon in a rel_path or abs_path specification (see the description of GEOGRID.TBL options) in the GEOGRID.TBL file for each field. If a resolution in the string does not match any such string in a rel_path or abs_path specification for a field in GEOGRID.TBL, a default resolution of data for that field, if one is specified, will be used. If multiple resolutions match, the first resolution to match a string in a rel_path or abs_path specification in the GEOGRID.TBL file will be used. Default value is 'default'.),
	DX => qq(A real value specifying the grid distance in the x-direction where the map scale factor is 1. For ARW, the grid distance is in meters for the 'polar', 'lambert', and 'mercator' projection, and in degrees longitude for the 'lat-lon' projection; for NMM, the grid distance is in degrees longitude. Grid distances for nests are determined recursively based on values specified for parent_grid_ratio and parent_id. No default value.),
	DY => qq(A real value specifying the nominal grid distance in the y-direction where the map scale factor is 1. For ARW, the grid distance is in meters for the 'polar', 'lambert', and 'mercator' projection, and in degrees latitude for the 'lat-lon' projection; for NMM, the grid distance is in degrees latitude. Grid distances for nests are determined recursively based on values specified for parent_grid_ratio and parent_id. No default value.),
	MAP_PROJ => qq(A character string specifying the projection of the simulation domain. For ARW, accepted projections are 'lambert', 'polar', 'mercator', and 'lat-lon'; for NMM, a projection of 'rotated_ll' must be specified. Default value is 'lambert'.),
	REF_LAT => qq(A real value specifying the latitude part of a (latitude, longitude) location whose (i,j) location in the simulation domain is known. For ARW, ref_lat gives the latitude of the center-point of the coarse domain by default (i.e., when ref_x and ref_y are not specified). For NMM, ref_lat always gives the latitude to which the origin is rotated. No default value.),
	REF_LON => qq(A real value specifying the longitude part of a (latitude, longitude) location whose (i, j) location in the simulation domain is known. For ARW, ref_lon gives the longitude of the center-point of the coarse domain by default (i.e., when ref_x and ref_y are not specified). For NMM, ref_lon always gives the longitude to which the origin is rotated. For both ARW and NMM, west longitudes are negative, and the value of ref_lon should be in the range [-180, 180]. No default value.),
	REF_X => qq(A real value specifying the i part of an (i, j) location whose (latitude, longitude) location in the simulation domain is known. The (i, j) location is always given with respect to the mass-staggered grid, whose dimensions are one less than the dimensions of the unstaggered grid. Default value is (((E_WE-1.)+1.)/2.) = (E_WE/2.).),
	REF_Y => qq(A real value specifying the j part of an (i, j) location whose (latitude, longitude) location in the simulation domain is known. The (i, j) location is always given with respect to the mass-staggered grid, whose dimensions are one less than the dimensions of the unstaggered grid. Default value is (((E_SN-1.)+1.)/2.) = (E_SN/2.).),
	TRUELAT1 => qq(A real value specifying, for ARW, the first true latitude for the Lambert conformal projection, or the only true latitude for the Mercator and polar stereographic projections. For NMM, truelat1 is ignored. No default value.),
	TRUELAT2 => qq(A real value specifying, for ARW, the second true latitude for the Lambert conformal conic projection. For all other projections, truelat2 is ignored. No default value.),
	STAND_LON => qq(A real value specifying, for ARW, the longitude that is parallel with the y-axis in the Lambert conformal and polar stereographic projections. For the regular latitude-longitude projection, this value gives the rotation about the earth's geographic poles. For NMM, stand_lon is ignored. No default value.),
	POLE_LAT => qq(For the latitude-longitude projection for ARW, the latitude of the North Pole with respect to the computational latitude-longitude grid in which -90.0° latitude is at the bottom of a global domain, 90.0° latitude is at the top, and 180.0° longitude is at the center. Default value is 90.0.),
	POLE_LON => qq(For the latitude-longitude projection for ARW, the longitude of the North Pole with respect to the computational lat/lon grid in which -90.0° latitude is at the bottom of a global domain, 90.0° latitude is at the top, and 180.0° longitude is at the center. Default value is 0.0.),
	GEOG_DATA_PATH => qq(A character string giving the path, either relative or absolute, to the directory where the geographical data directories may be found. This path is the one to which rel_path specifications in the GEOGRID.TBL file are given in relation to. No default value.),
	OPT_GEOGRID_TBL_PATH => qq(A character string giving the path, either relative or absolute, to the GEOGRID.TBL file. The path should not contain the actual file name, as GEOGRID.TBL is assumed, but should only give the path where this file is located. Default value is './geogrid/'.),

	# UNGRIB section
	OUT_FORMAT => qq(A character string set either to 'WPS', 'SI', or 'MM5'. If set to 'MM5', ungrib will write output in the format of the MM5 pregrid program; if set to 'SI', ungrib will write output in the format of grib_prep.exe; if set to 'WPS', ungrib will write data in the WPS intermediate format. Default value is 'WPS'.),
	PREFIX => qq(A character string that will be used as the prefix for intermediate-format files created by ungrib; here, prefix refers to the string PREFIX in the filename PREFIX:YYYY-MM-DD_HH of an intermediate file. The prefix may contain path information, either relative or absolute, in which case the intermediate files will be written in the directory specified. This option may be useful to avoid renaming intermediate files if ungrib is to be run on multiple sources of GRIB data. Default value is 'FILE'.),

	# METGRID section
	FG_NAME => qq(A list of character strings specifying the path and prefix of ungribbed data files. The path may be relative or absolute, and the prefix should contain all characters of the filenames up to, but not including, the colon preceding the date. When more than one fg_name is specified, and the same field is found in two or more input sources, the data in the last encountered source will take priority over all preceding sources for that field. Default value is an empty list (i.e., no meteorological fields).),

	CONSTANTS_NAME => qq(A list of character strings specifying the path and full filename of ungribbed data files which are time-invariant. The path may be relative or absolute, and the filename should be the complete filename; since the data are assumed to be time-invariant, no date will be appended to the specified filename. Default value is an empty list (i.e., no constant fields).),

	IO_FORM_METGRID => qq(The WRF I/O API format that the output created by the metgrid program will be written in. Possible options are: 1 for binary; 2 for NetCDF; 3 for GRIB1. When option 1 is given, output files will have a suffix of .int; when option 2 is given, output files will have a suffix of .nc; when option 3 is given, output files will have a suffix of .gr1. Default value is 2 (NetCDF).),

	OPT_OUTPUT_FROM_METGRID_PATH => qq(A character string giving the path, either relative or absolute, to the location where output files from metgrid should be written to. The default value is the current working directory (i.e., the default value is './').),

	OPT_METGRID_TBL_PATH => qq(A character string giving the path, either relative or absolute, to the METGRID.TBL file; the path should not contain the actual file name, as METGRID.TBL is assumed, but should only give the path where this file is located. Default value is './metgrid/'.),

	PROCESS_ONLY_BDY => qq(An integer specifying the number of boundary rows and columns to be processed by metgrid for time periods after the initial time; for the initial time, metgrid will always interpolate to every grid point. Setting this option to the intended value of spec_bdy_width in the WRF namelist.input will speed up processing in metgrid, but it should not be set if interpolated data are needed in the domain interior. If this option is set to zero, metgrid will horizontally interpolate meteorological data to every grid point in the model domains. This option is only available for ARW. Default value is 0.),

	);
 
}
