/**
 * Clase que permite trabajar con la plantilla del profesor.
 * 
 * @param   {String}    id      ID de la etiqueta HTML asociada.
 * @param   {Boolean    revisor ¿Sólo se buscarán revisores?
 * @returns {Profesor}
 */
function Profesor(id, revisor)
{
    /**
     * Establece la etiqueta HTML asociada a esta plantilla.
     */
    this.id = id;

    /**
     * Establece si la plantilla de búsqueda sólo buscará revisores en
     * el servidor o no.
     */
    this.revisor = false;
    if (typeof revisor !== 'undefined')
    {
        this.revisor = revisor;
    }

    /**
     * Devuelve la etiqueta HTML asociada.
     * 
     * @returns {jQuery}
     */
    this.objeto = function ()
    {
        return $('input#' + this.id);
    };

    /**
     * Inicializa el INPUT como un objeto Select2.
     */
    this.inicializar = function ()
    {
        revisor = this.revisor;

        this.objeto().select2(
                {
                    placeholder: 'Elija un profesor',
                    minimumInputLength: 1,
                    minimumResultsForSearch: 1,
                    formatSearching: 'Buscando...',
                    formatAjaxError: 'Ha habido un error en la petición',
                    dropdownCssClass: 'bigdrop',
                    dropdownAutoWidth: true,
                    ajax:
                            {
                                url: '/index/select2Profesor',
                                dataType: 'json',
                                type: 'POST',
                                async: false,
                                data: function (cadena)
                                {
                                    var input = new Formulario().objeto().children("input[type = 'hidden']");
                                    var datos = establecerDatosSelect2(input.prop('name'), input.prop('value'), cadena, 2);

                                    if (revisor)
                                    {
                                        datos['NkWQ0yGKJFJ6U4WS7yRS'] = true;
                                    }
                                    console.log(this.revisor);
                                    console.log(datos);

                                    return datos;
                                },
                                results: function (datos)
                                {
                                    return {results: obtenerDatosSelect2(datos)};
                                }
                            },
                    formatResult: function (objeto)
                    {
                        return objeto['nombreCompleto'];
                    },
                    formatSelection: function (objeto)
                    {
                        return objeto['nombreCompleto'];
                    },
                    initSelection: function (elemento, callback)
                    {
                        var id = $(elemento).val();

                        if (id !== '')
                        {
                            var input = new Formulario().objeto().children("input[type = 'hidden']");
                            var datos = establecerDatosSelect2(input.prop('name'), input.prop('value'), id, 1);

                            if (revisor)
                            {
                                datos['NkWQ0yGKJFJ6U4WS7yRS'] = true;
                            }

                            $.ajax('/index/select2Profesor',
                                    {
                                        dataType: 'json',
                                        type: 'POST',
                                        async: false,
                                        data: datos
                                    }).done(function (datos)
                            {
                                callback(obtenerDatosSelect2(datos)[0]);
                            });
                        }
                    }
                });
    };

    /**
     * Desplaza las etiquetas HTML Select2 que se usan para este profesor.
     */
    this.moverSelect2 = function ()
    {
        this.objeto().parent().append($('div#s2id_' + this.id));
    };
}