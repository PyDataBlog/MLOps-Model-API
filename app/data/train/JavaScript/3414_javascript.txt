'use strict';

angular.module('myApp.post', ['ngRoute'])

.config(['$routeProvider', function($routeProvider) {
	$routeProvider.when('/new-post', {
		templateUrl: 'posts/new-post.html',
		controller: 'PostCtrl'
	});
}])

.controller('PostCtrl', ['$scope', '$firebaseArray', 'CommonProp', '$location', function($scope, $firebaseArray, CommonProp, $location) {
	// if user is not logged in, redirect to sign in page
	if (!CommonProp.getUser()) {
		$location.path('/signin');
	}

	$scope.addPost = function() {
		var firebaseObj = new Firebase("https://amber-heat-2147.firebaseio.com/articles");
		var fb = $firebaseArray(firebaseObj);
		var title = $scope.article.title;
		var content = $scope.article.content;

		fb.$add({
			title: title,
			content: content,
			author: CommonProp.getUser()
		}).then(function(ref) {
			$location.path('/home');
		}, function(error) {
			console.log("Error:", error);
		});
	};

	$scope.logout = function(){
		CommonProp.logoutUser();
	}
}]);
