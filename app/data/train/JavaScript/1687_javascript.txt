////functionen hämtar alla artiklar med hjälp av getJSON
//och får tillbaka en array med alla artiklar
//efter den är klar kallar den på functionen ShoArtTab.
//som skriver ut alla artiklar i en tabell.
function getAllAdminProducts()
{
    $.getJSON("index2.php/getAllProducts").done(showArtTab);
}
//functionen showArtTab får en array av getAllArticle funktionen
//som den loopar igenom och anväder för att skapa upp en tabell med alla de olika
//artiklarna
function showArtTab(cart){
    var mainTabell = document.createElement('div');
    mainTabell.setAttribute('id', 'mainTabell');
    var tbl = document.createElement('table');
    tbl.setAttribute('border', '1');
    var tr = document.createElement('tr');
    
    var th2 = document.createElement('th');
    var txt2 = document.createTextNode('Produktid');

    var th3 = document.createElement('th');
    var txt3 = document.createTextNode('Produktnamn');

    var th4 = document.createElement('th');
    var txt4 = document.createTextNode('Kategori');

    var th5 = document.createElement('th');
    var txt5 = document.createTextNode('Pris');
    
    var th6 = document.createElement('th');
    var txt6 = document.createTextNode('Bild');
    
    var th7 = document.createElement('th');
    var txt7 = document.createTextNode('Delete');
    
    var th8 = document.createElement('th');
    var txt8 = document.createTextNode('Update');


    th2.appendChild(txt2);
    tr.appendChild(th2);

    th3.appendChild(txt3);
    tr.appendChild(th3);

    th4.appendChild(txt4);
    tr.appendChild(th4);

    th5.appendChild(txt5);
    tr.appendChild(th5);
    
    th6.appendChild(txt6);
    tr.appendChild(th6);

    th7.appendChild(txt7);
    tr.appendChild(th7);
    
    th8.appendChild(txt8);
    tr.appendChild(th8);

    tbl.appendChild(tr);
    var i = 0;
    
    do{
        var row = tbl.insertRow(-1);
        row.insertCell(-1).innerHTML = cart[i].produktid;

        var cell2 = row.insertCell(-1);
        cell2.innerHTML = cart[i].namn;

        var cell3 = row.insertCell(-1);
        cell3.innerHTML = cart[i].kategori;

        var cell4 = row.insertCell(-1);
        cell4.innerHTML = cart[i].pris;
        var cell6 = row.insertCell(-1);
        cell6.innerHTML = '<img src="' + cart[i].img + '" height="70" width="70"/>';
        var cell7 = row.insertCell(-1);
        cell7.innerHTML = "<a href='#' onclick='removeArt(\"" +cart[i].produktid+ "\",\""+ "\");'>Remove</a>";
        var cell8 = row.insertCell(-1);
        cell8.innerHTML = "<a href='#' onclick='getUpdate(\"" +cart[i].produktid+ "\",\""+ "\");'>Update</a>";
        tbl.appendChild(row);
        i++;
    }while(i< cart.length);
   
    $('#main').html(tbl);
}
//öppnar en dialogruta när man trycker på "Add Article" knappen
//med det som finns i diven med id:addArt
function showAddArt(){
    $('#addArt').dialog({
        show:'fade', position:'center'
    });
}
//när man trycker på "Add Article" knappen i dialogrutan så ska den lägga till datan 
//från formuläret som görs med .serialize som hämtar datan från textfälten.
function addArticle(){
    $.post('index2.php/AdminController/addProduct',$('#addArtForm').serialize()).done(getAllAdminProducts);
    $("#addArt").dialog('close');
}

//tar bort en artikel med att hämta in dess namn och skicka förfrågningen till modellen
function deleteArt(prodid)
{
    $.getJSON("index2.php/AdminController/deleteProduct/"+prodid);
}

function removeArt(prodid){
    var r=confirm("Vill du ta bort den här produkten?");
    if (r==true)
    {
        x="JA";
    } else {
        x="NEJ";
    } 
    if(x === "JA"){
        deleteArt(prodid);
        getAllAdminProducts();
    }
}
//en function som tar in namnet
//och använder det när man kallar på getArt
function getUpdate(prodid){
    getArt(prodid);
}
//får in artikelid och använder det för att hämta alla artiklar som har samma
//id med hjälp av modellen.
function getArt(prodid){
    $.getJSON("index2.php/Controller/getProdById/"+prodid).done(showArt);
}
//en function som visar en dialog ruta med färdig i fylld data i textfällten 
//från den uppgift man vill uppdatera.
function showArt(data){
    $('#updateId').attr('value',data[0].produktid);
    $('#updateNamn').attr('value',data[0].namn);
    $('#updateKategori').attr('value',data[0].kategori);
    $('#updatePris').attr('value',data[0].pris);
    $('#updateImg').attr('value',data[0].img);
    $('#update').dialog({
        show:'fade', position:'center',
    });
}
//när man trycker på uppdatera så hämtar den datan från forumlätert med hjälp av 
// .serialize och skickar datan till modellen. 
//stänger sen dialogrutan.
function updateArt(){
$.post("index2.php/AdminController/updateProduct/", $('#updateForm').serialize()).done(getAllAdminProducts); 
    $("#update").dialog('close');
}