var parseString = require('xml2js').parseString;

// The body of the response from each of our api requests can either be xml or json
// if body is json, simply return the json
// else body is xml, so asynchronously parse the xml and wait for the result
// This function returns a promise for the json value
var getJsonFromBody = function(body) {
	var prom_json = new Promise(function(resolve, reject) {
		try {
			var json = JSON.parse(body);
			resolve(json);
		} catch(e) {
			var xml = body;
			parseString(xml, function(err, json) {
				if (err)
					reject(err);
				else 
					resolve(json);
			});
		}
	});
	return prom_json;
};

module.exports = getJsonFromBody;
