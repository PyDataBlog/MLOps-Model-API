package db

import (
	"hg/messages"
	"fmt"
	"gopkg.in/mgo.v2"
)

const (
	mongoURL = "127.0.0.1:27017"
)

func persist(operation string,historyEntry messages.HistoryMessage) {
	fmt.Println("Do db operation")
	session, err := mgo.Dial(mongoURL)
	if err != nil {
		panic(err)
	}
	defer session.Close()

	historyCollection := session.DB("historys").C("history")

	switch operation {
	case "Insert":
		err = historyCollection.Insert(historyEntry)
		if err != nil {
			fmt.Printf("Can't insert document: %v\n", err)
			panic(err)
		}
	case "Update":
		fmt.Println("Update method is not supported yet!")
	case "Delete":
		fmt.Println("Delete method is not supported yet!")
	case "Put":
		fmt.Println("Put method is not supported yet!")
	}
}

func RecordHistory(historyEntry messages.HistoryMessage){
	fmt.Println("Start to record history object")
	persist("Insert",historyEntry)
}
