package controllers

import (
	"fmt"
	"github.com/codeskyblue/go-sh"
	"github.com/revel/revel"
	//"log"
	"strings"
)

type Search struct {
	*revel.Controller
}

func (c Search) Search(q string, count int) revel.Result {
	fmt.Printf("query string is %s\n", q)
	fmt.Printf("count is %d\n", count)
	if count == 0 {
		count = 10
	}
	command := fmt.Sprintf("ag --silent -i -m %d \"%s\" \"/Users/Join/Elements\"", count, strings.Trim(q, " "))
	shell_out, err := sh.Command("bash", "-c", command).Output()
	var pretty_results []string
	if err != nil {
		return c.Render(pretty_results)
	}
	r := strings.NewReplacer(q, fmt.Sprintf("<span class='label-warning'>%s</span>", q))
	results := r.Replace(string(shell_out[:]))
	pretty_results = strings.Split(results, "\n")
	return c.Render(pretty_results)
}
