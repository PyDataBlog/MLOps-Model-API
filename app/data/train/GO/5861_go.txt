package http_handlers

import (
	"fmt"
	"github.com/go-martini/martini"
	"net/http"
)

func GetCaches() func(
	martini.Context,
	martini.Params,
	http.ResponseWriter,
	*http.Request,
) {
	return HttpHandler(
		[]string{
			AUTH_REQUIRED,
		},
		func(h *Http) {
			h.SetResponse(
				h.session.Caches,
			)
		},
	)
}

func GetCache() func(
	martini.Context,
	martini.Params,
	http.ResponseWriter,
	*http.Request,
) {
	return HttpHandler(
		[]string{
			AUTH_REQUIRED,
			CACHE_REQUIRED,
		},
		func(h *Http) {
			if c := h.session.GetCache(
				h.vars["cache_id"],
			); c != nil {
				h.SetResponse(
					c,
				)
			} else {
				h.AddError(
					fmt.Errorf(
						`Cache not found`,
					),
					404,
				)
			}
		},
	)
}

func RegisterCache() func(
	martini.Context,
	martini.Params,
	http.ResponseWriter,
	*http.Request,
) {
	return HttpHandler(
		[]string{
			AUTH_REQUIRED,
		},
		func(h *Http) {
			h.SetResponseCreatedObject(
				h.session.CreateCache(),
			)
		},
	)
}
