Imports Visomes.MySQL
Imports Visomes.SGV.Core

Public Class GrupoProduto
    Implements ICadastro(Of GrupoProduto)
    Private idValue As Integer
    Private descricaoValue As String
    Private cadastroValue As Date
    Private statusValue As Boolean = True
    Private usuarioValue As Usuario

#Region "Property"
    Public Property ID() As Integer Implements ICadastro(Of Visomes.SGV.GrupoProduto).ID
        Get
            Return idValue
        End Get
        Set(ByVal value As Integer)
            idValue = value
        End Set
    End Property

    Public Property Usuario() As Usuario Implements ICadastro(Of Visomes.SGV.GrupoProduto).Usuario
        Get
            Return usuarioValue
        End Get
        Set(ByVal value As Usuario)
            usuarioValue = value
        End Set
    End Property

    Public Property Descricao() As String Implements ICadastro(Of Visomes.SGV.GrupoProduto).Descricao
        Get
            Return Me.descricaoValue
        End Get
        Set(ByVal value As String)
            Me.descricaoValue = value
        End Set
    End Property

    Public Property Status() As Boolean Implements ICadastro(Of Visomes.SGV.GrupoProduto).Status
        Get
            Return statusValue
        End Get
        Set(ByVal value As Boolean)
            statusValue = value
        End Set
    End Property

    Public Property Cadastro() As Date Implements ICadastro(Of Visomes.SGV.GrupoProduto).Cadastro
        Get
            Return cadastroValue
        End Get
        Set(ByVal value As Date)
            cadastroValue = value
        End Set
    End Property

#End Region

    Public Sub New(ByVal idValue As Integer)
        Me.idValue = idValue
        CarregaDados()
    End Sub

    Public Sub New()
    End Sub

    Public Sub CarregaDados()
        Dim idUsuario As Integer = 0
        Connection.ConnectionMysql()
        MyData = DML.Select("*", "produto_grupo p", "idGrupo = '" & Me.idValue & "'")
        If MyData.Read() Then
            idUsuario = MyData.GetInt32(1)
            Me.descricaoValue = MyData.GetString(2)
            Me.cadastroValue = MyData.GetDateTime(3)
            Me.statusValue = MyData.GetBoolean(4)
        End If
        MyData.Dispose()
        Connection.DisconnectMySQL()
        If idUsuario > 0 Then Me.usuarioValue = New Usuario(idUsuario)
    End Sub

    Public Function Commit() As Boolean Implements ICadastro(Of Visomes.SGV.GrupoProduto).Commit
        If Me.idValue = 0 Then
            Return DML.Insert("produto_grupo", "descricao,dtCadastro,status,idUsuario", "'" & Me.descricaoValue & "',CURRENT_DATE()," & Me.statusValue & "," & Me.usuarioValue.ID & "")
        Else
            Return DML.Update("produto_grupo", "descricao='" & Me.descricaoValue & "',dtCadastro=CURRENT_DATE(),status=" & Me.statusValue & ",idUsuario=" & Me.usuarioValue.ID & "", "idGrupo=" & Me.idValue & "")
        End If
    End Function

    Public Function GetLista() As Object() Implements ICadastro(Of Visomes.SGV.GrupoProduto).GetLista
        Return FeedsLists("descricao", "produto_grupo", "status = 1 ORDER BY descricao")
    End Function

    Public Function CarregaCadastros() As Generic.List(Of GrupoProduto) Implements ICadastro(Of Visomes.SGV.GrupoProduto).CarregaCadastros
        Dim lista As New Generic.List(Of GrupoProduto)
        Dim listaID As New Generic.List(Of Integer)
        Connection.ConnectionMysql()
        Core.MyData = DML.Select("idGrupo", "produto_grupo", "status=1")
        While MyData.Read
            listaID.Add(MyData.GetInt32(0))
        End While
        Connection.DisconnectMySQL()
        Core.MyData.Dispose()
        For Each num As Integer In listaID
            lista.Add(New GrupoProduto(num))
        Next
        Return lista
    End Function

    Public Function Inativar() As Boolean Implements ICadastro(Of Visomes.SGV.GrupoProduto).Inativar
        Return DML.Update("produto_grupo", "status=0", "idGrupo=" & Me.idValue & "")
    End Function

    Public Function Delete() As Boolean Implements ICadastro(Of Visomes.SGV.GrupoProduto).Delete
        Return DML.Delete("produto_grupo", "id=" & Me.idValue & "")
    End Function

    Public Shared Function GetIDByDescricao(ByVal str As String) As Integer
        Dim id As Integer = 0
        Connection.ConnectionMysql()
        MyData = DML.Select("idGrupo", "produto_grupo", "descricao = '" & str & "'")
        If MyData.Read() Then id = MyData.GetInt32(0)
        Connection.DisconnectMySQL()
        MyData.Dispose()
        Return id
    End Function

    Public Shared Function GetDescricaoByID(ByVal id As Integer) As String
        Dim descricao As String = String.Empty
        Connection.ConnectionMysql()
        Core.MyData = DML.Select("descricao", "externo_ocorrencia_area", "idGrupo = '" & id & "'")
        If Core.MyData.Read() Then descricao = Core.MyData.GetString(0)
        Connection.DisconnectMySQL()
        Core.MyData.Dispose()
        Return descricao
    End Function

    Public Shared Function ListaGrupoByProduto(ByVal idProduto As String) As Object()
        Return Core.FeedsLists("g.descricao", _
                               "produto_has_subgrupo phs " _
                             & "INNER JOIN produto_subgrupo ps ON  ps.idSubgrupo = phs.idSubgrupo " _
                             & "INNER JOIN produto_grupo g ON  g.idGrupo = ps.idGrupo", _
                               "ps.status = 1 AND phs.idProduto = '" & idProduto & "' ")
    End Function

    Public Shared Function GetGrupos(ByVal list As Generic.List(Of String)) As String
        Dim strCondicao As String = String.Empty
        strCondicao += " ("
        Dim idSubArea As Integer
        For Each s As String In list
            Connection.ConnectionMysql()
            Core.MyData = DML.Select("idGrupo", "produto_grupo", "descricao = '" & s & "'")
            Core.MyData.Read()
            idSubArea = Core.MyData.GetInt32(0)
            Connection.DisconnectMySQL()
            Core.MyData.Dispose()
            strCondicao += "pg.idGrupo =  " & idSubArea & " Or "
        Next
        strCondicao += ")"
        strCondicao = strCondicao.Replace(" Or )", ")")
        Return strCondicao
    End Function

    Public Overrides Function ToString() As String
        Return Me.Descricao
    End Function
End Class
