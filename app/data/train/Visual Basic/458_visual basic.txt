Namespace UnsafeRoutines

    Public Module _Shared

        Public Function GetDWGFileIcon(exists As Boolean, fileName As String, size As Integer, ByRef tooltip As String) As Drawing.Image
            Dim DWGVersionCode As String = ""
            If exists Then
                DWGVersionCode = GetDWGVersionCode(fileName).ToUpper()
            End If
            Select Case DWGVersionCode
                Case "AC1027"
                    tooltip = "{0}2013{0}".FormatWith(Settings.DefaultIndent)
                    DWGVersionCode = "AC1027.png"
                Case "AC1024"
                    tooltip = "{0}2010{0}".FormatWith(Settings.DefaultIndent)
                    DWGVersionCode = "AC1024.bmp"
                Case "AC1021"
                    tooltip = "{0}2007-2009{0}".FormatWith(Settings.DefaultIndent)
                    DWGVersionCode = "AC1021.bmp"
                Case "AC1018"
                    tooltip = "{0}2004-2006{0}".FormatWith(Settings.DefaultIndent)
                    DWGVersionCode = "AC1018.gif"
                Case "AC1015"
                    tooltip = "{0}2000-2002{0}".FormatWith(Settings.DefaultIndent)
                    DWGVersionCode = "AC1015.gif"
                Case "AC1014"
                    tooltip = "{0}R14{0}".FormatWith(Settings.DefaultIndent)
                    DWGVersionCode = "AC1014.gif"
                Case "AC1012", "AC1009", "AC1006", "AC1004"
                    tooltip = "{0}R9-R13{0}".FormatWith(Settings.DefaultIndent)
                    DWGVersionCode = "ACPrev.bmp"
                Case Else
                    tooltip = "{0}Unsupported or Unknown Version{0}".FormatWith(Settings.DefaultIndent)
                    DWGVersionCode = "ACUnknown.bmp"
            End Select
            Return Images.GetImage(DWGVersionCode, size, Images.Blank)
        End Function

        Private Function GetDWGVersionCode(fileName As String) As String
            Try
                Dim Buffer(6) As Char

                Using sr As New IO.StreamReader(New IO.FileStream(fileName, IO.FileMode.Open, IO.FileAccess.Read, IO.FileShare.Read))
                    sr.ReadBlock(Buffer, 0, 6)
                End Using

                Return String.Concat(Buffer).ToString.Substring(0, 6)
            Catch ex As Exception
                ex.ToLog(True)
            End Try
            Return ""
        End Function

    End Module

End Namespace