Option Strict Off
Option Explicit On
Imports VB = Microsoft.VisualBasic
Friend Class frmZaznamy
	Inherits System.Windows.Forms.Form
	Dim rec As New ADODB.Recordset
    Dim PomCol As New Collection 'Pomocná kolekce jednotlivých zkouení
    Private IsInitializing As Boolean

    Public Sub New()
        MyBase.New()
        IsInitializing = True
        InitializeComponent()
        IsInitializing = False
    End Sub

	Private Sub frmZaznamy_Load(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles MyBase.Load
		Dim I As Short
		'Naplnìní comboboxù z databáze
		rec.Open("SELECT DISTINCT * FROM ZKOUSENI_HLAVICKY ORDER BY HLAVICKA_ID DESC", SConn, ADODB.CursorTypeEnum.adOpenStatic,  , ADODB.CommandTypeEnum.adCmdText)
		If rec.RecordCount > 0 Then
			rec.MoveFirst()
            For I = 1 To rec.RecordCount
                If (Not IsDBNull(rec.Fields("HLAVICKA_ID").Value) And Not IsDBNull(rec.Fields("DATUM").Value) And Not IsDBNull(rec.Fields("CAS_OD").Value) And Not IsDBNull(rec.Fields("CAS_DO").Value) And Not IsDBNull(rec.Fields("LEKCE_OD").Value) And Not IsDBNull(rec.Fields("LEKCE_DO").Value)) Then
                    Hlavicka.Items.Add(rec.Fields("HLAVICKA_ID").Value & ". " & rec.Fields("DATUM").Value & ", " & VB.Left(rec.Fields("CAS_OD").Value, 5) & " - " & VB.Left(rec.Fields("CAS_DO").Value, 5) & ", " & rec.Fields("LEKCE_OD").Value & ".-" & rec.Fields("LEKCE_DO").Value & ".lekce ")
                    PomCol.Add(rec.Fields("HLAVICKA_ID").Value)
                End If
                rec.MoveNext()
            Next I
			Hlavicka.SelectedIndex = 0
			rec.Close()
		Else
			rec.Close()
		End If
	End Sub
	
	'UPGRADE_WARNING: Event Hlavicka.SelectedIndexChanged may fire when form is initialized. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="88B12AE1-6DE0-48A0-86F1-60C0686C026A"'
    Private Sub Hlavicka_SelectedIndexChanged(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Hlavicka.SelectedIndexChanged
        If Me.IsInitializing = True Then
            Exit Sub
        Else
            NaplnRadky()
        End If
    End Sub
	
	'UPGRADE_WARNING: Event Chybne.CheckedChanged may fire when form is initialized. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="88B12AE1-6DE0-48A0-86F1-60C0686C026A"'
    Private Sub Chybne_CheckedChanged(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Chybne.CheckedChanged
        If Me.IsInitializing = True Then
            Exit Sub
        Else
            If eventSender.Checked Then
                NaplnRadky()
            End If
        End If
    End Sub
	
	'UPGRADE_WARNING: Event Vse.CheckedChanged may fire when form is initialized. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="88B12AE1-6DE0-48A0-86F1-60C0686C026A"'
    Private Sub Vse_CheckedChanged(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Vse.CheckedChanged
        If Me.IsInitializing = True Then
            Exit Sub
        Else
            If eventSender.Checked Then
                NaplnRadky()
            End If
        End If
    End Sub
	
	Private Sub Vymazat_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Vymazat.Click
		Dim Odpoved As String
		Dim I As Short
		For I = 1 To PomCol.Count()
			PomCol.Remove(1)
		Next 
		Odpoved = CStr(MsgBox("Opravdu chcete vymazat vechny záznamy o zkouení?!", MsgBoxStyle.Critical + MsgBoxStyle.YesNo + MsgBoxStyle.DefaultButton2, "Pozor!"))
		If Odpoved = CStr(MsgBoxResult.Yes) Then
			SConn.Execute("DROP TABLE ZKOUSENI_HLAVICKY")
			SConn.Execute("DROP TABLE ZKOUSENI_RADKY")
			SConn.Execute("CREATE TABLE ZKOUSENI_HLAVICKY (HLAVICKA_ID counter, DATUM varchar(10) NULL, CAS_OD varchar(8) NULL, CAS_DO varchar (8) NULL, LEKCE_OD integer NULL, LEKCE_DO integer NULL, SMER varchar(255), CO varchar(255) NULL, JAK varchar(255) NULL, UZIVATEL varchar(255) NULL, POZNAMKA memo NULL)")
			SConn.Execute("CREATE TABLE ZKOUSENI_RADKY (RADEK_ID counter, HLAVICKA_ID single, VAZBA_ID single, ODPOVED varchar(255) NULL, VYSLEDEK integer NULL, POZNAMKA memo NULL)")
            Me.Close()
		End If
	End Sub
	
	Private Sub Zrusit_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Zrusit.Click
		Dim I As Short
		For I = 1 To PomCol.Count()
			PomCol.Remove(1)
		Next 
        Me.Close()
	End Sub
	
	Public Sub NaplnRadky()
		Dim I As Short
		Dim r As New ADODB.Recordset
		Radky.Items.Clear()
		'UPGRADE_WARNING: Couldn't resolve default property of object PomCol.Item(). Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="6A50421D-15FE-4896-8A1B-2EC21E9037B2"'
		r.Open("SELECT DISTINCT * FROM ZKOUSENI_HLAVICKY WHERE ZKOUSENI_HLAVICKY.HLAVICKA_ID = " & PomCol.Item((Hlavicka.SelectedIndex) + 1), SConn, ADODB.CursorTypeEnum.adOpenStatic,  , ADODB.CommandTypeEnum.adCmdText)
		'UPGRADE_WARNING: Use of Null/IsNull() detected. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="2EED02CB-5C0E-4DC1-AE94-4FAA3A30F51A"'
		If Not IsDbNull(r.Fields("SMER").Value) Then Smer.Text = r.Fields("SMER").Value
		'UPGRADE_WARNING: Use of Null/IsNull() detected. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="2EED02CB-5C0E-4DC1-AE94-4FAA3A30F51A"'
		If Not IsDbNull(r.Fields("CO").Value) Then Co.Text = r.Fields("CO").Value
		'UPGRADE_WARNING: Use of Null/IsNull() detected. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="2EED02CB-5C0E-4DC1-AE94-4FAA3A30F51A"'
		If Not IsDbNull(r.Fields("JAK").Value) Then Jak.Text = r.Fields("JAK").Value
		'UPGRADE_WARNING: Use of Null/IsNull() detected. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="2EED02CB-5C0E-4DC1-AE94-4FAA3A30F51A"'
		If Not IsDbNull(r.Fields("POZNAMKA").Value) Then Hodnoceni.Text = CStr(r.Fields("POZNAMKA").Value) & " úspìnost"
		r.Close()
		
		'UPGRADE_WARNING: Couldn't resolve default property of object PomCol.Item(). Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="6A50421D-15FE-4896-8A1B-2EC21E9037B2"'
		r.Open("SELECT * FROM VAZBY, ZKOUSENI_RADKY, ZKOUSENI_HLAVICKY WHERE ZKOUSENI_RADKY.HLAVICKA_ID = " & PomCol.Item((Hlavicka.SelectedIndex) + 1) & " AND ZKOUSENI_RADKY.VAZBA_ID = VAZBY.VAZBA_ID AND ZKOUSENI_HLAVICKY.HLAVICKA_ID = ZKOUSENI_RADKY.HLAVICKA_ID ORDER BY ZKOUSENI_RADKY.RADEK_ID", SConn, ADODB.CursorTypeEnum.adOpenStatic,  , ADODB.CommandTypeEnum.adCmdText)
		For I = 0 To r.RecordCount - 1
			If r.Fields("SMER").Value = "z èetiny" Then
                If r.Fields("VYSLEDEK").Value = Utils.SPRAVNE And Vse.Checked Then
                    Radky.Items.Add(CStr(I + 1) & ". " & r.Fields("EKVIVALENT").Value & " = " & r.Fields("CESKY").Value)
                ElseIf r.Fields("VYSLEDEK").Value <> Utils.SPRAVNE Then
                    Radky.Items.Add(CStr(I + 1) & ". " & r.Fields("EKVIVALENT").Value & " = " & r.Fields("ODPOVED").Value & " (" & r.Fields("CESKY").Value & ")")
                End If
			Else
                If r.Fields("VYSLEDEK").Value = Utils.SPRAVNE And Vse.Checked Then
                    Radky.Items.Add(CStr(I + 1) & ". " & r.Fields("CESKY").Value & " = " & r.Fields("EKVIVALENT").Value)
                ElseIf r.Fields("VYSLEDEK").Value <> Utils.SPRAVNE Then
                    Radky.Items.Add(CStr(I + 1) & ". " & r.Fields("CESKY").Value & " = " & r.Fields("ODPOVED").Value & " (" & r.Fields("EKVIVALENT").Value & ")")
                End If
				
			End If
			r.MoveNext()
		Next I
		Zkouseni.Text = r.RecordCount & " vazeb"
		r.Close()
	End Sub
End Class