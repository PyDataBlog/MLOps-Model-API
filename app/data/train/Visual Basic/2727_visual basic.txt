


Public Class frmAddEditPoleLocations

#Region "Properties"

    Public Property IsAdding As Boolean
    Public Property MustUpdate As Boolean
    Public Property CurrentID As Integer

#End Region

#Region "Helper"

    Private Function VerifyInput(errProve As ErrorProvider) As Boolean

        For Each cntrl As Control In Me.Controls
            If TypeOf cntrl Is TextBox Then
                If cntrl.Text.Length <= 0 Then
                    VerifyInput = False
                    errProve.SetError(cntrl, "This is required. Please enter required data.")
                    Return VerifyInput
                    Exit Function
                End If
            End If
        Next

        Return True

    End Function

#End Region

#Region "Database"

    Private Function GetDataForCombo() As Boolean

        Dim newDal As New DataAccessLayer.DAL
        Dim theTable As New DataTable

        Try

            With newDal
                .DatabasePath = Application.StartupPath
                .DatabaseName = My.Settings.DatabaseName
                .OleCommandType = CommandType.StoredProcedure
                .OleCommandText = "qryGetPoleTypeForCombo"

                theTable = .DALGetDataAndReturnDataTable()

                Me.cboPoleType.DisplayMember = "TypeDesc"
                Me.cboPoleType.ValueMember = "PID"
                Me.cboPoleType.DataSource = theTable

            End With

            newDal = Nothing
        Catch ex As Exception
            Debug.Print("Error GetDataForCombo: " & ex.Message & vbCrLf & ex.StackTrace)
            newDal = Nothing
        End Try

        Return True

    End Function

    Private Function AddModify(boolAction As Boolean) As Boolean

        Dim newDal As New DataAccessLayer.DAL
        Dim paramList As New Dictionary(Of String, String)
        Dim boolReturn As Boolean
        Try

            With newDal
                .DatabasePath = Application.StartupPath
                .DatabaseName = My.Settings.DatabaseName
                .OleCommandType = CommandType.StoredProcedure
                If boolAction = True Then
                    .OleCommandText = "qryAddPoleLocation"
                Else
                    .OleCommandText = "qryModifyPoleLocation"
                End If

                'add parameters / values
                With paramList

                    .Add("PoleLocation", Me.txtPoleLocation.Text)
                    .Add("PoleType", Me.cboPoleType.Text)
                    .Add("PoleAddress", (Me.txtAddress.Text))
                    .Add("Longitude", (Me.txtLongitude.Text))
                    .Add("Latitude", Me.txtLatitude.Text)
                    .Add("LocationRemarks", Me.txtRemarks.Text)
                    .Add("ModifiedBy", CurrentUserName)
                    .Add("BranchCode", My.Settings.BranchCode)
                    If Me.IsAdding = True Then
                        '.Add("IntAction", 0)
                        '.Add("TheID", 0)
                    Else
                        '.Add("IntAction", 1)
                        .Add("PLID", Me.CurrentID)
                    End If
                End With

                If .DALSingleExecuteNonQuery(paramList) = True Then
                    boolReturn = True
                Else
                    boolReturn = False
                End If

            End With

            newDal = Nothing
        Catch ex As Exception
            Debug.Print("Error AddModify: " & ex.Message & vbCrLf & ex.StackTrace)
            newDal = Nothing
        End Try

        Return boolReturn

    End Function

#End Region

    Private Sub cmdClose_Click(sender As Object, e As EventArgs) Handles cmdClose.Click
        Me.MustUpdate = False
        Me.Close()
    End Sub

    Private Sub frmTransTemplate_KeyUp(sender As Object, e As KeyEventArgs) Handles Me.KeyUp
        Select Case e.KeyCode
            Case Keys.Enter
                SendKeys.Send(vbTab)
        End Select
    End Sub

    Private Sub cmdSave_Click(sender As Object, e As EventArgs) Handles cmdSave.Click
        If VerifyInput(Me.errProve) = True Then

        Else
            Exit Sub
        End If

        If Me.IsAdding = True Then
            If Me.AddModify(True) = True Then
                MessageBox.Show("Done saving new pole location.", "New pole location.")
                Me.MustUpdate = True
                Me.Close()
            Else

            End If
        Else
            If Me.AddModify(False) = True Then
                MessageBox.Show("Done saving  pole location.", "Modify pole location.")
                Me.MustUpdate = True
                Me.Close()
            Else

            End If
        End If
    End Sub

    Private Sub frmTransTemplate_Shown(sender As Object, e As EventArgs) Handles Me.Shown
        Me.Text = "Modify pole location. " & Me.CurrentID

        GetDataForCombo()
        If Me.IsAdding = True Then
            Me.cboPoleType.SelectedValue = -1
        Else
            Me.cboPoleType.Text = Me.cboPoleType.Tag
        End If
    End Sub



End Class