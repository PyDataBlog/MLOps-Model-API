Namespace DAL.Cache

    Public Module _Cache

        Private _CharacterInstance As Models.CharacterInstance = Nothing

        Private _CacheLocation As String = ""

        Public ReadOnly Property CacheLocation As String
            Get
                If _CacheLocation.IsNotSet() Then
                    _CacheLocation = APRBase.Settings.Directory(APRBase.BaseDirectory.DropBox)
                    If _CacheLocation.IsSet() AndAlso IO.Directory.Exists(_CacheLocation) Then
                        _CacheLocation = "{0}\Applications\Cache\WoWEquip\".FormatWith(_CacheLocation)
                    Else
                        _CacheLocation = "{0}Cache\".FormatWith(APRBase.Settings.Directory(APRBase.BaseDirectory.ExecutingAssembly))
                    End If

                    If Not IO.Directory.Exists(_CacheLocation) Then
                        IO.Directory.CreateDirectory(_CacheLocation)
                    End If
                End If
                Return _CacheLocation
            End Get
        End Property

        Public ReadOnly Property CharacterInstance As Models.CharacterInstance
            Get
                If _CharacterInstance Is Nothing Then
                    _CharacterInstance = New Models.CharacterInstance()
                End If
                Return _CharacterInstance
            End Get
        End Property

        Public Sub Close()
            Using APRBase.Performance.StartCounter("DAL.Cache", "Close")
                APRBase.Data.JSON.SaveSingle(Of Models.CharacterInstance)("{0}CharacterInstance.JSON".FormatWith(CacheLocation), _CharacterInstance)

                Character.Close()
            End Using
        End Sub

        Public Sub Open()
            Using APRBase.Performance.StartCounter("DAL.Cache", "Open")
                _CharacterInstance = APRBase.Data.JSON.LoadSingle(Of Models.CharacterInstance)("{0}CharacterInstance.JSON".FormatWith(CacheLocation))

                Character.Open()
            End Using
        End Sub

    End Module

End Namespace