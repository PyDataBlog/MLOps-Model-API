Option Strict Off
Option Explicit On
Friend Class Form1
	Inherits System.Windows.Forms.Form
	
	Dim filename As String ' wave file to play
	Dim errStr As New VB6.FixedLengthString(200) ' buffer for retrieving error messages
	Dim waveForm As Form2 ' form to draw wavegraph on
	Const MAX_SCROLL_VALUE As Short = 1000 ' range for scroll controls
	
	Private Sub Form1_Load(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles MyBase.Load
		' Initialize form, create wavegraph form
		Module1.fFileLoaded = False
		CommonDialog1Open.FileName = "*.wav"
		CommonDialog1Open.DefaultExt = "wav"
		waveForm = New Form2
		waveForm.SetBounds(VB6.TwipsToPixelsX(VB6.PixelsToTwipsX(Me.Left)), VB6.TwipsToPixelsY(VB6.PixelsToTwipsY(Me.Top) + VB6.PixelsToTwipsY(Me.Height)), VB6.TwipsToPixelsX(VB6.PixelsToTwipsX(Me.Width)), VB6.TwipsToPixelsY(VB6.PixelsToTwipsY(Me.Height) * 1.5))
		VB6.ShowForm(waveForm, 0, Me)
		HScroll1.Maximum = (MAX_SCROLL_VALUE + HScroll1.LargeChange - 1)
		HScroll2.Maximum = (MAX_SCROLL_VALUE + HScroll2.LargeChange - 1)
		HScroll2.Value = MAX_SCROLL_VALUE
	End Sub
	
	Private Sub Command1_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Command1.Click
		'Open a wavefile and initialize the form
		CommonDialog1Open.ShowDialog()
		filename = CommonDialog1Open.FileName
		Text1.Text = filename
		LoadFile(filename)
		Module1.drawFrom = 0
		Module1.drawTo = Module1.numSamples
		HScroll1.Value = 0
		HScroll2.Value = MAX_SCROLL_VALUE
		waveForm.DrawWaves()
	End Sub
	
	Private Sub Command2_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Command2.Click
		' Start playing the wavefile
		If (Module1.fPlaying = False) Then
			' -1 specifies the wave mapper
			Play(-1)
		End If
	End Sub
	
	Private Sub Command3_Click(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Command3.Click
		' Stop playing the wavefile
		StopPlay()
	End Sub
	
	'UPGRADE_NOTE: HScroll1.Change was changed from an event to a procedure. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="4E2DC008-5EDA-4547-8317-C9316952674F"'
	'UPGRADE_WARNING: HScrollBar event HScroll1.Change has a new behavior. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="6BA9B8D2-2A32-4B6E-8D36-44949974A5B4"'
	Private Sub HScroll1_Change(ByVal newScrollValue As Integer)
		' Set beginning position in wave file
		If newScrollValue >= HScroll2.Value Then
			newScrollValue = HScroll2.Value - 1
		End If
		SetPlayRange()
	End Sub
	
	'UPGRADE_NOTE: HScroll2.Change was changed from an event to a procedure. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="4E2DC008-5EDA-4547-8317-C9316952674F"'
	'UPGRADE_WARNING: HScrollBar event HScroll2.Change has a new behavior. Click for more: 'ms-help://MS.VSCC.v90/dv_commoner/local/redirect.htm?keyword="6BA9B8D2-2A32-4B6E-8D36-44949974A5B4"'
	Private Sub HScroll2_Change(ByVal newScrollValue As Integer)
		' Set end position in wave file
		If newScrollValue <= HScroll1.Value Then
			newScrollValue = HScroll1.Value + 1
		End If
		SetPlayRange()
	End Sub
	
	Private Sub SetPlayRange()
		' Set the range to be played and redraw the wave graph
		Module1.drawFrom = CInt(Module1.numSamples * (HScroll1.Value / MAX_SCROLL_VALUE))
		Module1.drawTo = CInt(Module1.numSamples * (HScroll2.Value / MAX_SCROLL_VALUE))
		waveForm.DrawWaves()
	End Sub
	
	Private Sub Timer1_Tick(ByVal eventSender As System.Object, ByVal eventArgs As System.EventArgs) Handles Timer1.Tick
		If Module1.fPlaying = False Then
			Module1.CloseWaveOut()
			Timer1.Enabled = False
		End If
	End Sub
	Private Sub HScroll1_Scroll(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.ScrollEventArgs) Handles HScroll1.Scroll
		Select Case eventArgs.type
			Case System.Windows.Forms.ScrollEventType.EndScroll
				HScroll1_Change(eventArgs.newValue)
		End Select
	End Sub
	Private Sub HScroll2_Scroll(ByVal eventSender As System.Object, ByVal eventArgs As System.Windows.Forms.ScrollEventArgs) Handles HScroll2.Scroll
		Select Case eventArgs.type
			Case System.Windows.Forms.ScrollEventType.EndScroll
				HScroll2_Change(eventArgs.newValue)
		End Select
	End Sub
End Class