'This proglam is using some samplecode
'Copyright(c) 2016 DOBON! <https://dobon.net>
'This proglam is maked by mk araki (mk apps)
'Copyright (c) 2017 mk apps

Imports System.Runtime.InteropServices

Public Class Main

	<DllImport("KERNEL32.DLL")>
	Public Shared Function WritePrivateProfileString(
ByVal lpAppName As String,
ByVal lpKeyName As String,
ByVal lpString As String,
ByVal lpFileName As String) As Integer
	End Function

	<DllImport("KERNEL32.DLL", CharSet:=CharSet.Auto)>
	Public Shared Function GetPrivateProfileString(
ByVal lpAppName As String,
ByVal lpKeyName As String, ByVal lpDefault As String,
ByVal lpReturnedString As System.Text.StringBuilder, ByVal nSize As Integer,
ByVal lpFileName As String) As Integer
	End Function

	<DllImport("KERNEL32.DLL", CharSet:=CharSet.Auto)>
	Public Shared Function GetPrivateProfileInt(
ByVal lpAppName As String,
ByVal lpKeyName As String, ByVal nDefault As Integer,
ByVal lpFileName As String) As Integer
	End Function

	Public MAC As String
	Public WritableMAC As String

    Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        If listmode = True Then
            box_ipaddr.ReadOnly = True
            numpad_ok.Enabled = False
            numpad_clear.Enabled = False
            numpad_dot.Enabled = False
            numpad_9.Enabled = False
            numpad_8.Enabled = False
            numpad_7.Enabled = False
            numpad_6.Enabled = False
            numpad_5.Enabled = False
            numpad_4.Enabled = False
            numpad_3.Enabled = False
            numpad_2.Enabled = False
            numpad_1.Enabled = False
            numpad_0.Enabled = False
            key_ipv6.Enabled = False
            box_mac.ReadOnly = False
            box_inf.ReadOnly = False
            Button1.Enabled = True
            Text = "ListEditmode -IPAddressManager"
        Else
            If editmode = True Then
                box_mac.ReadOnly = False
                box_inf.ReadOnly = False
                Button1.Enabled = True
                Text = "Editmode -IPAddressManager"
            ElseIf editmode = False Then
                box_mac.ReadOnly = True
                box_inf.ReadOnly = True
                Button1.Enabled = False
                Text = "Viewmode -IPAddressManager"
            End If
        End If
    End Sub

    Private Sub open_iprange_Click(sender As Object, e As EventArgs) Handles open_iprange.Click
        show_iprange.Show()
    End Sub

    Private Sub numpad_0_Click(sender As Object, e As EventArgs) Handles numpad_0.Click
        box_ipaddr.Text = box_ipaddr.Text + "0"
    End Sub

    Private Sub numpad_1_Click(sender As Object, e As EventArgs) Handles numpad_1.Click
        box_ipaddr.Text = box_ipaddr.Text + "1"
    End Sub

    Private Sub numpad_2_Click(sender As Object, e As EventArgs) Handles numpad_2.Click
        box_ipaddr.Text = box_ipaddr.Text + "2"
    End Sub

    Private Sub numpad_9_Click(sender As Object, e As EventArgs) Handles numpad_9.Click
        box_ipaddr.Text = box_ipaddr.Text + "9"
    End Sub

    Private Sub numpad_8_Click(sender As Object, e As EventArgs) Handles numpad_8.Click
        box_ipaddr.Text = box_ipaddr.Text + "8"
    End Sub

    Private Sub numpad_4_Click(sender As Object, e As EventArgs) Handles numpad_4.Click
        box_ipaddr.Text = box_ipaddr.Text + "4"
    End Sub

    Private Sub numpad_5_Click(sender As Object, e As EventArgs) Handles numpad_5.Click
        box_ipaddr.Text = box_ipaddr.Text + "5"
    End Sub

    Private Sub numpad_6_Click(sender As Object, e As EventArgs) Handles numpad_6.Click
        box_ipaddr.Text = box_ipaddr.Text + "6"
    End Sub

    Private Sub numpad_7_Click(sender As Object, e As EventArgs) Handles numpad_7.Click
        box_ipaddr.Text = box_ipaddr.Text + "7"
    End Sub

    Private Sub numpad_3_Click(sender As Object, e As EventArgs) Handles numpad_3.Click
        box_ipaddr.Text = box_ipaddr.Text + "3"
    End Sub

    Private Sub numpad_clear_Click(sender As Object, e As EventArgs) Handles numpad_clear.Click
        Dim textnow As Integer = box_ipaddr.Text.Length
        If textnow = 0 Then
        Else
            box_ipaddr.Text = box_ipaddr.Text.Substring(0, textnow - 1)
        End If
    End Sub

    Private Sub numpad_ok_Click(sender As Object, e As EventArgs) Handles numpad_ok.Click
        box_mac.Text = ""
        box_inf.Text = ""

        Dim openingfile As String = box_ipaddr.Text.Replace(":", ".")

        If box_ipaddr.Text = "" Then
            MessageBox.Show("Not selected IPAddress", "Error")
            Exit Sub
        End If

        If System.IO.File.Exists(ipinfodir + "\" + openingfile + ".ini") = True Then
            Dim macaddr As System.Text.StringBuilder
            Dim addrinfo As System.Text.StringBuilder
            addrinfo = New System.Text.StringBuilder
            macaddr = New System.Text.StringBuilder

            addrinfo.Capacity = 32767

            GetPrivateProfileString("IPAddressInfo", "MAC", "default", macaddr, macaddr.Capacity, ipinfodir + "\" + openingfile + ".ini")
            GetPrivateProfileString("IPAddressInfo", "Info", "default", addrinfo, addrinfo.Capacity, ipinfodir + "\" + openingfile + ".ini")

            MAC = macaddr.ToString
            Try
                box_mac.Text = MAC.Substring(0, 2) + ":" + MAC.Substring(2, 2) + ":" + MAC.Substring(4, 2) + ":" + MAC.Substring(6, 2) + ":" + MAC.Substring(8, 2) + ":" + MAC.Substring(10, 2)
            Catch ab_err As System.ArgumentOutOfRangeException
                box_mac.Text = "00:00:00:00:00:00"
            End Try
            box_inf.Text = addrinfo.ToString
        Else
            box_mac.Text = "00:00:00:00:00:00"
        End If
    End Sub

    Private Sub numpad_dot_Click(sender As Object, e As EventArgs) Handles numpad_dot.Click
        box_ipaddr.Text = box_ipaddr.Text + "."
    End Sub

    Private Sub apply_Click(sender As Object, e As EventArgs) Handles apply.Click
        Dim openingfile As String = box_ipaddr.Text.Replace(":", ".")
        If openingfile = "" Then
            MessageBox.Show("IPaddress not selected", "Error")
            Exit Sub
        End If

        If box_mac.Text.Length = 12 Then
            box_mac.Text = box_mac.Text.Substring(0, 2) + ":" + box_mac.Text.Substring(2, 2) + ":" + box_mac.Text.Substring(4, 2) + ":" + box_mac.Text.Substring(6, 2) + ":" + box_mac.Text.Substring(8, 2) + ":" + box_mac.Text.Substring(10, 2)
        End If
        box_mac.Text = box_mac.Text.Replace("a", "A")
        box_mac.Text = box_mac.Text.Replace("b", "B")
        box_mac.Text = box_mac.Text.Replace("c", "C")
        box_mac.Text = box_mac.Text.Replace("d", "D")
        box_mac.Text = box_mac.Text.Replace("e", "E")
        box_mac.Text = box_mac.Text.Replace("f", "F")
        If System.Text.RegularExpressions.Regex.IsMatch(box_mac.Text, "[1234567890ABCDEF][1234567890ABCDEF]:[1234567890ABCDEF][1234567890ABCDEF]:[1234567890ABCDEF][1234567890ABCDEF]:[1234567890ABCDEF][1234567890ABCDEF]:[1234567890ABCDEF][1234567890ABCDEF]:[1234567890ABCDEF][1234567890ABCDEF]") Then
            MAC = box_mac.Text
            WritableMAC = MAC.Substring(0, 2) + MAC.Substring(3, 2) + MAC.Substring(6, 2) + MAC.Substring(9, 2) + MAC.Substring(12, 2) + MAC.Substring(15, 2)
            WritePrivateProfileString("IPAddressInfo", "MAC", WritableMAC, ipinfodir + "\" + openingfile + ".ini")
            WritePrivateProfileString("IPAddressInfo", "Info", box_inf.Text, ipinfodir + "\" + openingfile + ".ini")
        Else
            MessageBox.Show("MAC Address Error" + Environment.NewLine + "Good example AA:BB:CC:DD:EE:FF", "Error")
        End If

    End Sub

    Private Sub box_inf_TextChanged(sender As Object, e As EventArgs) Handles box_inf.TextChanged

    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        MACKey.Show()
    End Sub

    Private Sub key_ipv6_Click(sender As Object, e As EventArgs) Handles key_ipv6.Click
        IPv6Key.Show()
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        Dim pingprogless As New Process()
        pingprogless.StartInfo.FileName = Environment.GetEnvironmentVariable("ComSpec")
        pingprogless.StartInfo.UseShellExecute = False
        pingprogless.StartInfo.RedirectStandardOutput = True
        pingprogless.StartInfo.RedirectStandardInput = False
        pingprogless.StartInfo.CreateNoWindow = True
        pingprogless.StartInfo.Arguments = "/Q /D /C ping -n 2 -l 4 " + box_ipaddr.Text
        pingprogless.Start()
        Dim pingresult As String = pingprogless.StandardOutput.ReadToEnd()
        pingprogless.WaitForExit()
		pingprogless.Close()
        MessageBox.Show(pingresult, "Ping results - " + box_ipaddr.Text)
    End Sub

    Private Sub box_mac_TextChanged(sender As Object, e As EventArgs) Handles box_mac.TextChanged

    End Sub
End Class
