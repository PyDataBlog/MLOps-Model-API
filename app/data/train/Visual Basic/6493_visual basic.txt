' DataTable2CSV - Saving a DataTable to a CSV file 
' Save the input DataTable to a CSV file. By default the values are Tab 
' delimited, but you can use the second overload version to use any other 
' string you want.
'
' Example:
'    Dim ds As New DataSet
'    SqlDataAdapter1.Fill(ds, "Users")
'    DataTable2CSV(ds.Tables("Users"), "D:\Users.txt")



Public Class LibCsvExport

    Sub DataTable2CSV(ByVal table As Data.DataTable, ByVal filename As String)
        DataTable2CSV(table, filename, ";"c)
    End Sub

    Sub DataTable2CSV(ByVal table As Data.DataTable, ByVal filename As String, ByVal sepChar As String)
        Dim writer As New System.IO.StreamWriter(filename)
        Try
            ' first write a line with the columns name
            Dim sep As String = String.Empty
            Dim builder As New System.Text.StringBuilder
            For Each col As Data.DataColumn In table.Columns
                builder.Append(sep).Append(col.ColumnName)
                sep = sepChar
            Next
            writer.WriteLine(builder.ToString())

            ' then write all the rows
            For Each row As Data.DataRow In table.Rows
                sep = String.Empty
                builder = New System.Text.StringBuilder

                For Each col As Data.DataColumn In table.Columns
                    builder.Append(sep).Append(row(col.ColumnName))
                    sep = sepChar
                Next
                writer.WriteLine(builder.ToString())
            Next
        Finally
            If Not writer Is Nothing Then writer.Close()
        End Try
    End Sub

End Class
