Public Class PluginManagerForm
    Private Sub PluginManagerForm_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        Dim config As SettingBlockCollection = SettingManager.LoadSettingsFromFile("Plugins\Plugins.ini")
        For Each c In config.Values
            Dim path As String = c("Path").Value
            Dim enabled As String = c("Enabled").Value.ToString
            Dim it As New ListViewItem
            Dim filename As String = path.Substring(path.LastIndexOf("\") + 1)
            it.Text = filename.Substring(0, filename.Length - 4)
            it.SubItems.Add(path)
            it.SubItems.Add(enabled)
            ListView1.Items.Add(it)
        Next
    End Sub

    Private Sub Button4_Click(sender As Object, e As EventArgs) Handles Button4.Click
        Close()
    End Sub

    Private Sub Button5_Click(sender As Object, e As EventArgs) Handles Button5.Click
        ListView1.SelectedItems(0).SubItems(2).Text = (Not Boolean.Parse(ListView1.SelectedItems(0).SubItems(2).Text)).ToString
    End Sub

    Private Sub Button2_Click(sender As Object, e As EventArgs) Handles Button2.Click
        ListView1.SelectedItems(0).Remove()
    End Sub

    Private Sub Button3_Click(sender As Object, e As EventArgs) Handles Button3.Click
        Dim config As New SettingBlockCollection
        For Each it As ListViewItem In ListView1.Items
            Dim path As String = it.SubItems(1).Text
            Dim enabled As Boolean = Boolean.Parse(it.SubItems(2).Text)
            Dim block As New SettingBlock
            Dim filename As String = path.Substring(path.LastIndexOf("\") + 1)
            block.Name = filename.Substring(0, filename.Length - 4)
            block("Path") = New Setting("string", path)
            block("Enabled") = New Setting("boolean", enabled)
            config(block.Name) = block
        Next
        SettingManager.SaveSettingsToFile(config, "Plugins\Plugins.ini")
        Close()
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles Button1.Click
        Dim path As String = InputBox("输入路径：")
        Dim it As New ListViewItem
        Dim filename As String = path.Substring(path.LastIndexOf("\") + 1)
        it.Text = filename.Substring(0, filename.Length - 4)
        it.SubItems.Add(path)
        it.SubItems.Add("True")
        ListView1.Items.Add(it)
    End Sub

    Private Sub ListView1_SelectedIndexChanged(sender As Object, e As EventArgs) Handles ListView1.SelectedIndexChanged
        If ListView1.SelectedItems.Count > 0 Then
            Dim desc As String = PluginManager.Plugins(ListView1.SelectedItems(0).Text).DescriptionFile
            If desc <> "" Then
                RichTextBox1.LoadFile(desc, RichTextBoxStreamType.RichText)
            Else
                RichTextBox1.Clear()
            End If
        End If
    End Sub
End Class