Public Class UC_User

    Sub BindData()
        Dim a As New c_User
        DS = a.GetAllUser
        DGV.DataSource = DS.Tables(0)
        DGV.ReadOnly = True
        LBLShowing.Text = DGV.RowCount - 1 & " Items"
    End Sub

    Private Sub UC_User_Load(sender As Object, e As EventArgs) Handles MyBase.Load
        BindData()
        LBLTitle.Text = "User Management"
    End Sub

    Private Sub txtSearch_TextChanged(sender As Object, e As EventArgs) Handles txtSearch.TextChanged
        Dim a As New c_User
        DS = a.SearchUser(txtSearch.Text)
        DGV.DataSource = DS.Tables(0)
        DGV.ReadOnly = True
        LBLShowing.Text = DGV.RowCount - 1 & " Items"
    End Sub

    Private Sub btnAdd_Click(sender As Object, e As EventArgs) Handles btnAdd.Click
        With User_Entry
            .strUser = "add"
            .Show(Me)
        End With
    End Sub

    Private Sub dgv_CellMouseUp(sender As Object, e As DataGridViewCellMouseEventArgs) Handles DGV.CellMouseUp
        On Error Resume Next
        If e.Button = Windows.Forms.MouseButtons.Right Then
            Me.dgv.Rows(e.RowIndex).Selected = True
            Me.dgv.CurrentCell = dgv.Rows(e.RowIndex).Cells(1)
            Me.ContextMenuStrip1.Show(Me.dgv, e.Location)
            Me.ContextMenuStrip1.Show(Cursor.Position)
        End If
    End Sub

    Private Sub DeleteToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles DeleteToolStripMenuItem.Click
        If MessageBox.Show("Are you sure ? This user will be deleted permanently", "", MessageBoxButtons.OKCancel, MessageBoxIcon.Warning) = DialogResult.OK Then
            Try
                Dim row As Integer = DGV.CurrentCell.RowIndex
                Dim username As String = DGV.Rows(row).Cells(0).Value

                Dim a As New c_User
                Dim message As String = a.DeleteUser(username)
                If message = "Delete Success" Then
                    MsgBox(message, MsgBoxStyle.Information, "")
                    WriteLog("User", "Delete User Success")
                    BindData()
                Else
                    MsgBox("Error : " & vbNewLine & message, MsgBoxStyle.Exclamation, "")
                End If
            Catch ex As Exception
                MsgBox("Error : " & vbNewLine & ex.Message, MsgBoxStyle.Exclamation, "")
                WriteLog("User", ex.Message)
            End Try
        End If
    End Sub

    Private Sub EditToolStripMenuItem_Click(sender As Object, e As EventArgs) Handles EditToolStripMenuItem.Click
        Try
            Dim row As Integer = DGV.CurrentCell.RowIndex
            Dim username As String = DGV.Rows(row).Cells(0).Value
            Dim dtSource As DataTable

            Dim c As New c_User
            DS = c.GetDetail(username)
            dtSource = DS.Tables(0)

            With User_Entry
                .txtUsername.Text = dtSource.Rows(0).Item("username").ToString
                .txtName.Text = dtSource.Rows(0).Item("nama_login").ToString
                .cb_Level.SelectedItem = dtSource.Rows(0).Item("level_akses").ToString
                .txtPassword.Text = dtSource.Rows(0).Item("pwd").ToString
                .txtConfirm.Text = dtSource.Rows(0).Item("pwd").ToString

                .Show(Me)
            End With
        Catch ex As Exception
            WriteLog("User", ex.Message)
        End Try

    End Sub

    Private Sub btnBack_Click(sender As Object, e As EventArgs) Handles btnBack.Click
        menu_utama.PNLUtama.Controls.Clear()
        Dim a As New UC_MasterData
        a.Dock = DockStyle.Fill
        menu_utama.PNLUtama.Controls.Add(a)
    End Sub
End Class
