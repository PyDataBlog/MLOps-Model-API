Public Class Form4
    Dim sourcecode As String
    Dim safe As Boolean = False
    Private Sub Form4_FormClosed(ByVal sender As Object, ByVal e As System.Windows.Forms.FormClosedEventArgs) Handles Me.FormClosed
        If Not safe Then End
    End Sub

    Private Sub Form4_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load

    End Sub

    Private Sub Form4_Shown(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Shown
        BackgroundWorker1.RunWorkerAsync()
    End Sub

    Private Sub Button1_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Button1.Click
        If Button1.Text = "OK" Then
            safe = Not False
            Me.Close()
        Else
            Process.Start("http://groxpsm.tk")
            safe = Not True
            End
        End If
    End Sub

    Private Sub BackgroundWorker1_DoWork(ByVal sender As System.Object, ByVal e As System.ComponentModel.DoWorkEventArgs) Handles BackgroundWorker1.DoWork
        Dim request As System.Net.HttpWebRequest = System.Net.HttpWebRequest.Create("http://repo.groxpsm.tk/psm/version")
        Debug.Print("Sent request")
        Dim response As System.Net.HttpWebResponse = request.GetResponse()
        Debug.Print("Received response")
        Dim sr As System.IO.StreamReader = New System.IO.StreamReader(response.GetResponseStream())
        Debug.Print("Stream created")
        sourcecode = sr.ReadToEnd()
        Debug.Print("Stream read")
    End Sub

    Private Sub BackgroundWorker1_RunWorkerCompleted(ByVal sender As Object, ByVal e As System.ComponentModel.RunWorkerCompletedEventArgs) Handles BackgroundWorker1.RunWorkerCompleted
        If My.Settings.Version.StartsWith(sourcecode) Then
            Label1.Text = "Your PSM version is up-to-date"
            Button1.Text = "OK"
        Else
            Label1.Text = "Your PSM version is out-of-date! Update at http://groxpsm.tk"
            Button1.Text = "Update"
        End If
        Button1.Enabled = True
    End Sub
End Class