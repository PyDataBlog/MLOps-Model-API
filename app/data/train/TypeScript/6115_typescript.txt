import * as React from 'react'
import {Router, Route, browserHistory, IndexRoute} from 'react-router'
import {syncHistoryWithStore} from 'react-router-redux'
import {InlineStyles} from '../Containers/InlineStyles'
import {WelcomePage} from '../Containers/WelcomePage'
import {NoMatch} from '../Containers/NoMatch'
import {Login} from '../Containers/Login'
import {Chat} from '../Containers/Chat'
import {App} from '../Containers/App'
import {store} from './ConfigureStore'

export class Routing extends React.Component<void, {}> {
    history: any;
    routerConfig: any

    constructor() {
        super();

        this.history = syncHistoryWithStore(browserHistory, store)
        this.authorizeOnEnter = this.authorizeOnEnter.bind(this)

        this.routerConfig = (
            <Router history={this.history}>
                <Route path="/" component={App}>
                    <IndexRoute component={WelcomePage}/>
                    <Route path="/login" component={Login}/>
                    <Route path="/style" component={InlineStyles}/>
                    <Route path="/chat" component={Chat} onEnter={this.authorizeOnEnter}/>
                    <Route path="*" component={NoMatch}/>
                </Route>
            </Router>
        )
    }

    authorizeOnEnter(nextState, replace): void {
        if (store.getState().LoginReducer.user.login === '') {
            alert('You must be logged!')
            replace('/login')
        }
    }

    render() {
        return (
            <div>
                {this.routerConfig}
            </div>
        )
    }
}
