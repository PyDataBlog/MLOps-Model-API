import * as React from 'react'
import format from 'date-fns/format'

import { createStyles, Theme } from '@material-ui/core/styles'
import { makeStyles } from '@material-ui/styles'

import ListItem from '@material-ui/core/ListItem'
import Typography from '@material-ui/core/Typography'

import Message from '../../../models/Message'
import { useInstance } from '../../../hooks'

const useStyles = makeStyles((theme: Theme) =>
	createStyles({
		root: {
			paddingTop: theme.spacing(1),
			paddingBottom: theme.spacing(1),
			justifySelf: 'stretch',
			alignItems: 'flex-start',
			justifyContent: 'space-between',
			whiteSpace: 'pre-wrap'
		},
		mainColumn: {
			overflow: 'hidden',
			paddingRight: theme.spacing(3)
		},
		content: {
			wordWrap: 'break-word'
		},
		infoColumn: {
			display: 'flex',
			flexDirection: 'column',
			alignItems: 'flex-end',
			flexShrink: 0
		},
		info: {
			fontSize: '0.75rem',
			color: theme.palette.text.secondary
		}
	})
)

interface Props {
	id: number
}

const MessageItem: React.SFC<Props> = props => {
	const { id } = props
	const classes = useStyles()
	const message = useInstance<Message>(id, 'messages')

	if (!message) return null

	const date = format(new Date(message.createdAt), 'd. M. yyyy, HH:mm')

	return (
		<ListItem className={classes.root}>
			<div className={classes.mainColumn}>
				<Typography className={classes.content}>
					{message.content}
				</Typography>
			</div>
			<div className={classes.infoColumn}>
				<Typography className={classes.info}>{date}</Typography>
				<Typography className={classes.info}>
					{message.userName}
				</Typography>
			</div>
		</ListItem>
	)
}

export default MessageItem
