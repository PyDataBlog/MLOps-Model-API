import * as React from 'react'
import {Persona, PersonaSize} from 'office-ui-fabric-react/lib/Persona'
import {UserMap, formatUrl} from 'yam-data'
import './UserAvatar.css'

export enum UserAvatarSize {
  tiny = 12,
  extraSmall = 32,
  small = 40,
  regular = 48,
  large = 72,
  extraLarge = 100
}

export interface UserAvatarProps {
  user: UserMap | undefined
  size?: UserAvatarSize
  showDetails?: boolean
}

const sizeMap = {
  [UserAvatarSize.tiny]: PersonaSize.tiny,
  [UserAvatarSize.extraSmall]: PersonaSize.extraSmall,
  [UserAvatarSize.small]: PersonaSize.small,
  [UserAvatarSize.regular]: PersonaSize.regular,
  [UserAvatarSize.large]: PersonaSize.large,
  [UserAvatarSize.extraLarge]: PersonaSize.extraLarge
}

export default class UserAvatar extends React.PureComponent<UserAvatarProps, {}> {
  public render () {
    const {user, size = UserAvatarSize.regular, showDetails = false} = this.props
    const actualSize = Math.round(size * window.devicePixelRatio)
    const name = user && user.get('name')
    const title = user && user.get('job_title')
    const imageUrl = user && user.get('mugshot_url')
    const formattedImageUrl = imageUrl && formatUrl(imageUrl, {width: actualSize, height: actualSize})

    return (
      <div className='yam-user-avatar'>
        <Persona
          size={sizeMap[size]}
          imageUrl={formattedImageUrl}
          imageShouldFadeIn={false}
          hidePersonaDetails={!showDetails}
          primaryText={name}
          secondaryText={title}
        />
      </div>
    )
  }
}
