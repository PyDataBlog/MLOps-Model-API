module AirbrakeJsNotifier
  class CommandLineTool
    def cwd
      File.expand_path(File.join(File.dirname(__FILE__), '../..'))
    end

    def expand(*paths)
      File.expand_path(File.join(*paths))
    end

    def template_path(filepath)
      expand(cwd, File.join("generators", "airbrake_js_notifier" ,"templates", filepath))
    end

    def dest_path(filepath)
      expand(Dir.pwd, filepath)
    end

    def copy_unless_exists(relative_path, dest_path = nil)
      unless File.exist?(dest_path(relative_path))
        FileUtils.copy(template_path(relative_path), dest_path(dest_path || relative_path))
      end
    end
    def process(argv)
      if argv[0] == 'init'
        require 'fileutils'

        FileUtils.mkdir_p('vendor/assets/javascripts')

        copy_unless_exists('vendor/assets/javascripts/airbrake.js')
        copy_unless_exists('app/assets/javascripts/airbrake_js_notifier.js', 'vendor/assets/javascripts/airbrake_js_notifier.js')
      else
        puts "unknown command #{argv}"
        puts "\tUsage: airbrake_js_notifier init"
      end
    end
  end
end