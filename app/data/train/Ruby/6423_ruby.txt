class TicketsController < ApplicationController

	def index	
		@tickets = Ticket.search_for(params[:search])
	end
	
	def auto_complete_search
  	begin
    	@items = Ticket.complete_for(params[:search])
  	rescue ScopedSearch::QueryNotSupported => e
    	@items = [{:error =>e.to_s}]
  	end
  	render :json => @items
	end
	
  def new
  	@ticket = Ticket.new
  end
 
  def create
		@ticket = Ticket.new(ticket_params)
		@ticket.assign_attributes({:user_id => current_user.id})
 		@ticket.assign_attributes({:state_id => 1})
 		
  	if @ticket.save
  		#redirect_to @ticket
  	else
  		render 'new'
  	end
  end
  
  def show
  	@ticket = Ticket.find(params[:id])
	end
	
	def edit
  	@ticket = Ticket.find(params[:id])
	end
	
	def update
  	@ticket = Ticket.find(params[:id])
 
  	if @ticket.update(ticket_params)
  	  #redirect_to @ticket
  	else
  	  render 'edit'
  	end
	end
	
	def destroy
  	@ticket = Ticket.find(params[:id])
  	@ticket.destroy
 
  	#redirect_to tickets_path
	end
  
  private
  	def ticket_params
    	params.require(:ticket).permit(:subject, :description, :owner_id, :type_id, :state_id, :urgency)
  	end

end
