
/*

main.c

*/

#define F_CPU   8000000

#include <stdio.h>
#include <string.h>

#include <util/delay.h>
#include <avr/interrupt.h>
#include <avr/io.h>

#include "../lib/ring_buffer.h"
#include "../lib/serial.h"

/*

Basic test of interrupt based serial functionality

*/ 

int main(void) {

    uart_init();
    sei(); 

    char buff[64];

    // Test that push string, and tx_wait work
    sprintf(buff, "Testing push_string with uart_tx_wait\n\r");
    rb_push_string(uart_tx_buffer, buff);
    uart_tx_wait();

    memset(buff, 0, 64);

    // Test that push string stops at \0
    sprintf(buff, "Testing push_string, Validate: Test == Test?123");
    buff[43] = 0;
    rb_push_string(uart_tx_buffer, buff);
    uart_tx_wait();

    memset(buff, 0, 64);

    // Test push array
    sprintf(buff, "\n\rTesting push_array, Validate: Test == Test\n\r");
    rb_push_array(uart_tx_buffer, buff, 47);
    uart_tx_wait();

    memset(buff, 0, 64);

    // Test that push string, and tx_wait work
    sprintf(buff, "Testing interrupt based uart_tx\n\r");
    rb_push_string(uart_tx_buffer, buff);
    uart_tx();

    _delay_ms(1000);
    return 0;
}