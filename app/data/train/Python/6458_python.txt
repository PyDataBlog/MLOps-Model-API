#!/usr/bin/env python

'''
Created on Jan 6, 2018

@author: consultit
'''

from panda3d.core import Filename
import sys, os
from subprocess import call

### NOTE: currently this script works only on GNU/Linux
currdir = os.path.abspath(sys.path[0])
builddir = Filename.from_os_specific(os.path.join(currdir, '/ely/')).get_fullpath()
elydir = Filename.fromOsSpecific(os.path.join(currdir, '/ely/')).getFullpath()
lpref = ''
mpref = ''
lsuff = '.so'
###

tools = 'libtools'
modules = ['ai', 'audio', 'control', 'physics']

if __name__ == '__main__':
    # cwd
    os.chdir(currdir + builddir)
    # build 'tools'
    libtools = lpref + tools + lsuff
    print('building "' + libtools + '" ...')
    toolsdir = '..' + elydir + tools
    args = ['build.py', '--dir', toolsdir, '--clean']
    call(['/usr/bin/python'] + args)
    #print('installing "' + libtools + '" ...')
    #args = [libtools, toolsdir]
    #call(['/usr/bin/install'] + args)
    # build modules
    for module in modules:
        modulelib = mpref + module + lsuff
        print('building "' + modulelib + '" ...')
        moduledir = '..' + elydir + module
        args = ['build.py', '--dir', moduledir, '--libs', libtools, '--libs_src', 
                toolsdir, '--clean']
        call(['/usr/bin/python'] + args)
        #print('installing "' + modulelib + '" ...')
        #args = [modulelib, moduledir]
        #call(['/usr/bin/install'] + args)
    