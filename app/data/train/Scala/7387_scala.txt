/*
 * Copyright 2013 Akiyoshi Sugiki, University of Tsukuba
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package kumoi.impl.aaa.ldap

import com.sleepycat.je._
import com.sleepycat.persist._
import com.sleepycat.persist.model._
import com.sleepycat.persist.model.Relationship._
import java.util.{UUID, Date}

//
//
// TODO: Identity of user (String? UUID?)
// TODO: Chained delete
//
//


/**
 * 
 * @author Akiyoshi SUGIKI
 */
@Entity class RoleEntity {
	@PrimaryKey(sequence="id") 
	var id = 0L
	
	@SecondaryKey(relate = ONE_TO_ONE) 
	var name = "" // Role name
	var description = "" // Role description
		
	// disabled: Users
}


/**
 * 
 * @author Akiyoshi SUGIKI
 */
@Entity class UserAclEntity {
	@PrimaryKey(sequence="id") 
	var id = 0L
	
	@SecondaryKey(relate = MANY_TO_ONE)
	var user = "" // User (subject)
		
	@SecondaryKey(relate = MANY_TO_ONE)
	var obj = "" // Object type

	var rights = "" // Access rights
}


/**
 * 
 * @author sugiki
 *
 */
@Entity class RoleAclEntity {
	@PrimaryKey(sequence="id") 
	var id = 0L
	
	@SecondaryKey(relate = MANY_TO_ONE)
	var role = "" // Role (subject)
		
	@SecondaryKey(relate = MANY_TO_ONE)
	var obj = "" // Object type
	
	var rights = "" // Access rights
}


/**
 * 
 * @author Akiyoshi SUGIKI
 */
@Entity class ObjectUserAclEntity {
	@PrimaryKey(sequence="id") 
	var id = 0L
	
	@SecondaryKey(relate = MANY_TO_ONE)
	var user = "" // User (subject)
		
	@SecondaryKey(relate = MANY_TO_ONE)
	var obj = "" // Object's UUID

	var rights = "" // Access rights
}


/**
 * 
 * @author Akiyoshi SUGIKI
 */
@Entity class ObjectRoleAclEntity {
	@PrimaryKey(sequence="id") 
	var id = 0L
	
	@SecondaryKey(relate = MANY_TO_ONE)
	var role = "" // Role (subject)
		
	@SecondaryKey(relate = MANY_TO_ONE)
	var obj = "" // Object's UUID

	var rights = "" // Access rights
}


/**
 * 
 * @author Akiyoshi SUGIKI
 */
@Entity class AuditEntity {
	@PrimaryKey(sequence="id") 
	var id = 0L
	
	@SecondaryKey(relate = MANY_TO_ONE) 
	var date: Date = null // Date
	@SecondaryKey(relate = MANY_TO_ONE) 
	var user = "" // User
	@SecondaryKey(relate = MANY_TO_ONE) 
	var host = "" // Host
	@SecondaryKey(relate = MANY_TO_ONE) 
	var uuid: UUID = null // Object (UUID)

	var op = "" // Operation
	var args = ""// Operation arguments
	var detail = "" // Operation details
		
	var success: Boolean = false // Operation result
}


/**
 * 
 * @author Akiyoshi SUGIKI
 */
@Entity class AccountEntity {
	@PrimaryKey(sequence="id") 
	var id = 0L
	
	@SecondaryKey(relate = MANY_TO_ONE)  
	var user = "" // User
	@SecondaryKey(relate = MANY_TO_ONE) 
	var uuid: UUID = null // Resource Object
	@SecondaryKey(relate = MANY_TO_ONE) 
	var resouce = "" // Specific resource name

	var consumed = 0L // Measured consumption
}


/**
 * 
 * @author Akiyoshi SUGIKI
 */
@Entity class RateEntity {
	@PrimaryKey(sequence="id") 
	var id = 0L
	
	@SecondaryKey(relate = ONE_TO_ONE)
	var name = "" // Accounting policy name
	
	var fixed = 0.0 // Fixed charge
	var rate = 0.0 // Rate charge
	var unit = "" // Charge Unit
}


/**
 * 
 * @author Akiyoshi SUGIKI
 */
@Entity class BillEntity {
	// TODO: user: String is OK?
	@PrimaryKey(sequence="id")
	var id = 0L
	
	@SecondaryKey(relate = ONE_TO_ONE)
	var user = "" // User
	
	var bill = 0L // Total bill
	var unit = "" // Bill unit
}