FROM phusion/baseimage:0.9.22

LABEL Description="A Python-based container for exploring data with Jupyter Notebook locally."

## Set up services
CMD ["/sbin/my_init"]

# Pull in Ubuntu packages
RUN apt-get -qq update && apt-get -qq -y install python3-pip python3-dev build-essential python3-tk

## Install jq for local munging
RUN curl -Ls https://github.com/stedolan/jq/releases/download/jq-1.5/jq-linux64 > jq
RUN mv ./jq /usr/local/bin
RUN chmod 755 /usr/local/bin/jq

## Install python packages in `requirements.txt`, set up `python`
## See (and update) `requirements.txt` for modifying which python libraries are installed.
WORKDIR /tmp/py-install
COPY requirements.txt /tmp/py-install
RUN pip3 install -r /tmp/py-install/requirements.txt
RUN ln -s /usr/bin/python3.5 /usr/bin/python

## Clean up ubuntu package cruft
RUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

## Set the root directory to be the exploratorium Docker Volume. This ensures that notebooks
## will be stored locally by Docker, even if you stop the specific container.
## *MAKE SURE* that you run `./setup` first to initialize this locally with Docker
WORKDIR /exploratorium

## Set up jupyter notebook to run locally
EXPOSE 8888
CMD jupyter notebook --ip=0.0.0.0 --allow-root --no-browser
