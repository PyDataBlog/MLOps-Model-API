From openjdk:8

MAINTAINER "John Celoria <john@celoria.net>"

ENV UNIFI_VERSION 3.7.3
ENV UNIFI_DIR /var/lib/unifi-video
ENV DEBIAN_FRONTEND noninteractive
ENV ENABLE_TMPFS no

ADD run.sh /run.sh

# Download and install unifi controller
RUN echo "force-unsafe-io" > /etc/dpkg/dpkg.cfg.d/02apt-speedup && \
    echo "Acquire::http {No-Cache=True;};" > /etc/apt/apt.conf.d/no-cache && \
    cd /tmp && apt-get update -y && apt-get -y install jsvc libcommons-daemon-java \
    sudo lsb-release mongodb-server mongodb-clients gdebi-core && \
    wget http://dl.ubnt.com/firmwares/unifi-video/${UNIFI_VERSION}/unifi-video_${UNIFI_VERSION}-Debian7_amd64.deb && \
    gdebi -n unifi-video_${UNIFI_VERSION}-Debian7_amd64.deb && \
    apt-get -y autoremove --purge wget && \
    apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* && \
    chmod 755 /run.sh

WORKDIR ${UNIFI_DIR}

# 1935 – RTMP streaming video to web UI & accepting gen1 camera video
# 1935, by user (RTMP video)
# 7443 – Controller web UI
# 7443, by user (HTTPS), by camera (HTTPS)
# 7080 – HTTP communication with cameras
# 7080, by user (HTTP), by camera (HTTP)
# 6666 – Live FLV for incoming gen2 camera streams
# 6666, by camera (video push)
# 7447 – RTSP re-streaming via controller
# The following ports are used on cameras:
# HTTP/HTTPS ports to access web interface (optional)
# SSH to facilitate adoption by the controller on LAN (optional)
# 554 RTSP server (mandatory only on gen1)
EXPOSE 7447 7446 1935 7443 7080 6666

VOLUME [ "${UNIFI_DIR}", "/var/log/unifi-video" ]

CMD ["/run.sh"]
