FROM ubuntu:16.04

ENV DEBIAN_FRONTEND noninteractive
WORKDIR /root/

RUN apt-get clean && apt-get update

# required for mysqlclient install
RUN apt-get install -y libmysqlclient-dev

# python library install
RUN apt-get install -y python3-pip

# upgrade pip version from 8.1.1 to 9.01
RUN pip3 install --upgrade pip

COPY requirements.txt ./

RUN pip3 install -r requirements.txt

# nginx install
COPY nginx.list /etc/apt/sources.list.d/
RUN apt-get install -y curl
RUN curl -sSLO  https://nginx.org/keys/nginx_signing.key && apt-key add nginx_signing.key
#RUN curl -sSL https://nginx.org/keys/nginx_signing.key | apt-key add -
RUN apt-get update
RUN apt-get install -y nginx
COPY nginx.conf /etc/nginx/nginx.conf
RUN mkdir /etc/nginx/sites-enabled

# sample01 application deployment
RUN mkdir /opt/sample01
COPY sample01 /opt/sample01/
RUN mkdir /var/log/uwsgi/

RUN ln -s /opt/sample01/sample01_nginx.conf /etc/nginx/sites-enabled/

COPY startapp.sh /root/
RUN chmod 755 /root/startapp.sh

EXPOSE 8080

CMD ["/root/startapp.sh"]

# for developer tool
RUN apt-get install -y vim less

# clean up
RUN rm -rf /var/lib/apt/lists
RUN rm -rf requirements.txt

