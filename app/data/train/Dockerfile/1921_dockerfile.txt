# Copyright 2015 Sean Nelson <audiohacked@gmail.com>
FROM debian:wheezy
MAINTAINER Sean Nelson <audiohacked@gmail.com>

# ENV BASE_URL http://media.steampowered.com/installer/steamcmd_linux.tar.gz
ENV BASE_URL https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz
ENV SERVER_NAME HyperKineticNerd
ENV ADMIN_PASSWD password1234
# ENV SERVER_PASSWD password

WORKDIR /home/steam
EXPOSE 7777 27015 32330
# VOLUME ["/home/minecraft/world"]

USER root

RUN apt-get update && apt-get install -y curl lib32stdc++6
# RUN dpkg --add-architecture i386 &&  apt-get update && apt-get install -y lib32gcc1 lib32stdc++6

RUN useradd -U -m steam
RUN mkdir -p /home/steam/steamcmd
COPY update.sh /home/steam
COPY start.sh /home/steam
RUN chmod u+x update.sh start.sh
RUN chown -R steam:steam /home/steam

USER steam
RUN cd /home/steam/steamcmd && \
    curl -O $BASE_URL && \
    tar -xvzf steamcmd_linux.tar.gz && \
    chmod u+x steamcmd.sh

RUN /home/steam/steamcmd/steamcmd.sh +exit
RUN /home/steam/update.sh

CMD /home/steam/start.sh
# CMD ["bash"]