FROM phusion/baseimage:0.9.19

ENV PROCESS_USER htpcd
ENV LANG en_US.UTF-8
ENV LC_ALL C.UTF-8
ENV LANGUAGE en_US.UTF-8
ENV HOME /home/$PROCESS_USER

ENV PLEXPY_VERSION v1.4.11

# Add the process user
RUN useradd $PROCESS_USER
RUN mkdir /home/${PROCESS_USER}/
RUN chown -R $PROCESS_USER:$PROCESS_USER /home/${PROCESS_USER}

# Install PlexPy
RUN apt-get -qq update && apt-get -yqq install git-core python
RUN git clone https://github.com/JonnyWong16/plexpy.git /opt/plexpy
RUN chown -R $PROCESS_USER:$PROCESS_USER /opt/plexpy

# Setup the init script
RUN mkdir /etc/service/plexpy
ADD init.sh /etc/service/plexpy/run

# Clean up
RUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

CMD ["/sbin/my_init"]
