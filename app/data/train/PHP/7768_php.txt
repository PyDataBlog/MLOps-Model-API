<?php
session_start();
if (!(isset($_SESSION['login']) && $_SESSION['login'] != '')) 
{
	header ("Location: ../security/login_user.php");
}
switch($_SESSION['login'])
{	
	case "super": break;
	case "write":break;
	case "read":break;
	default:
		echo("
			<script type='text/javascript'>
				alert('You are not logged in.');
				window.location='../security/login_user.php';
			</script>
		");
}



      $field_data = Array(Array(),Array());
			
      include("../jackets/db_connect.php");
			if($db_found)
			{
//===MANUALLY PUT IN COLUMN NAMES
                                $column_names = Array();
                                array_push($column_names,"unit");
                                array_push($column_names,"Tenant</br>A");
                                array_push($column_names,"Lease</br>Starts");
                                array_push($column_names,"Lease</br>Ends");
                                array_push($column_names,"Tenant</br>B");
                                array_push($column_names,"Lease</br>Starts");
                                array_push($column_names,"Lease</br>Ends");
                                array_push($column_names,"Tenant</br>C");
                                array_push($column_names,"Lease</br>Starts");
                                array_push($column_names,"Lease</br>Ends");
                                array_push($column_names,"Tenant</br>D");
                                array_push($column_names,"Lease</br>Starts");
                                array_push($column_names,"Lease</br>Ends");
                                array_push($column_names,"Tenant</br>E");
                                array_push($column_names,"Lease</br>Starts");
                                array_push($column_names,"Lease</br>Ends");

                                $column_names_out = implode(",",$column_names);

//===GET DATA FROM UNIT TABLE===========================

                                $sql01 = "SELECT * FROM units;";
                                $result_units = mysql_query($sql01);
                                while($row_units=mysql_fetch_assoc($result_units))
                                {
                                      $row_field_data = Array();
//echo($row_units['unit']."</br>");
                                      array_push($row_field_data,$row_units['unit']);
                                      
//===GET DATA FROM CUSTOMERS TABLE===========================
                                      for($i=1; $i<=5; $i++)
                                      {
                                           $customer_id = $row_units['current_tenant0'.$i];
                                           $sql02 = "SELECT last, first FROM customers WHERE customerID = $customer_id;";
                                           $result_customer = mysql_query($sql02);
                                           $row_customer = mysql_fetch_assoc($result_customer);
                                           
                                           array_push($row_field_data,$row_customer['last']);
                                           
                                           $start_name = "lease_start0".$i;
                                           $end_name = "lease_end0".$i;
                                           
                                           array_push($row_field_data,$row_units[$start_name]);
                                           array_push($row_field_data,$row_units[$end_name]);

                                      }

                                      array_push($field_data,$row_field_data);
                                }//




                                                                        





 //                               $field_data_out = Array();
                                $field_data_hold = Array();
		                foreach($field_data as $row_field_data)
		                {
			                $hold = implode(",",$row_field_data);
			                if($hold!="")
			                {
			                       array_push($field_data_hold,$hold);
			                }				
		                }

		                $field_data_out = implode(";",$field_data_hold);

/*

				// get data from customers table				
                                $sql = "SELECT customerID, last, first FROM customers ORDER BY last;";
                                $result = mysql_query($sql);
                                while($row=mysql_fetch_assoc($result))
                                {
                                     $customer_id = $row['customerID'];
      //===GET DATA FROM UNIT TABLE WHILE LOOPING THROUGH CUSTOMERS
                                     $sql2 = "SELECT unit, lease_start FROM units WHERE current_tenant01=$customer_id
                                              OR current_tenant02=$customer_id OR current_tenant03=$customer_id
                                              OR current_tenant04=$customer_id OR current_tenant05=$customer_id;";
                                     $result_unit = mysql_query($sql2);
                                     $count = 0;
                                     while($row_unit=mysql_fetch_assoc($result_unit))
                                     {     
                                          $lease_start = $row_unit['lease_start'];
                                          $unit = $row_unit['unit'];
                                          if($count!=0)
                                          {
            //--get the first least date (unit) !!!!!!PROBLEM WHEN TIME ENTERS LATE YEARS!!!!!!!
                                                if($row_unit['lease_start'] > $hold_lease_start)
                                                {
                                                     $lease_start = $hold_lease_start;
                                                     $unit = $hold_unit;
                                                }
                                          }
                                          $hold_lease_start = $row_unit['lease_start'];
                                          $hold_unit = $row_unit['unit'];
                                          $count++;
                                     }
                                     array_push($row,$unit);
                                     array_push($row,$lease_start);
     //===GET DATA FROM PARKING TABLE WHILE LOOPING THROUGH CUSTOMERS
                                     $sql3 = "SELECT spot FROM parking_schedule WHERE customer_id=$customer_id;";
                                     $result_parking = mysql_query($sql3);

                                     $park_row = mysql_fetch_assoc($result_parking);                                     
                                     $spot = $park_row['spot'];
                                     array_push($row,$spot);

                                     array_push($field_data,$row);
*/
                                


			
                                mysql_close($db_handle);

			}//end if db_found
	else	{header('Location: ./login_user.php');}//end if  length error message	


?>

<html>
<head>
	<link rel="stylesheet" type="text/css" href="../style/style.css" />
	<script type="text/javascript" src="../functions/list_table.js"></script>
	<title>View Unit List</title>

</head>
<body>
	<div class='top'>
		<font class='main'>
		View Unit List
		</font>
	</div>
	<?php include("../jackets/main_jacket.php");?> 
	<div class="main">
		<div class="text_in">
			<div class="box_width">
				<font class="box_head">Unit List</font></br>
				<hr class="box_line">
			
			</div>
			
			<div class="box_width" id="build_table">

			</div>

		</div>
	</div>

<script type="text/javascript">
	list_table('<?php echo($column_names_out); ?>','<?php echo($field_data_out); ?>');
</script>



</body>
</html>



<!--

				
				<form name="customer_search_form" method="post" action="output_report_tenant01.php">
					<table class="input">
						Select Tenant ID.</br></br>
						<tr>
						<td>Tenant ID: </td><td><input type="text" name="customer_id" maxlength="10"></td><td></td>
						</tr>
						<tr>
						<td><input type="submit" value="View entries"/></td>
						</tr>
					</table>
				</form>	





			<div class="box_width" id="choose_table">
				<form  method="post" action="../functions/excel_out_post.php" name="post_excel">
					<input type="hidden" value="<?php echo($column_data_out); ?>" name="column_data_out" />
					<input type="hidden" value="<?php echo($field_data_out); ?>" name="field_data_out" />
					<input type="submit" value="Export Excel File" name="export_excel"/>
				</form>
			</div>

-->


