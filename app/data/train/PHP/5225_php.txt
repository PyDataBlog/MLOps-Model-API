<?php

use Symfony\Component\Console\Application;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;
use Symfony\Component\Console\Input\InputArgument;
use Symfony\Component\Console\Input\InputOption;

$console = new Application('My Silex Application', 'n/a');
$console->getDefinition()->addOption(new InputOption('--env', '-e', InputOption::VALUE_REQUIRED, 'The Environment name.', 'dev'));
$console->setDispatcher($app['dispatcher']);

/**
 * RabbitMQ Consumer
 */
$console
    ->register('rabbitmq:consumer')
    ->setDefinition(array(
            new InputOption('type', 't', InputOption::VALUE_REQUIRED, 'Message type'),
        ))
    ->setDescription('Consumes a queue message')
    ->setCode(function (InputInterface $input, OutputInterface $output) use ($app) {

            $connections = array(
                'default' => new \PhpAmqpLib\Connection\AMQPLazyConnection('localhost', 5672, 'guest', 'guest', '/')
            );

            $type = $input->getOption('type');

            /** Exercice : Create a consumer and use it! */
        })
;


return $console;
