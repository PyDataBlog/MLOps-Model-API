<?php


namespace EvaUser\Validator;


use Eva\Validator\AbstractValidator;
use Eva\Validator\ValidationResult;

class EmailExist extends AbstractValidator
{
    function __invoke($value, $options = [])
    {
        $result = new ValidationResult();
        $result->setValue($value);
        /** @var \EvaUser\Entity\User $user */
        $user = $this->getEntityManager()->get('EvaUser\Entity\User')->findOneBy(['emailAddress' => $value]);
        if (!$user) {
            $result->setErrorMessage('Пользователь с такой электронной почтной не найден');
        }

        return $result;
    }
}