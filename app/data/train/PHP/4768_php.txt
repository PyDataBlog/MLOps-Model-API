<?php

    /**
     * Recursively iterates files starting from a base path, replacing strings in any files matching a valid Mime type
     * @param $aBasePaths - Array of base paths which will each be iterated recursively to find files for string replacement
     * @param $aStringReplacements - Associative array of strings to replace in files. Any keys found in this array will be replaced by their corresponding value
     */
    function recursiveStringReplace($aBasePaths = array(), $aStringReplacements = array())
    {
        // Replacement will only occur in files of the following Mime types
        $aValidFileMimeTypes = array(
            "text/css",
            "text/html",
            "text/x-php",
            "text/plain",
            "application/xml",
            "application/json",
            "application/javascript"
        );

        // Iterate through each directory recursively, starting at the base path
        foreach ($aBasePaths as $strBasePath)
        {
            $hDirectoryIterator = new RecursiveDirectoryIterator($strBasePath);
            foreach (new RecursiveIteratorIterator($hDirectoryIterator) as $strFilePath)
            {
                // Get the Mime type of the file
                $hFileInfo = finfo_open(FILEINFO_MIME_TYPE);
                $strFileMimeType = finfo_file($hFileInfo, $strFilePath);
                finfo_close($hFileInfo);

                // If file is of a valid Mime type, attempt to get its contents
                if(in_array($strFileMimeType, $aValidFileMimeTypes)) {
                    $strFileContents = file_get_contents($strFilePath);

                    // If we were able to get the contents of the file, replace all string instances in aReplacements
                    if($strFileContents) {
                        $strFileContents = strtr($strFileContents, $aStringReplacements);
                        file_put_contents($strFilePath, $strFileContents);
                    }
                }
            }
        }
    }

    recursiveStringReplace(
        array(
            "./files/",
            "./more-files/"
        ),
        array(
            "Hello" => "Howdy",
            "World" => "Planet",
            "Howdy" => "Hello",
            "Planet" => "World"
        )
    );