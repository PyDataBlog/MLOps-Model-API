<?php

    session_start();

    if (isset($_SESSION['username'])) {
        $username = $_SESSION['username'];
    }

    $veza = new PDO('mysql:host=' . getenv('MYSQL_SERVICE_HOST') . ';port=3306;dbname=developer_blog', 'admin', 'user');
    $veza->exec("set names utf8");

    if (isset($_POST['update'])) {

        $title = $_POST['title'];
        $paragraph = $_POST['paragraph'];

        try {

            $problem_id = $_GET['id'];

            $upit = $veza->prepare("UPDATE part SET title = '$title', text = '$paragraph'  WHERE id=?");
            $upit->bindValue(1, $problem_id, PDO::PARAM_INT);
            $upit->execute();

        } catch (Exception $e) {

        }

        header("location: problems.php"); 
        exit();
    }

    ?>

<!doctype HTML>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Developer Blog</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->

        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/grid.css">
    </head>
    <body>

        <nav class="nav">
            <ul class="nav-list">
              <li class="nav-item"><a id="problems" href="problems.php">Problems</a></li>
              <li class="nav-item"><a id="tasks" href="tasks.php">Tasks</a></li>
              <li class="nav-item"><a id="articles" href="articles.php">Articles</a></li>
              <li class="nav-item"><a id="ideas" href="ideas.php">Ideas</a></li>
              <?php

              if (isset($_SESSION['username'])) {

                echo '<li class="nav-item right"><a id="login" href="logout.php">Log Out</a></li>';
                echo '<li class="nav-item right"><a id="profile" href="javascript:loadPartialProfile()">Profile</a></li>';

              }
              else {

                echo '<li class="nav-item right"><a id="login" href="login.php">Log In</a></li>';

              }

              ?>
            </ul>
        </nav>

        <!--Content-->
        <div class="content" id="content">
            <?php 
                if (isset($_GET['id'])) {

                    $problem_id = $_GET['id'];

                    $title = "";
                    $paragraph = "";

                    $upit = $veza->prepare("SELECT * FROM part WHERE id=?");
                    $upit->bindValue(1, $problem_id, PDO::PARAM_INT);
                    $upit->execute();


                    foreach($upit as $childrens) {    

                        if ($childrens['id'] == $problem_id) {

                            $title = $childrens['title'];
                            $paragraph = $childrens['text'];
                        }
                    }

                    echo    '<form action="shareProblem.php?id=' . $_GET['id'] . '" method="POST">
                                <div class="row creatingForms">
                                    <h1>Share problem</h1>
                                    <h2>Title</h2>
                                    <input type="text" name="title" id="title" value="' . $title . '">
                                    <h2>Paragraph</h2>
                                    <textarea name="paragraph" id="paragraph" >' . $paragraph . '</textarea>
                                    <div class="centerAlign">
                                        <button type="Submit" name="update" value="problem">Submit Problem</button>
                                    </div>
                                </div>
                            </form>';
                }
                else
                    echo    '<form action="index.php" method="POST">
                                <div class="row creatingForms">
                                    <h1>Share problem</h1>
                                    <h2>Title</h2>
                                    <input type="text" name="title" id="title">
                                    <h2>Paragraph</h2>
                                    <textarea name="paragraph" id="paragraph"></textarea>
                                    <div class="centerAlign">
                                        <button type="Submit" name="file" value="problem">Submit Problem</button>
                                    </div>
                                </div>
                            </form>';
            ?>
        </div>


        <script src="js/validations/loginValidation.js"></script>
        <script src="js/validations/signupValidation.js"></script>
        <script src="js/dropdownmenu.js"></script>  
        <script src="js/ajax.js"></script>
    </body>
</html>
