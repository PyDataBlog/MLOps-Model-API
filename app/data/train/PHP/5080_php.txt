<?php

namespace App\Form;

use Symfony\Component\Form\{
    AbstractType,
    FormBuilderInterface
};
use Symfony\Component\DependencyInjection\ContainerInterface;
use Symfony\Component\OptionsResolver\OptionsResolver;
use Symfony\Component\Form\Extension\Core\Type\{
    TextType,
    TextareaType,
    FileType
};
use Symfony\Bridge\Doctrine\Form\Type\EntityType;
use Doctrine\ORM\EntityRepository;
use App\Entity\{
    Company,
    Category
};

class CompanyType extends AbstractType {

    private $container;

    public function __construct(ContainerInterface $container) {
        $this->container = $container;
    }

    /**
     * {@inheritdoc}
     */
    public function buildForm(FormBuilderInterface $builder, array $options) {
        $builder
                ->add('logo', Type\ImageFileType::class, [
                    'required' => false,
                    'label' => 'front.logo',
                    'upload_path' => $this->container->getParameter('company_images'),
                    'attr' => [
                        'accept' => 'image/*',
                        'class' => 'form-control form-control-lg'
                    ]
                ])
                ->add('title', TextType::class, [
                    'label' => 'front.name',
                    'attr' => [
                        'class' => 'form-control form-control-lg'
                    ]
                ])
                ->add('description', TextareaType::class, [
                    'required' => false,
                    'label' => 'front.description',
                    'attr' => [
                        'class' => 'form-control form-control-lg' // text-editor
                    ]
                ])
                ->add('categories', EntityType::class, [
                    'class' => Category::class,
                    //'required' => false,
                    'multiple' => true,
                    'label' => 'front.select.category',
                    'query_builder' => function (EntityRepository $er) {
                        return $er->createQueryBuilder('c')
                                ->where('c.parent <> :null')
                                ->setParameter('null', 'null')
                                ->orderBy('c.title', 'ASC');
                    },
                    'attr' => [
                        'class' => 'form-control select2'
                    ]
                ])
                ->add('gallery_images', FileType::class, [
                    "data_class" => null,
                    'multiple' => true,
                    "mapped" => false,
                    'required' => false,
                    'label' => 'front.add.gallery',
                    'attr' => [
                        'class' => 'form-control form-control-lg'
                    ]
                ])
        ;
    }

    /**
     * {@inheritdoc}
     */
    public function configureOptions(OptionsResolver $resolver) {
        $resolver->setDefaults([
            'data_class' => Company::class
        ]);
    }

    /**
     * {@inheritdoc}
     */
    public function getBlockPrefix() {
        return 'app_company';
    }

}
