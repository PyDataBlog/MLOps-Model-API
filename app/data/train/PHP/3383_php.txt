<?php
/**
 * @package      pkg_projectspoon
 *
 * @author       Kon Angelopoulos (angek)
 * @copyright    Copyright (C) 2018 Kon Angelopoulos. All rights reserved.
 * @license      http://www.gnu.org/licenses/gpl.html GNU/GPL, see LICENSE.txt
 */

// No direct access.
defined('_JEXEC') or die;


class PktimeControllerTimesheets extends JControllerLegacy
{
	public function getModel($name = 'timesheet', $prefix = 'PktimeModel', $config = array())
	{
		$model = parent::getModel($name, $prefix, array('ignore_request' => true));

		return $model;
	}

    public function getTaskOptions()
    {
        $project_id = JFactory::getApplication()->input->getUInt('project_id', 0, 'integer');
        $model      = $this->getModel();

        if ($project_id <= 0) {
            $items = array();
        }
        else {
            $items   = $model->getAssigneeTasksOptions($project_id);
        }
		
        echo new JResponseJson($items);
    }
	
	public function getAssigneeRate()
	{
		$assignee 		= JFactory::getApplication()->input->getUInt('uid', 0, 'integer');
		$model			= $this->getModel();
		
		if ($assignee <=0) {
			$rate = array();
		}
		else {
			$rate = $model->getAssigneeRate($assignee);
		}
		
		echo new JResponseJson($rate);
	}
	
	public function getAssignees()
    {
        $project_id 	= JFactory::getApplication()->input->getUInt('project_id', 0, 'integer');
		$task_id 		= JFactory::getApplication()->input->getUInt('task_id', 0, 'integer');
        $model      	= $this->getModel();

        if ($project_id <= 0) {
            $items = array();
        }
		elseif($task_id <= 0) {
			$items = array();	
		}
        else {
            $items   = $model->getAssignees($project_id, $task_id);
        }

		
        echo new JResponseJson($items);
    }
}
