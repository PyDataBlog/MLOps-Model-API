<?php
use wenyuan\ueditor\Ueditor;
use yii\helpers\Url;
use frontend\models\Member;          //用户模型
use frontend\models\UserThirdPartyLogin; //用户第三方登录模型
        $session = Yii::$app->session;
        $session->isActive?'':$session->open();
        $user = $session->get('user');
        $tplogin = isset($user['third_party_login']) ? $user['third_party_login'] : false;

        if ($user['uid'] == UserThirdPartyLogin::NOT_BOUND_USERID) {
            $user['avatar'] = $tplogin['profile']['avatar'];
        } elseif (!empty($user)) {
            $member_model = new Member();
            $user = $member_model->getByUid($user['uid']);
            // var_dump($user);
        }
        $this->registerCssFile(Yii::$app->params['idaiyan-static']."static/modules/home/css/uc-prodadd-step2.css");
?>
<!-- <link rel="stylesheet" href="http://static.idaiyan.cn/website/static/modules/home/css/home.css">
<link rel="stylesheet" href="http://static.idaiyan.cn/website/static/modules/home/css/uc.css">
<link rel="stylesheet" href="http://static.idaiyan.cn/website/static/modules/home/css/uc-prodadd-step2.css"> -->

<div class="respons_wp uc_body cf">
        <form action="<?= Url::toRoute(['product/update']); ?>" id="editform" method="post" enctype="multipart/form-data">
        <div class="main_wrap cf">
        <!--产品信息完善表单-->
        <div class="prodeditform_wrap fl">
           
            <div class="prodedit_wrap">
                <div class="listtitle cf">
                    <h2 class="fl">
                        <!-- 修改的话是 编辑我的代言 -->
                        完善产品信息
                        <span class="subtitle">Releases new speaking</span>
                    </h2>

                </div>
                <div class="editform_wrap">
                    <div class="formitem name">
                        <label for="name" class="formlabel">产品名称:</label>
                        <div class="formobject">
                            <input type="text" name="extra[name]" id="name" value="<?php echo isset($product['name']) ? $product['name'] : '';?>" datatype="*2-32" nullmsg="产品名称不可以为空哦！" errormsg="产品名称至少2个字符,最多32个字符！"/>
                            <br/>
                        </div>
                        <div class="price">
                            <label for="name" class="label-price">单价:</label>
                            <input type="hidden" name="formhash" value="<?php echo $formhash ?>" />
                            <div class="formobject">
                                <div class="money-box">
                                    <div class="left">￥</div>
                                    <input class="right" type="text" name="extra[price]" id="originprice" maxlength="8" value="<?php echo isset($product['price']) ? $product['price'] : '';?>" datatype="/^([1-9]\d{0,7}[\s,]*)+\.?(\d{0,2})?$/" nullmsg="产品价格不能为空哦！" errormsg="请填写正确的价格！" />
                                </div>
                                <br/>
                            </div>
                        </div>
                    </div>
                    <div class="formitem intro">
                        <label for="intro" class="formlabel">产品简介:</label>
                        <div class="formobject">
                            <textarea name="extra[summary]" id="intro" cols="30" rows="10" datatype="*" nullmsg="产品简介不能为空！" ><?php echo isset($product['extra']['summary']) ? $product['extra']['summary'] : '';?></textarea>
                            <br/>
                        </div>
                    </div>
                    <div class="formitem cover">
                        <label class="formlabel">封面图片:</label>
                        <div class="formobject" data-type="1">
                            <div class="imgselect">
                                <div class="filewrap">
                                    <input type="file" name="album" id="cover">
                                </div>
                                <div class="imgpreview_wrap">
                                    <div class="imgpreview" <?php if(isset($product['album']) && !empty($product['album'])) { ?>style="background-image:url(<?=$product['album'].".jpg";?>);display:block;"<?php } ?>></div>
                                </div>
                                <div class="tip">
                                    <p>支持 JPG , JPEG , PNG格式的图片</p>
                                    <p>尺寸为 <b>800x500</b> 。大小不超过 <b>1M</b> 。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <?php
                    if(isset($product['image']) && !empty($product['image'])) {
                        foreach ($product['image'] as $key => $value) {
                            $__valname = 'bigbanner'.$value['pos_id'];
                            $$__valname = $value['url'];
                        }
                    }
                    ?>
                    <div class="formitem bigbanner" data-type="2">
                        <label class="formlabel">通栏图片:</label>
                        <div class="formobject" >
                            <div class="imgselect" data-target="bigbanner">
                                <div class="imgpreview_wrap cf">
                                    <div class="imgpreview">
                                        <div class="fl"></div>
                                        <div class="fr"></div>
                                    </div>
                                </div>
                                <div class="tip">
                                    支持 JPG , JPEG , PNG格式的图片 尺寸为 <b>2560x450</b> 。大小不超过 <b>2M</b> 。
                                </div>
                            </div>
                            <div class="cf">
                                <div class="addimg addimg1<?php if(isset($bigbanner1)) { ?> hasimg<?php } ?>" postid="1" data-target="bigbanner">
                                    <div class="add_wrap">
                                        <div class="edit"></div>
                                        <div class="del"></div>
                                    </div>
                                    <div class="imgpreview_wrap">
                                        <div class="imgpreview" <?php if(isset($bigbanner1)) { ?>style="background-image:url(<?=$bigbanner1.".jpg";?>);display:block;"<?php } ?>>
                                            <div class="filewrap">
                                                <input type="file" name="bigbanner1" id="bigbanner">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tip">可以再添加一张</div>
                                </div>
                                <div class="addimg addimg2<?php if(isset($bigbanner2)) { ?> hasimg<?php } ?>" postid="2" data-target="bigbanner2">
                                    <div class="add_wrap">
                                        <div class="edit"></div>
                                        <div class="del"></div>
                                    </div>
                                    <div class="imgpreview_wrap">
                                        <div class="imgpreview" <?php if(isset($bigbanner2)) { ?>style="background-image:url(<?=$bigbanner2.".jpg";?>);display:block;"<?php } ?>>
                                            <div class="filewrap">
                                                <input type="file" name="bigbanner2" id="bigbanner2">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tip">可以再添加一张</div>
                                </div>
                                <div class="addimg addimg3<?php if(isset($bigbanner3)) { ?> hasimg<?php } ?>" postid="3" data-target="bigbanner3">
                                    <div class="add_wrap">
                                        <div class="edit"></div>
                                        <div class="del"></div>
                                    </div>
                                    <div class="imgpreview_wrap">
                                        <div class="imgpreview" <?php if(isset($bigbanner3)) { ?>style="background-image:url(<?=$bigbanner3.".jpg";?>);display:block;"<?php } ?>>
                                            <div class="filewrap">
                                                <input type="file" name="bigbanner3" id="bigbanner3">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tip">可以再添加一张</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="formitem video">
                        <label for="video" class="formlabel">宣传视频:</label>
                        <div class="formobject">
                            <input class="gray" type="text" name="extra[video_url]" value="<?php echo isset($product['extra']['video_url']) ? $product['extra']['video_url'] : '';?>" placeholder="可选, 输入视频地址 ( 支持: 优酷, 土豆 )" datatype="url" nullmsg="地址不可以为空哦！" errormsg="请填写正确的地址类型哦！" ignore="ignore" >
                            <br/>
                            </div>
                    </div>
                    <div class="formitem detail">
                        <label for="detail" class="formlabel">详细描述:</label>
                        <div class="formobject">
                          <?php echo Ueditor::widget(['id' => 'extra[detail]','ucontent'=>'']);?>
                            <br/>
                        </div>
                    </div>
                </div>
                <div class="formsubmit">
                    <input type="hidden" name="extra[id]" id= 'product_id' value="<?php echo $id;?>" />
                    <button type="submit" class="submitbtn" id="submit-btn">发布</button>

                    <button type="submit" class="savebtn">保存</button>

                </div>
            </div>
        </div>
        <div class="article_right prodedit_preview">
            <div class="pinned">
            <div class="right_b">
                <button class="previewbtn">预览</button>
            </div>
            <div class="right_t">
                    <div class="top1">
                        <div class="cover_preview"></div>
                        <div class="cover_add"></div>
                    </div>
                    <div class="middle">
                        <p>您填写的产品名称将出现在这里</p>
                        <span class="small-text">您填写的产品简介将出现在这里</span>
                        
                        <div class="prodnums cf">
                           <div class="icon icon-money fl"> <b>9383</b>
                            </div>
                            <div class="icon icon-topic fl"> <b>9383</b>
                            </div>
                            <div class="icon icon-attention fl">
                                <b>
                                938万</b>
                            </div>
                            <div class="icon icon-love fl">
                                <b>938万</b>
                            </div>
                        </div>
                    </div>
                    <div class="prodrate">
                    </div>
                    <div class="bot">
                        <div class="avatar_wrap">
                        <img class="avatar" src="<?php echo isset($user['avatar']) && $user['avatar'] ? (strpos($user['avatar'], 'http') === 0 ? $user['avatar'] : '/' . $user['avatar']) : Yii::$app->params['idaiyan-static'].'static/modules/home/images/temp/avatar.jpg';?>" alt="我的头像">
                            <span class="text"><?php echo isset($user['nickname']) && $user['nickname'] ?$user['nickname']:'无名'; ?></span>
                        </div>
                        
                        <span class="add"></span>
                        <span class="email"></span>
                        
                        <div class="add_icon fr">
                            <div class="inner_div"></div>
                            <div class="inner_div"></div>
                            <div class="inner_div"></div>
                        </div>
                    </div>
                </div>
                <div class="right_d">
                    <div class="top_t"></div>
                    <div class="top1 top2">
                        <div class="bigbanner_preview"></div>
                        <div class="bigbanner_add"></div>
                    </div>
                    <div class="scal">
                        <img src="<?php echo Yii::$app->params['idaiyan-static'];?>static/modules/home/images/uc/scals1.png">
                    </div>
                </div>

            </div>
        </div>
    </form>

</div>

</div>


<script>
var SAVEURL = "<?= Url::toRoute(['product/wesave']); ?>";//保存 
var SUBMITURL = "<?= Url::toRoute(['product/update']); ?>";  
var PREVIEWURL = "<?= Url::toRoute(['product/preview']); ?>";  
</script>

<script type="text/javascript" src="<?php echo Yii::$app->params['idaiyan-static'];?>static/modules/home/js/require.js"></script>
<script type="text/javascript" data-single="true" src="<?php echo Yii::$app->params['idaiyan-static'];?>pkg/map_fe6f523.js"></script>

<script>
/*fis async*/
require(['js/modules/app/uc-prodadd-step2']);
</script>


<link href="<?php echo $url;?>/static/ueditor/css/ueditor.min.css" rel="stylesheet">
<script src="<?php echo $url;?>/static/ueditor/jquery/jquery.js"></script>
<script src="<?php echo $url;?>/static/ueditor/js/ueditor.config.js"></script>
<script src="<?php echo $url;?>/static/ueditor/js/ueditor.all.min.js"></script>
<script type="text/javascript">
jQuery(document).ready(function () {
UE.getEditor('extra[detail]', {
          toolbars: [
               ['fullscreen', 'undo', 'redo', 'bold', 'italic', 'underline', 'fontborder', 'backcolor', 'fontsize', 'fontfamily', 'justifyleft', 'justifyright', 'justifycenter', 'justifyjustify', 'strikethrough', 'superscript', 'subscript', 'removeformat', 'formatmatch', 'autotypeset', 'blockquote', 'pasteplain', '|', 'forecolor',  'insertorderedlist', 'insertunorderedlist', 'selectall', 'cleardoc', 'simpleupload', 'insertimage']
          ]
    });
});
</script>