cmake_policy(SET CMP0057 NEW)

macro(find_package)
    if (NOT ${ARGV0} IN_LIST GIT_SUBMODULES)
        _find_package(${ARGV})
    endif()
endmacro()

function(add_submodules SUBMODULES)
    foreach(SUBMODULE IN LISTS SUBMODULES)
        if (EXISTS "${CMAKE_CURRENT_LIST_DIR}/${SUBMODULE}/CMakeLists.txt")
            message(STATUS "Using git-submodule ${SUBMODULE}")
            add_subdirectory(${SUBMODULE})
        else()
            message(FATAL_ERROR "${SUBMODULE} submodule hasn't CMakeLists.txt entry point")
        endif()
    endforeach()
endfunction()
