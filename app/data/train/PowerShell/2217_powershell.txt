# Bulk Create New Users
# Add them to assigned groups
#
###########################################


#Create users

$Users = Import-Csv C:\ScriptSources\AtlasCMPDallasUsers.csv
           
foreach ($User in $Users)            
{            
    $Displayname = $User.'Firstname' + " " + $User.'Lastname'            
    $UserFirstname = $User.'Firstname'            
    $UserLastname = $User.'Lastname'            
    $OU = 'OU=IH_Integration,OU=CAH_Users,DC=colonyah,DC=local'            
    $SAM = ($User.'Lastname' +"."+ $User.'Firstname' )         
    $UPN = $User.'Lastname' +"." + $User.'Firstname'  + "@" + "Colonystarwood.com" 
    $Email = $user.Email           
    $Description = $User.'Title'            
    $Password = $User.'Password'            
    New-ADUser -Name "$Displayname" -DisplayName "$Displayname" -SamAccountName $SAM -UserPrincipalName $UPN -GivenName "$UserFirstname" -Surname "$UserLastname" -Title "$Description" -EmailAddress $email -Description 'Integration IH' -AccountPassword (ConvertTo-SecureString $Password -AsPlainText -Force) -Enabled $true -Path "$OU" –PasswordNeverExpires $false            
}


#Bulk add users to Group

import-csv C:\ScriptSources\AtlasCMPDallasUsers.csv | Foreach-Object {add-adgroupmember -Identity Atlas_View_Low  -Members ($_.'lastname' +"."+ $_.'firstname' )| add-adgroupmember -Identity CMP_Prod  -Members ($_.'Firstname' +"."+ $_.'Lastname' )}



#Bulk delete


$Users = Import-Csv C:\ScriptSources\AtlasCMPDallasUsers.csv
           
foreach ($User in $Users)    

{
$SAM = ($User.'Firstname' +"."+ $User.'Lastname' )
  

Get-aduser $SAM   | Remove-ADUser
}





get-aduser -Filter * -Properties Whencreated -SearchBase "OU=IH_integration,OU=CAH_Users,DC=Colonyah,DC=local" | Select-Object Name, whencreated, Samaccountname | Export-Csv C:\ScriptOutput\IH_AtlasUsers.csv






$Users = Import-Csv C:\ScriptOutput\IH_AtlasUsers.csv
           
foreach ($User in $Users)    

{

  Get-aduser $user.Samaccountname   | Remove-ADUser
}