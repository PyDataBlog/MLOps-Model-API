# Get the current execution path
Function workingdir{
$fullPathIncFileName = $MyInvocation.MyCommand.Definition 
$currentScriptName = $MyInvocation.MyCommand.Name 
$currentExecutingPath = $fullPathIncFileName.Replace($currentScriptName, "") 
}

$errfile = $currentExecutingPath + "errlist$(get-date -f yyyy-MM-dd-HH-mm).txt"
$logfile = $currentExecutingPath + "transcript$(get-date -f yyyy-MM-dd-HH-mm).txt"

# Kill any old logging that may be still going on
try{
  stop-transcript|out-null
}
catch [System.InvalidOperationException]{}

# start the logging
start-transcript -path $logfile



Function get-disconnectedmailbox {

Param(
[String] $Name = '*',
[Switch] $Archive
)

$databases = get-mailboxdatabase
$databases | %{
	$db = get-mailboxstatistics -database $_ |
	?{$_.disconnectDate -and $_.IsArchivemailbox -eq $archive}
	
	$db | ?{$_.displayname -like $name} |
	Select Displayname,
	Mailboxguid,
	Database,
	disconnectReason
	}
}

get-disconnectedmailbox | export-csv D:\scrap\disconnected2.csv -NoTypeInformation

stop-transcript