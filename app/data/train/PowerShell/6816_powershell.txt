# upload to yardi ftp
Write-Host 'Upload to qa ftp.'
#perform upload
$FtpDestinationAddress = 'xx.xxx.xxx.xx' 
$FtpDestinationDirectory = '/Navigator/qa/'
$UserName = '????????' 
$Password = '?????????'
$SshHostKeyFingerprint = 'ssh-rsa 1024 ??:??:??:??:??:??:??:??:??:??:??:??:??:??:??:??'

#get latest build location
$buildPath = 'L:\builds\Navigator_Full'
$latestBuildName = Get-ChildItem -Path $buildPath -Directory -Name | Sort-Object -Descending | Select-Object -First 1
$latestBuildPath = join-path -path $buildPath -ChildPath $latestBuildName
$zipPath=join-path -path $latestBuildPath -ChildPath 'Internal\_RM'
$zipFileNameWeb=(Get-ChildItem -path "$zipPath\navweb*.zip").FullName
$zipFileNameServices=(Get-ChildItem -path "$zipPath\navcw*.zip").FullName

write-host "uploading: $latestbuildname"
$jobUploadNavWeb = Start-Job -Scriptblock {
  param($scriptPath, $zipToUpload, $FtpDestinationAddress, $FtpDestinationDirectory, $UserName, $Password, $SshHostKeyFingerprint)
  invoke-ftpupload -LocalPath $zipToUpload -FtpServerAddress $FtpDestinationAddress -FtpPath $FtpDestinationDirectory -username $UserName -password $Password -SshHostKeyFingerprint $SshHostKeyFingerprint
} -ArgumentList @($scriptPath, $zipFileNameWeb, $FtpDestinationAddress, $FtpDestinationDirectory, $UserName, $Password, $SshHostKeyFingerprint)
        
$jobUploadNavServ = Start-Job -Scriptblock {
  param($scriptPath, $zipToUpload, $FtpDestinationAddress, $FtpDestinationDirectory, $UserName, $Password, $SshHostKeyFingerprint)
  invoke-ftpupload -LocalPath $zipToUpload -FtpServerAddress $FtpDestinationAddress -FtpPath $FtpDestinationDirectory -username $UserName -password $Password -SshHostKeyFingerprint $SshHostKeyFingerprint
} -ArgumentList @($scriptPath, $zipFileNameServices, $FtpDestinationAddress, $FtpDestinationDirectory, $UserName, $Password, $SshHostKeyFingerprint)
        
Wait-Job $jobUploadNavWeb -Timeout 120 # wait for the job to complete
Write-Host "web upload complete.`n"
Wait-Job $jobUploadNavServ -Timeout 120  # wait for the job to complete
Write-Host "nav services upload complete.`n"
Write-Host "Upload to qa complete.`n"
