workflow virtualMachine-Start
{
    param (
        [Parameter(Mandatory=$true)]
        [PSCredential] 
        $automationUser,

        [Parameter(Mandatory=$true)]
        [string] 
        $subscriptionName,

        [Parameter(Mandatory=$true)]
        [string] 
        $virtualMachineName
    )
    
    Add-AzureAccount -Credential $automationUser
    
    InlineScript 
    {
        Write-Output "Running on subscription '$using:subscriptionName'"
        Select-AzureSubscription -SubscriptionName $using:subscriptionName
        
        $vm = Get-AzureVM | Where-Object -FilterScript { $_.Name -eq $using:virtualMachineName }
        if ($vm)
        {
            Write-Output "Starting Virtual Machine '$using:virtualMachineName'"
            Start-AzureVM -ServiceName $vm.ServiceName -Name $vm.Name
        }
        else
        {
            Write-Output "Virtual Machine '$using:virtualMachineName' not found"
        }
    }
}