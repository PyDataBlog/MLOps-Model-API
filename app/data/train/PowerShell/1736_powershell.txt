<#
.SYNOPSIS
This PowerShell script module file provides a step function to be used in a
series of executable PowerShell steps that is intended to be included in all
main PowerShell scripts that reside within the automation framework.

.DESCRIPTION
Note: This script module is NOT intended to be executed independent of another
PowerShell script referencing and using it.
#>

function Start-ConcourseWeb {
    <#
    .SYNOPSIS
    Starts Concourse CI Web used for continuous integration of code development
    and build automation.

    .DESCRIPTION
    N/A

    .EXAMPLE
    There are no parameters for this function.
 
    Start-ConcourseWeb
    #>

    # read context file into hashtable
    $context = Read-Context

    # read properties from context
    $concourseWebStart = $context.Get_Item("concourseWebStart")
    $concourseVersion = $context.Get_Item("concourseVersion")

    # only start Concourse web if start script exists
    if (Test-FileExists -filePath $concourseWebStart) {

        # concourse web start script process information
        $process = "$concourseWebStart"

        # start Concourse web
        Write-Info "Starting Concourse CI Web ($(Get-VersionOrDefault -version $concourseVersion))..."
        $exitCode = Invoke-Process -processPath $process `
                                    -newProcessWindow $true

        # validate process completed
        if ($exitCode -ne 0) {

            Write-Exception -Message "Unable to start Concourse CI Web ($(Get-VersionOrDefault -version $concourseVersion). Operation FAILED." -ErrorAction Stop
        }
        else {
            Write-Success "Concourse CI Web ($(Get-VersionOrDefault -version $concourseVersion) started successfully. Operation SUCCEEDED!!!"
        }
    }
    else {
        Write-Info "Skipping start of Concourse CI Web ($(Get-VersionOrDefault -version $concourseVersion) since it does not exist."
    }
}