
<#------------- CONNECT TO SWIS -------------#>
# load the snappin if it's not already loaded (step 1)
if (!(Get-PSSnapin | Where-Object { $_.Name -eq "SwisSnapin" })) {
    Add-PSSnapin "SwisSnapin"
}

#define target host and credentials

$hostname = 'localhost'
#$user = "admin"
#$password = "password"
# create a connection to the SolarWinds API
#$swis = connect-swis -host $hostname -username $user -password $password -ignoresslerrors
$swis = Connect-Swis -Hostname $hostname -Trusted

<#------------- ACTUAL SCRIPT -------------#>


$discoveryname = "prisim"
$applicationname = "PRISM"

$query = @"
select n.CustomProperties.uri, n.Caption
from orion.DiscoveryProfiles dp
join orion.DiscoveredNodes dn on dn.ProfileID=dp.ProfileID
join orion.nodes n on n.IP=dn.IPAddress
where dp.Name like '%$discoveryname%'
"@
$Nodes = Get-SwisData $swis $query 

$propbag = @{
    "masterapplication" = "$applicationname" ;

}


# iterate through this list and update each group
foreach($Node in $Nodes)  
    {  
    # write out which group we're working with
    "Working with node: $($Node.Caption)..."
    
    Set-SwisObject -SwisConnection $swis -Uri $Node.uri -properties $propbag     

    }  
