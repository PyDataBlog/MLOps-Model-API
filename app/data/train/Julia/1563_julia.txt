using RLESUtils, RunUtils, IFTTTUtils, FileUtils

const COMP = gethostname()
const DATA = "youtube8_test"
const I_START = 1 
const I_END = 20 

template_ge(i) =
"""
using GrammarExpts,Auslan_GE_Tree,RLESUtils,IFTTTUtils
auslan_ge_tree(;seed=$i, outdir=Pkg.dir("GrammarExpts/results/Auslan_GE_Tree_$DATA/seed$i"))
"""

notifydone() = sendifttt(;value1="$COMP done")

A = JuliaSource[]
append!(A, [JuliaSource(template_ge(i)) for i=I_START:I_END])

const LOGDIR = Pkg.dir("GrammarExpts/results/Auslan_GE_Tree_$DATA")
function compute_avg_tokens()
    @eval using GrammarExpts, Auslan_GE_Tree
    fmt_pretty = get_format_pretty()
    toks = Float64[]
    for subdir in readdir_dir(LOGDIR)
        f = joinpath(subdir, "save.jld")  
        push!(toks, avg_tokens(f, fmt_pretty))
    end
    m = mean(toks)
    textfile(joinpath(LOGDIR,"avg_tokens.txt"), string(toks); avg=m)
    m
end

#include("script.jl")
#fs=julia_process(A, np); notifydone()
