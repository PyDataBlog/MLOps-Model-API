@echo off

echo Deploying zip packages to AWS Lambda

rem Decide which function to create...

echo NOTE: Trigger are not attached!

rem GOTO THEA_PROD

rem ... else make sure you goto END
GOTO END

:WYDOT_DEV

SET REGION=us-east-1
SET FUNCTION_NAME=dev-dot-sdc-cvp-wydot-manual-ingest
SET ZIP_FILE=fileb://dataProcessor.zip
SET ROLE=arn:aws:iam::911061262852:role/lambda-cvpep-manual-data-ingestion-role
SET HANDLER=dataProcessor.lambda_handler
SET DESCRIPTION="DEV manual ingest bucket for WYDOT"
SET TARGET_BUCKET=dev-dot-sdc-cvp-staging-911061262852-us-east-1
SET TARGET_KEY=cv/wydot/

GOTO CREATE

:WYDOT_TEST

SET REGION=us-east-1
SET FUNCTION_NAME=test-dot-sdc-cvp-wydot-manual-ingest
SET ZIP_FILE=fileb://dataProcessor.zip
SET ROLE=arn:aws:iam::911061262852:role/lambda-cvpep-manual-data-ingestion-role
SET HANDLER=dataProcessor.lambda_handler
SET DESCRIPTION="TEST manual ingest bucket for WYDOT"
SET TARGET_BUCKET=test-dot-sdc-cvp-staging-911061262852-us-east-1
SET TARGET_KEY=cv/wydot/

GOTO CREATE

:WYDOT_PROD

SET REGION=us-east-1
SET FUNCTION_NAME=prod-dot-sdc-cvp-wydot-manual-ingest
SET ZIP_FILE=fileb://dataProcessor.zip
SET ROLE=arn:aws:iam::911061262852:role/lambda-cvpep-manual-data-ingestion-role
SET HANDLER=dataProcessor.lambda_handler
SET DESCRIPTION="PROD manual ingest bucket for WYDOT"
SET TARGET_BUCKET=prod-dot-sdc-cvp-staging-911061262852-us-east-1
SET TARGET_KEY=cv/wydot/

GOTO CREATE

:THEA_DEV

SET REGION=us-east-1
SET FUNCTION_NAME=dev-dot-sdc-cvp-thea-manual-ingest
SET ZIP_FILE=fileb://dataProcessor.zip
SET ROLE=arn:aws:iam::911061262852:role/lambda-cvpep-manual-data-ingestion-role
SET HANDLER=dataProcessor.lambda_handler
SET DESCRIPTION="DEV manual ingest bucket for THEA"
SET TARGET_BUCKET=dev-dot-sdc-cvp-staging-911061262852-us-east-1
SET TARGET_KEY=cv/thea/

GOTO CREATE

:THEA_TEST

SET REGION=us-east-1
SET FUNCTION_NAME=test-dot-sdc-cvp-thea-manual-ingest
SET ZIP_FILE=fileb://dataProcessor.zip
SET ROLE=arn:aws:iam::911061262852:role/lambda-cvpep-manual-data-ingestion-role
SET HANDLER=dataProcessor.lambda_handler
SET DESCRIPTION="TEST manual ingest bucket for THEA"
SET TARGET_BUCKET=test-dot-sdc-cvp-staging-911061262852-us-east-1
SET TARGET_KEY=cv/thea/

GOTO CREATE

:THEA_PROD

SET REGION=us-east-1
SET FUNCTION_NAME=prod-dot-sdc-cvp-thea-manual-ingest
SET ZIP_FILE=fileb://dataProcessor.zip
SET ROLE=arn:aws:iam::911061262852:role/lambda-cvpep-manual-data-ingestion-role
SET HANDLER=dataProcessor.lambda_handler
SET DESCRIPTION="PROD manual ingest bucket for THEA"
SET TARGET_BUCKET=prod-dot-sdc-cvp-staging-911061262852-us-east-1
SET TARGET_KEY=cv/thea/

GOTO CREATE

:CREATE

aws lambda create-function ^
    --profile sdc ^
    --region %REGION% ^
    --function-name %FUNCTION_NAME% ^
    --zip-file %ZIP_FILE% ^
    --role %ROLE% ^
    --handler %HANDLER% ^
    --runtime python3.6 ^
    --timeout 60 ^
    --memory-size 128 ^
    --description %DESCRIPTION% ^
    --environment Variables={TARGET_DATA_BUCKET=%TARGET_BUCKET%,TARGET_DATA_KEY=%TARGET_KEY%}

GOTO END

:END

echo Finished

pause


rem aws lambda create-function --region us-east-1 --function-name dev-python-wydot-upload --zip-file fileb://python_wydot_upload.zip --role arn:aws:iam::940428459796:role/lambda-restricted-role --handler python_wydot_upload.lambda_handler --runtime python3.6 --timeout 300 --memory-size 512 --description "DEV Routes wydot uploaded data to correct raw data storage location"
rem aws lambda create-function --region us-east-1 --function-name dev-thea-upload --zip-file fileb://thea_upload.zip --role arn:aws:iam::940428459796:role/lambda-restricted-role --handler thea_upload.lambda_handler --runtime python3.6 --timeout 300 --memory-size 512 --description "DEV Routes thea uploaded data to correct raw data storage location"
