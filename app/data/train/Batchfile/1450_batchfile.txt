@PowerShell -ExecutionPolicy Bypass -Command Invoke-Expression $('$args=@(^&{$args} %*);'+[String]::Join(';',(Get-Content '%~f0') -notmatch '^^@PowerShell.*EOF$')) & goto :EOF

echo "        /######                                     /##    /##/##             "
echo "       /##__  ##                                   | ##   | #|__/             "
echo "      | ##  \__/ /######  /######  /####### /######| ##   | ##/##/######/#### "
echo "      |  ###### /##__  ##|____  ##/##_____//##__  #|  ## / ##| #| ##_  ##_  ##"
echo "       \____  #| ##  \ ## /######| ##     | ########\  ## ##/| #| ## \ ## \ ##"
echo "       /##  \ #| ##  | ##/##__  #| ##     | ##_____/ \  ###/ | #| ## | ## | ##"
echo "      |  ######| #######|  ######|  ######|  #######  \  #/  | #| ## | ## | ##"
echo "       \______/| ##____/ \_______/\_______/\_______/   \_/   |__|__/ |__/ |__/"
echo "               | ##                                                           "
echo "               | ##                                                           "
echo "               |__/                                                           "
echo "                    °æ±¾ : 1.0.0-dev  ÖÐÎÄ¹ÙÍø : https://spacevim.org/cn/     "

Push-Location ~

$app_name    = "SpaceVim"
$repo_url    = "https://github.com/SpaceVim/SpaceVim.git"
$repo_name   = "SpaceVim"
$repo_path   = "$HOME\.SpaceVim"

Function Pause ($Message = "Çë°´ÈÎÒâ°´¼ü¼ÌÐø . . . ") {
  if ((Test-Path variable:psISE) -and $psISE) {
    $Shell = New-Object -ComObject "WScript.Shell"
      $Button = $Shell.Popup("Click OK to continue.", 0, "Script Paused", 0)
  } else {     
    Write-Host -NoNewline $Message
      [void][System.Console]::ReadKey($true)
      Write-Host
  }
}

echo "==> ¿ªÊ¼¼ì²â»·¾³ÒÀÀµ..."
echo ""
sleep 1


echo "==> ²âÊÔ git ÃüÁî"
if (Get-Command "git" -ErrorAction SilentlyContinue) {
  git version
  echo "[OK] ²âÊÔ³É¹¦. ¿ªÊ¼ÏÂÒ»¸ö²âÊÔ..."
  sleep 1
} else {
  echo ""
  echo "[ERROR] ÎÞ·¨ÔÚÄãµÄ PATH ÖÐ·¢ÏÖ 'git.exe' ÃüÁî"
  echo ">>> ×¼±¸ÍË³ö......"
  Pause
  exit
}

echo ""

echo "==> ²âÊÔ gvim ÃüÁî"
if (Get-Command "gvim" -ErrorAction SilentlyContinue) {
  echo ($(vim --version) -split '\n')[0]
  echo "[OK] ²âÊÔ³É¹¦. ¿ªÊ¼ÏÂÒ»¸ö²âÊÔ..."
  sleep 1
} else {
  echo "[WARNING] ÎÞ·¨ÔÚÄãµÄ PATH ÖÐ·¢ÏÖ 'gvim.exe' ÃüÁî. µ«ÈÔ¿É¼ÌÐø°²×°..."
  echo ""
  echo "[WARNING] ÇëºóÐø°²×° gvim »òÕßÕýÈ·ÉèÖÃÄãµÄ PATH! "
  Pause
}

echo "<== »·¾³ÒÀÀµ¼ì²âÒÑÍê³É. ¼ÌÐøÏÂÒ»²½..."
sleep 1
echo ""
echo ""

if (!(Test-Path "$HOME\.SpaceVim")) {
  echo "==> ÕýÔÚ°²×° $app_name"
  git clone $repo_url $repo_path
} else {
  echo "==> ÕýÔÚ¸üÐÂ $app_name"
  Push-Location $repo_path
  git pull origin master
}

echo ""
if (!(Test-Path "$HOME\vimfiles")) {
  cmd /c mklink $HOME\vimfiles $repo_path
  echo "[OK] ÒÑÎª vim °²×° SpaceVim"
  sleep 1
} else {
  echo "[OK] $HOME\vimfiles ÒÑ´æÔÚ"
  sleep 1
}

echo ""
if (!(Test-Path "$HOME\AppData\Local\nvim")) {
  cmd /c mklink "$HOME\AppData\Local\nvim" $repo_path
  echo "[OK] ÒÑÎª neovim °²×° SpaceVim"
  sleep 1
} else {
  echo "[OK] $HOME\AppData\Local\nvim ÒÑ´æÔÚ"
  sleep 1
}

echo ""
echo "°²×°ÒÑÍê³É!"
echo "=============================================================================="
echo "==               ´ò¿ª Vim »ò Neovim£¬ËùÓÐ²å¼þ½«»á×Ô¶¯°²×°                   =="
echo "=============================================================================="
echo ""
echo "¸ÐÐ»Ö§³Ö SpaceVim£¬»¶Ó­·´À¡£¡"
echo ""

Pause

# vim:set ft=ps1 nowrap: 
