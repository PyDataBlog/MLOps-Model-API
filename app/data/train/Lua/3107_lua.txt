local function GetAdvise(firm_id, client_code)
	local const 				= require "constants"
	local account 			= const.account
	local client_code 		= const.client_code
	local firm_id 			= const.firm_id
	local tag 				= const.tag
	local currcode 			= const.currcode
	local portfolio_sec_cnt = const.portfolio_sec_cnt
	local class_code 		= const.class_code
	message(tostring(firm_id).." "..tostring(client_code))
	local portfolio = getPortfolioInfo(firm_id, client_code)
	local money_available = portfolio["all_assets"]
	local sec_money_limit = money_available / portfolio_sec_cnt
	local money = getMoney (client_code, firmid, tag, currcode)
	local n = getNumberOf("depo_limits")	
	local item={}
	for i=0, n-1 do
		item = getItem("depo_limits", i)
		local sec_info = {}
		if item["limit_kind"] == 0 and item["currentbal"]~=0 then
			local sec_info = getSecurityInfo(class_code, item["sec_code"])
			if sec_info~=nil then
				local sec_code = item["sec_code"]
				local currentbal = item["currentbal"]
				local lot_size = sec_info["lot_size"]
				local current_lots = currentbal / lot_size
				local curr_price = getParamEx (class_code, sec_code, "LAST").param_value
				local current_sec_sum = currentbal * curr_price
				local delta_sec_sum = current_sec_sum - sec_money_limit
				local new_sec_bal = sec_money_limit / curr_price
				local delta_sec_qty = currentbal - new_sec_bal
				local delta_sec_lots = math.ceil(delta_sec_qty / lot_size)
				local status = ""
				if delta_sec_lots < 0 then
					status = "êóïèòü"..tostring(math.abs(delta_sec_lots)).." ëîò."
				elseif delta_sec_lots > 0 then
					status = "ïðîäàòü"..tostring(math.abs(delta_sec_lots)).." ëîò."
				else
					status = "äåðæàòü"
				end
				
				message(
					"========================\n"
					..tostring(sec_code).."\n"
					.."========================\n"
					.."Ëîò: "..tostring(lot_size).."\n"
					.."Òåêóùàÿ öåíà: "..tostring(curr_price).."\n"
					.."Êîë-âî: "..tostring(currentbal).."\n"
					.."Ñóììà: "..tostring(current_sec_sum).."\n"
					.."Ëèìèò: "..tostring(sec_money_limit).."\n"
					.."Äåëüòà ñóììû: "..tostring(delta_sec_sum).."\n"
					.."Äåëüòà àêöèé: "..tostring(math.ceil(delta_sec_qty)).."\n"
					.."Äåëüòà ëîòîâ: "..tostring(delta_sec_lots).."\n"
					.."========================\n"
					.."Äåéñòâèå: "..status.."\n"
					, 1)
			end
		end
	end
	
	return result
end

return{
	GetAdvise = GetAdvise
}