n=1
package.path="luascript/?.lua"
require("trim")
local name="knight"
local oldmsg2={}
local oldmsg1={}
reaction={
"àÅ£¿Å¶\nÄã¡­¡­Äã´íÈºÁË£¡",
"°¡£¿Å¶\nÏ¹ÁËÎÒµÄ¹·ÑÛ£¡",
"°¡£¿Å¶\n¡­¡­",
"°¡£¿Å¶\nÄã¡­¡­ÄãÃÇ²æ²æ½ç£¡",
"°¡£¿Å¶\n¿ì·ÅÏÂÄÇ¸öÊ¦Ì«£¡",
"( ¡Ñ o ¡Ñ )°¡£¡\n[buddy_name]×îÀ÷º¦ÁË£¡",
"É¶£¿\n¡°²»Ð¡ÐÄ¡±²ÈÁË[buddy_name]Ò»½Å¡£"
}
function knight(msg,msg_time,buddy_name,buddy_num,qun_name,qun_num)
	print(qun_num)
	if qun_num~=2111751848 and qun_num~=2020012687 then return end
	math.randomseed(os.time()+n)
	math.random()
	--result=0
	if n<10000 then n=n+1 else n=1 end
	local l_msg=string.lower(msg)
    l_msg=string.gsub(l_msg,"%[image%]","")
	if l_msg=="" then return end
	local t_msg=trim(msg)
	if oldmsg2[qun_num]==oldmsg1[qun_num] and oldmsg1[qun_num]==t_msg then
		if t_msg=="¡­¡­" then say_qun("¡­¡­Nice Boat",qun_num) return end
		local word_jie=string.match(l_msg,"ÄãÃÇ(.*)½ç")
		if word_jie~=nil and string.match(l_msg,"ÄãÃÇ¶¼ÊÇ.*½çµÄ£¡")==nil then say_qun("ÄãÃÇ¶¼ÊÇ"..word_jie.."½çµÄ£¡",qun_num) return end
		oldmsg1[qun_num]="[Somethingthatwillnotrepeat]"
		oldmsg2[qun_num]="[Somethingthatwillnotrepeat]"
		say_qun(msg,qun_num)
	end
	oldmsg2[qun_num]=oldmsg1[qun_num]
	oldmsg1[qun_num]=t_msg

	if ((string.match(l_msg,"%.fate") or string.match(l_msg,"%.zhan") )
	and
		(
			(
			string.match(l_msg,"»¹ÊÇ") and
				(string.match(l_msg,"°®") or string.match(l_msg,"Ï²»¶") or string.match(l_msg,"±È½ÏºÃ"))
			)
		)
	) then say_qun("/me ½ô½ô±§×¡"..buddy_name..":¡°ÎÒÕæÃ»ÓÃ£¬¾ÓÈ»ÈÃÄãÎÊ³öÕâÑùµÄÎÊÌâ¡­¡­¡±",qun_num) return end

	if string.match(l_msg,name)==nil then return end
	if string.match(l_msg,name.."%?")~=nil and tonumber(buddy_num)==241950376 then say_qun("àÅ£¿ÎÒ»ØÀ´ÁË£¡",qun_num) return end
	if string.match(l_msg,name.."ÌÖÑá")~=nil and tonumber(buddy_num)==241950376 then say_qun("¡­¡­",qun_num) return end
	if string.match(l_msg,name.."%?")~=nil and tonumber(buddy_num)==289828069 then say_qun("àÅ£¿²»ÏÓ·³Âð£¿",qun_num) return end
	if string.match(l_msg,name.."%?")~=nil or string.match(l_msg,name.."£¿")~=nil then
		local choice=math.random(1,3)
		if choice==1 then say_qun("àÅ£¿",qun_num) return
		elseif choice==2 then say_qun("°¡£¿",qun_num) return
		elseif choice==3 then say_qun("É¶£¿",qun_num) return
		end
	return end
	if string.match(l_msg,"¸øÎÒ")~=nil and tonumber(buddy_num)==241950376 then say_qun("°¥£¡",qun_num) return end

	if string.match(l_msg,"¸øÎÒ")~=nil then say_qun("Äã²»ÅÂ±»°²×Ð×áÂð£¿",qun_num) return end
	if string.match(l_msg,"°²×ÐÏ²»¶ÄãÄã¶®Âð")~=nil then say_qun("Õâ¸ö¿ÉÒÔ¶®¡£",qun_num) return end
	if string.match(l_msg,"Äã¶®.*Âð")~=nil then
		if string.match(l_msg,"°²×Ð")~=nil then say_qun("Õâ¸öÂï¡­¡­\n/me ¶ÝÁË",qun_num) return end
		say_qun("/me ¹û¶Ï±íÊ¾²»¶®",qun_num) return
	end
	if string.match(l_msg,"Äã¶®Ã´")~=nil then say_qun("/me ¹û¶Ï±íÊ¾²»¶®",qun_num) return end
	if string.match(l_msg,"¸øµã·´Ó¦£¡")~=nil then
		local result_str=reaction[math.random(1,table.maxn(reaction))]
		result_str=string.gsub(result_str,"%[buddy_name%]",buddy_name)
		say_qun(result_str,qun_num)
		return
	end
end
