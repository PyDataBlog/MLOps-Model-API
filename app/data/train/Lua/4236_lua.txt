require("hy.common.common")
require("hy.common.cmd")
require("hy.xiuxi")

--´ò×øÁ·ÄÚÁ¦
function dazuo_start()

	Common_AddCustomerAlias("huifuneili_alias", "huifuneili", "\n")
	
	Common_AddCustomerTrigger("dazuo1", "dazuo","^Äã(.*?)Õ¾ÁËÆðÀ´¡£", "/dodazuo()")
	Common_AddCustomerTrigger("dazuo2", "dazuo","^ÄãÂýÂýÊÕÆø£¬¹éÈëµ¤Ìï£¬Õö¿ªÑÛ¾¦£¬ÇáÇáµÄÍÂÁËÒ»¿ÚÆø¡£", "/dodazuo()")
	Common_AddCustomerTrigger("dazuo3", "dazuo","^Äã½«ÄÚÏ¢ÔÚÌåÄÚÔËÐÐÊ®¶þÖÜÌì£¬·µ»Øµ¤Ìï£¬Ö»¾õµÃÈ«ÉíÅ¯ÑóÑóµÄ¡£", "/dodazuo()")
	Common_AddCustomerTrigger("dazuo4", "dazuo","^ÎÞ¾¡µÄÉ±Òâ»º»ºÉ¢ÈëÈ«Éí£¬Õö¿ªÑÛ£¬³¤ÍÂÁËÒ»¿ÚÆø¡£", "/dodazuo()")
	Common_AddCustomerTrigger("dazuo5", "dazuo","^ÄãÏÖÔÚÆø²»¹»!","/dazuo_xiuxi()")
	Common_AddCustomerTrigger("dazuo6", "dazuo","^Äã½«ÕæÆøÔÚÌåÄÚÑØÂöÂçÔËÐÐÁËÒ»È¦£¬»º»ºÄÉÈëµ¤Ìï£¬·ÅÏÂÊÖ£¬³¤ÍÂÁËÒ»¿ÚÆø¡£", "/dodazuo()")
	Common_AddCustomerTrigger("dazuo7", "dazuo","^ÄãÕæÆøÔÚÌåÄÚÔËÐÐÁËÒ»¸öÖÜÌì£¬ÀäÈÈÕæÆøÊÕÓÚµ¤Ìï£¬ÂýÂýÌ§ÆðÁËÑÛ¾¦¡£", "/dodazuo()")
	Common_AddCustomerTrigger("dazuo8", "dazuo","^ºöÈ»´Ó(.*?)Àï»Ã»¯³öÒ»¸öÉíÅûÂÌÉ´µÄÐÒÔËÅ®Éñ(.*?)", "/gag()",17444)
	Common_AddCustomerTrigger("dazuo9", "dazuo","^ÂÌ¹âÒ»ÉÁ(.*?)ÐÒÔËÅ®Éñ¾Í²»¼ûÁË¡£", "/gag()",17444)
	Common_AddCustomerTrigger("dazuo10", "dazuo","^(.*?)ÖÐµÄÖäÓï½¥½¥Ê§È¥ÁËÐ§ÓÃ£¡", "/gag()",17444)
	Common_AddCustomerTrigger("dazuo11", "dazuo","^(.*?)ºöÈ»¸Ðµ½À¶É«µÄ»ð£¬°×É«µÄÀ×µçÎ§ÈÆ×Å(.*?)ÈçÌìÉñ½µÁÙ£¡", "/gag()",17444)

	Common_AddCustomerTimer("timerpause", "timerpause",0, 1, 0, "/dazuo_timerpause()",17409)

	dazuo_DisableAll()
	
	SetVariable("currstats","dazuo")
	EnableTimer("autoemote", false)
	EnableTriggerGroup("dazuo", true)
	dodazuo()
end

function dazuo_DisableAll()
	EnableTriggerGroup("dazuo", false)
end

function dazuo_timerpause()
	Common_SendToWorld("sigh5")
	pausetimes = pausetimes + 1
	if pausetimes > 5 then
		pausetimes = 0
		changxi_DisableAll()
		DoAfterSpecial(10,"e;e;e;e;why;quit",10)
	end
end

function dodazuo()
	if _G.EndRobot > 0 then
		dazuo_DisableAll()
		EnableTimer("timerpause", false)
		EnableTimer("autoemote", true)
	else
		pausetimes = 0
		Common_SendToWorld("dazuo 10")
	end
end

--=================================================================
--Á¬½ÓÉÏºó×Ô¶¯Robot
function dazuo_OnConnect()
	Common_SendToWorld("e;s;s;#6 w;n;#5 w;u")
	DoAfterSpecial(1, "/dazuo_start()", 10)
end

--ÖØÐÂÁ¬Ïßºó
function  dazuo_OnReconnect()
	dazuo_DisableAll()
	DoAfterSpecial(10, "/dazuo_start()", 10)
end

--ÃüÁîÌ«¶à
function dazuo_TooManyCommand()
	dazuo_DisableAll()
	DoAfterSpecial(20, "/dazuo_start()", 10)
end

--´òÀ×
function dazuo_OnEvent()
	dazuo_DisableAll()
	world.Disconnect()
end

--ÐÝÏ¢
function dazuo_doxiuxi()
	xiuxi_doxiuxi()
	--dazuo_chihe()
	DoAfterSpecial(1,"d;sleep",10)
end

function dazuo_chihe()
	local food = tonumber(GetVariable("food"))
	local foodmax = tonumber(GetVariable("food_max"))
	local water = tonumber(GetVariable("water"))
	local watermax = tonumber(GetVariable("water_max"))
	if (food > foodmax/2) and (water > watermax/2) then
		return
	end 
	
end

function dazuo_xiuxi()
	dazuo_DisableAll()
	xiuxi_start("dazuo")
end

function dazuo_xiuxicomplete()  
	xiuxi_complete()
	DoAfterSpecial(1, "u", 10)
	DoAfterSpecial(1.1, "/dazuo_start()", 10)
end