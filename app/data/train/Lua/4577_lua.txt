require "src/scene/scene"
require "src/basic_object/button"
require "src/util/vector2"
require "src/module/language"
require "src/basic_object/panel"
require "src/util/color"
require "src/basic_object/label"

local class = require "lib/middleclass"
TitleScene = class("TitleScene", Scene)

function TitleScene:initialize()
	Scene.initialize(self)

	--Aux variables--
	local words = Language._words
	local size = Vector2:new(300, 50)
	local posX = 320
	local posY = 100
	local textSize = 22
	local spaceBetween = 15
	local backgroundButtonColor = Color:new(0, 120, 255, 255)
	local gray = Color:new(60, 60, 60, 255)
	local align = "center"

	--Setting mainPanel--
	local mainPanel = Panel:new()
	local campaing = Button:new(Vector2:new(posX, posY), size, backgroundButtonColor)
	local multiplayer = Button:new(Vector2:new(posX, posY + (spaceBetween + size.y)), size, backgroundButtonColor, true)
	local extras = Button:new(Vector2:new(posX, posY + (spaceBetween + size.y) * 2), size, backgroundButtonColor, true)
	local options = Button:new(Vector2:new(posX, posY + (spaceBetween + size.y) * 3), size, backgroundButtonColor)
	local about = Button:new(Vector2:new(posX, posY + (spaceBetween + size.y) * 4), size, backgroundButtonColor)

	campaing.text = Label:new(campaing._pos + Vector2:new(size.x/2, size.y/2 - textSize/2), Vector2:new(math.huge, textSize), nil, words["campaing"], align)

	multiplayer.text = Label:new(multiplayer._pos + Vector2:new(size.x/2, size.y/2 - textSize/2), Vector2:new(math.huge, textSize), gray, words["multiplayer"], align)

	extras.text = Label:new(extras._pos + Vector2:new(size.x/2, size.y/2 - textSize/2), Vector2:new(math.huge, textSize), gray, words["extras"], align)

	options.text = Label:new(options._pos + Vector2:new(size.x/2, size.y/2 - textSize/2), Vector2:new(math.huge, textSize), nil, words["options"], align)

	about.text = Label:new(about._pos + Vector2:new(size.x/2, size.y/2 - textSize/2), Vector2:new(math.huge, textSize), nil, words["about"], align)

	campaing.OnButtonClick = {self._campaingClick, self}
	multiplayer:disable()
	extras:disable()
	options.OnButtonClick = {self._optionsClick, self}
	about.OnButtonClick = {self._aboutClick, self}

	mainPanel.objects:add(0, "campaing", campaing)
	mainPanel.objects:add(0, "multiplayer", multiplayer)
	mainPanel.objects:add(0, "extras", extras)
	mainPanel.objects:add(0, "options", options)
	mainPanel.objects:add(0, "about", about)

	--Setting campaingPanel--
	local campaingPanel = Panel:new()
	local newGame = Button:new(Vector2:new(posX, posY), size, backgroundButtonColor)
	local continue = Button:new(Vector2:new(posX, posY + (spaceBetween + size.y)), size, backgroundButtonColor, true)
	local back = Button:new(Vector2:new(posX, posY + (spaceBetween + size.y) * 2), size, backgroundButtonColor)

	newGame.text = Label:new(newGame._pos + Vector2:new(size.x/2, size.y/2 - textSize/2), Vector2:new(math.huge, textSize), nil, words["newGame"], align)

	continue.text = Label:new(continue._pos + Vector2:new(size.x/2, size.y/2 - textSize/2), Vector2:new(math.huge, textSize), gray, words["continue"], align)

	back.text = Label:new(back._pos + Vector2:new(size.x/2, size.y/2 - textSize/2), Vector2:new(math.huge, textSize), nil, words["back"], align)

	newGame.OnButtonClick = {self._newGameClick, self}
	continue:disable()
	back.OnButtonClick = {self._backClick, self}

	campaingPanel.objects:add(0, "newGame", newGame)
	campaingPanel.objects:add(0, "continue", continue)
	campaingPanel.objects:add(0, "back", back)
	campaingPanel:hide()

	--Setting defaultPanel--
	self._defaultPanel.objects:add(0, "mainPanel", mainPanel)
	self._defaultPanel.objects:add(0, "campaingPanel", campaingPanel)

	self._prevPanelStack = {mainPanel}

	--Setting musics--
end

--load or reload scene
function TitleScene:loadScene()
	while #self._prevPanelStack ~= 0 do
		local currentPanel = table.remove(self._prevPanelStack)
		currentPanel:hide()
	end

	local mainPanel = self._defaultPanel.objects:get("mainPanel", 0)

	mainPanel:show()

	table.insert(self._prevPanelStack, mainPanel)
end

function TitleScene:_campaingClick()
	local prevPanel = self._prevPanelStack[#self._prevPanelStack]
	local campaingPanel = self._defaultPanel.objects:get("campaingPanel", 0)

	prevPanel:hide()
	campaingPanel:show()

	table.insert(self._prevPanelStack, campaingPanel)
end

function TitleScene:_newGameClick()
	SceneManager:loadScene("game")
end

function TitleScene:_optionsClick()

end

function TitleScene:_aboutClick()

end

function TitleScene:_backClick()
	local prevPanel = self._prevPanelStack[#self._prevPanelStack-1]
	local currentPanel = table.remove(self._prevPanelStack)

	currentPanel:hide()
	prevPanel:show()
end
