Event = Class:Create()
Event.handlers = {}

function Event:Create(name, create, other)
	if other == nil then other = true end
	
	if create then
		addEvent(name, other)
	end
	
	object = Class:Create(self)
	
	object.name = name
	
	
	Event.handlers[name] = {}
	
	return object;
end

function Event:Handle(func, element)
	if element == nil then element = getRootElement() end
	
	if not Event.handlers[self.name][element] then
		Event.handlers[self.name][element] = {};
	end
	
	if #Event.handlers[self.name][element] == 0 then
		addEventHandler(self.name, element, self.onTriggered )
	end
	
	
	table.insert(Event.handlers[self.name][element], { ["fn"] = func, ["element"] = element })
	
	return self;
end

function Event.onTriggered(...)
	for k,v in ipairs(Event.handlers[eventName][this]) do
		v.fn(Element:toObject(source), ...)
	end
end

function Event:ServerTrigger(element, ...)
	if type(element) == "table" then element = element.element end

	return triggerServerEvent(self.name, element, ...)
end

function Event:Trigger(element, ...)
	if type(element) == "table" then element = element.element end

	return triggerEvent(self.name, element, ...)
end

function index_extend(t, key)
	if key:sub(1,2) == "on" then		
		if key:sub(1, 8) == "onClient" then
			return Event:Create(key, true);
		else
			return Event:Create(key);
		end
	end
    return nil;
end

setmetatable(_G, {__index = index_extend})