--adapted by arsjac from original code by spell library

function KaboomAutocast( event )
	local caster = event.caster
	local ability = event.ability
	local autocast_radius = ability:GetSpecialValueFor("autocast_radius")
	

	if ability:GetAutoCastState() and ability:IsFullyCastable() then
		local target
		local enemies = FindUnitsInRadius(caster:GetTeamNumber(), caster:GetAbsOrigin(), nil, autocast_radius, DOTA_UNIT_TARGET_TEAM_ENEMY, DOTA_UNIT_TARGET_BASIC + DOTA_UNIT_TARGET_HERO, DOTA_UNIT_TARGET_FLAG_MAGIC_IMMUNE_ENEMIES, FIND_CLOSEST, false)
		for k,unit in pairs(enemies) do
			target = unit
			break			
		end

		if not target then
			return
		else
			caster:CastAbilityOnTarget(target, ability, caster:GetPlayerOwnerID())
		end
	end
end

function KaboomToggleAutocast( event )
	local missile = event.target
	local ability = missile:GetAbilityByIndex(0)
	
	ability:ToggleAutoCast()

end