org 0x100
%include "..\defaults_common.asm"

  mov ax,6
;  mov ax,0xa
  int 0x10

  mov dx,0x3d8
  mov al,0x1a
  out dx,al

  mov ax,0xb800
  mov es,ax
  mov di,0

  mov cx,100
yLoop:
  mov al,0

  push cx
  mov cx,16
cLoop:
  mov [es:di],al
  mov [es:di+1],al
  mov [es:di+2],al
  mov [es:di+3],al
  mov [es:di+4],al
  mov [es:di+0x2000],al
  mov [es:di+0x2001],al
  mov [es:di+0x2002],al
  mov [es:di+0x2003],al
  mov [es:di+0x2004],al
  add al,0x11
  add di,5
  loop cLoop
  pop cx

  loop yLoop


waitLoop:
  mov ah,1
  int 0x16
  jz doFrame
  jmp gotKeypress

doFrame:
  mov dx,0x3da
  waitForVerticalSync

%macro doScanline 2
  waitForDisplayEnable
  waitForDisplayDisable
  mov al,0x10 + %1
  out dx,al
  mov dl,0xde
  mov al,%2
  out dx,al
  mov dl,0xda
%endmacro

  doScanline 0x0,0x0
  doScanline 0xf,0x0
  doScanline 0xf,0x1
  doScanline 0xf,0x2
  doScanline 0xf,0x3
  doScanline 0xf,0x4
  doScanline 0xf,0x5
  doScanline 0xf,0x6
  doScanline 0xf,0x7
  doScanline 0xf,0x8
  doScanline 0xf,0x9
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0x1
  doScanline 0xf,0x1
  doScanline 0xf,0x2
  doScanline 0xf,0x3
  doScanline 0xf,0x4
  doScanline 0xf,0x5
  doScanline 0xf,0x6
  doScanline 0xf,0x7
  doScanline 0xf,0x8
  doScanline 0xf,0x9
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0x2
  doScanline 0xf,0x2
  doScanline 0xf,0x3
  doScanline 0xf,0x4
  doScanline 0xf,0x5
  doScanline 0xf,0x6
  doScanline 0xf,0x7
  doScanline 0xf,0x8
  doScanline 0xf,0x9
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0x3
  doScanline 0xf,0x3
  doScanline 0xf,0x4
  doScanline 0xf,0x5
  doScanline 0xf,0x6
  doScanline 0xf,0x7
  doScanline 0xf,0x8
  doScanline 0xf,0x9
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0x4
  doScanline 0xf,0x4
  doScanline 0xf,0x5
  doScanline 0xf,0x6
  doScanline 0xf,0x7
  doScanline 0xf,0x8
  doScanline 0xf,0x9
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0x5
  doScanline 0xf,0x5
  doScanline 0xf,0x6
  doScanline 0xf,0x7
  doScanline 0xf,0x8
  doScanline 0xf,0x9
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0x6
  doScanline 0xf,0x6
  doScanline 0xf,0x7
  doScanline 0xf,0x8
  doScanline 0xf,0x9
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0x7
  doScanline 0xf,0x7
  doScanline 0xf,0x8
  doScanline 0xf,0x9
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0x8
  doScanline 0xf,0x8
  doScanline 0xf,0x9
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0x9
  doScanline 0xf,0x9
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0xa
  doScanline 0xf,0xa
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0xb
  doScanline 0xf,0xb
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0xc
  doScanline 0xf,0xc
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0xd
  doScanline 0xf,0xd
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0xe
  doScanline 0xf,0xe
  doScanline 0xf,0xf

  doScanline 0x0,0xf
  doScanline 0xf,0xf

  jmp waitLoop

gotKeypress:
  mov ah,0x00
  int 0x16
  cmp al,27
  je finished
  jmp waitLoop

finished:
  mov ax,3
  int 0x10

  int 0x20




