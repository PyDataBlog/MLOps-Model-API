
[extern inter_handler]
[extern inter_handler_pr]

inter_common:
	pushad

	mov ax, ds
	push eax
	mov ax, 0x08 ; kernel data segment descriptor
	mov ds, ax
	mov es, ax
	mov fs, ax
	mov gs, ax

	cld ; TODO check if needed
	call inter_handler

	pop eax 
	pop eax
	mov ds, ax
	mov es, ax
	mov fs, ax
	mov gs, ax

	popad
	add esp, 8
	iret

inter_common_pr:
	pushad

	mov ax, ds
	push eax
	mov ax, 0x10
	mov ds, ax
	mov es, ax
	mov fs, ax
	mov gs, ax
	push esp

	cld
	call inter_handler_pr

	pop ebx  ; Different than the ISR code
	pop ebx
	mov ds, bx
	mov es, bx
	mov fs, bx
	mov gs, bx

	popad
	add esp, 8
	iret

; Set up inter_handler_??

%macro macro_inter_handler 1
global inter_handler_%1
inter_handler_%1:
	push dword %1
	jmp inter_common
%endmacro

%macro macro_inter_handler_errorless 1
global inter_handler_%1
inter_handler_%1:
	push dword 0         ; error code
	push dword %1 
	jmp inter_common
%endmacro

%macro macro_inter_handler_programma 1
global inter_handler_%1
inter_handler_%1:
	push dword 0         ; error code
	push dword %1 
	jmp inter_common_pr
%endmacro

macro_inter_handler_errorless 0 
macro_inter_handler_errorless 1 
macro_inter_handler_errorless 2
macro_inter_handler_errorless 3
macro_inter_handler_errorless 4
macro_inter_handler_errorless 5
macro_inter_handler_errorless 6
macro_inter_handler_errorless 7
macro_inter_handler           8
macro_inter_handler_errorless 9
macro_inter_handler           10
macro_inter_handler           11
macro_inter_handler           12
macro_inter_handler           13
macro_inter_handler           14
macro_inter_handler_errorless 15
macro_inter_handler_errorless 16
macro_inter_handler           17
macro_inter_handler_errorless 18
macro_inter_handler_errorless 19
macro_inter_handler_errorless 20
macro_inter_handler_errorless 21
macro_inter_handler_errorless 22
macro_inter_handler_errorless 23
macro_inter_handler_errorless 24
macro_inter_handler_errorless 25
macro_inter_handler_errorless 26
macro_inter_handler_errorless 27
macro_inter_handler_errorless 28
macro_inter_handler_errorless 29
macro_inter_handler_errorless 30
macro_inter_handler_errorless 31

macro_inter_handler_programma 32
macro_inter_handler_programma 33
macro_inter_handler_programma 34
macro_inter_handler_programma 35
macro_inter_handler_programma 36
macro_inter_handler_programma 37
macro_inter_handler_programma 38
macro_inter_handler_programma 39
macro_inter_handler_programma 40
macro_inter_handler_programma 41
macro_inter_handler_programma 42
macro_inter_handler_programma 43
macro_inter_handler_programma 44
macro_inter_handler_programma 45
macro_inter_handler_programma 46
macro_inter_handler_programma 47

