using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using HelpTheHomelessApp.Models;
using Xamarin.Forms;
using Xamarin.Forms.Xaml;

namespace HelpTheHomelessApp
{
	public partial class SurveyPage : ContentPage
	{
        public List<SurveyQuestionModel> Questions;
        public SurveyQuestionModel CurrentQuestion;

		public SurveyPage()
		{
			InitializeComponent();

            initQuestions();

            CurrentQuestion = Questions.First();

            LabelQuestion.Text = CurrentQuestion.QuestionText;
            LabelQuestionDetail.Text = CurrentQuestion.DetailText;

			ButtonYes.Clicked += ButtonYes_Clicked;
			ButtonNo.Clicked += ButtonNo_Clicked;
		}

		private void ButtonYes_Clicked(object sender, EventArgs e)
		{
            CurrentQuestion.Response = true;

            if (CurrentQuestion.ID == Questions.Count)
            {
                showResult();
            }
            else 
            {
                getNextQuestion();
            }
		}

		private void ButtonNo_Clicked(object sender, EventArgs e)
		{
            CurrentQuestion.Response = false;

			if (CurrentQuestion.ID == Questions.Count)
			{
                showResult();
			}
			else
			{
				getNextQuestion();
			}
		}

        private void initQuestions() 
        {
            Questions = new List<SurveyQuestionModel>();
            var i = 1;
            Questions.Add(new SurveyQuestionModel("Do you currently have a permanent residence?", "For example are privately renting a house/unit", 1, i++));
			// Detail from https://www.ag.gov.au/RightsAndProtections/HumanRights/Human-rights-scrutiny/PublicSectorGuidanceSheets/Pages/Righttoanadequatestandardoflivingincludingfoodwaterandhousing.aspx
			Questions.Add(new SurveyQuestionModel("Are the living conditions appropriate and adequate?", "Everyone has the right to an adequate standard of living including adequate food, water and housing and to the continuous improvement of living conditions.", 2, i++));
            Questions.Add(new SurveyQuestionModel("Do you have a source of income?", "Either from employment or benefits etc.", 2, i++));
            Questions.Add(new SurveyQuestionModel("Do you live alone?", "", 3, i++));
            Questions.Add(new SurveyQuestionModel("Is there a risk of or are you experiencing domestic/family violence at your current residence?", "", 4, i++));
            Questions.Add(new SurveyQuestionModel("Are you currently studying?", "e.g. School, Tafe or University student", 1, i++));
			// Detail from http://www.stresstips.com/what-is-financial-stress/
			Questions.Add(new SurveyQuestionModel("Are you under financial stress?", "In other words, this is stress that comes from being in debt, that comes from being unable to make the rent/mortgage repayment or that comes from knowing you’re going to have to spend a huge amount of money.", 2, i++));
            Questions.Add(new SurveyQuestionModel("Have you had an episode of homelessness before?", "", 3, i++));
        }

        private void getNextQuestion() 
        {
            CurrentQuestion = Questions[CurrentQuestion.ID];
			LabelQuestion.Text = CurrentQuestion.QuestionText;
			LabelQuestionDetail.Text = CurrentQuestion.DetailText;

            if (CurrentQuestion.ID == 7) 
            {
                LabelQuickTips.Text = "Did you know that most financial insitutions have a Hardship team there to assist you in difficult times? They may be able to temporarily reduce the financial strain to help you get back in control.";
            }
            else {
                LabelQuickTips.Text = "";
            }
        }

        private int getScore()
        {
			var score = 0;

			foreach (var question in Questions)
			{
				if (question.Response)
				{
					score += question.Score;
				}
			}

            return score;
        }

        private void showResult()
        {
            LabelQuestion.Text = "Score: " + getScore();

        }
	}
}
