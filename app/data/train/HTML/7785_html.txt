<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content=""> <meta name="generator" content="Hugo 0.26" />
    <title>Using cookies with HttpClient</title>
    <link href="" rel="alternate" type="application/rss+xml" title="knoone.info" />
    <link rel="stylesheet" type="text/css" href="http://knoone.info/css/semantic.min.css">
    <style type="text/css">
        body {
            background-color: #2D2D29;
        }
        .main.container {
            margin-top: 5em;
        }
        h4 {
            color: #ccc;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="http://knoone.info//js/semantic.min.js"></script>
    <link rel="canonical" href="http://knoone.info/2013/08/06/using-cookies-with-httpclient/" />
</head>

<body>

    <div class="ui fixed inverted small menu">
        <div class="ui container">
            <a href="http://knoone.info/" class="header item">knoone.info</a>
            <div class="ui simple dropdown item">
                Archives <i class="dropdown icon"></i>
                <div class="menu">
                    <a class="item" href="#"><i class="calendar icon"></i>2017</a>
                    <a class="item" href="#"><i class="calendar icon"></i>2016</a>
                    <a class="item" href="#"><i class="calendar icon"></i>2015</a>
                </div>
            </div>
            <div class="ui simple dropdown item">
                Tags <i class="dropdown icon"></i>
                <div class="menu">
                    
                    
                        <a class="item" href="http://knoone.info/tags/angularjs"><i class="tag icon"></i>angularjs</a>
                    
                        <a class="item" href="http://knoone.info/tags/beer"><i class="tag icon"></i>beer</a>
                    
                        <a class="item" href="http://knoone.info/tags/bootstrap"><i class="tag icon"></i>bootstrap</a>
                    
                        <a class="item" href="http://knoone.info/tags/career"><i class="tag icon"></i>career</a>
                    
                        <a class="item" href="http://knoone.info/tags/cat"><i class="tag icon"></i>cat</a>
                    
                        <a class="item" href="http://knoone.info/tags/food"><i class="tag icon"></i>food</a>
                    
                        <a class="item" href="http://knoone.info/tags/furniture"><i class="tag icon"></i>furniture</a>
                    
                        <a class="item" href="http://knoone.info/tags/gadgets"><i class="tag icon"></i>gadgets</a>
                    
                        <a class="item" href="http://knoone.info/tags/gardening"><i class="tag icon"></i>gardening</a>
                    
                        <a class="item" href="http://knoone.info/tags/hacking"><i class="tag icon"></i>hacking</a>
                    
                        <a class="item" href="http://knoone.info/tags/house"><i class="tag icon"></i>house</a>
                    
                        <a class="item" href="http://knoone.info/tags/humor"><i class="tag icon"></i>humor</a>
                    
                        <a class="item" href="http://knoone.info/tags/lastfm"><i class="tag icon"></i>lastfm</a>
                    
                        <a class="item" href="http://knoone.info/tags/misctech"><i class="tag icon"></i>misctech</a>
                    
                        <a class="item" href="http://knoone.info/tags/movies"><i class="tag icon"></i>movies</a>
                    
                        <a class="item" href="http://knoone.info/tags/mp3"><i class="tag icon"></i>mp3</a>
                    
                        <a class="item" href="http://knoone.info/tags/music"><i class="tag icon"></i>music</a>
                    
                        <a class="item" href="http://knoone.info/tags/nature"><i class="tag icon"></i>nature</a>
                    
                        <a class="item" href="http://knoone.info/tags/personal"><i class="tag icon"></i>personal</a>
                    
                        <a class="item" href="http://knoone.info/tags/photography"><i class="tag icon"></i>photography</a>
                    
                        <a class="item" href="http://knoone.info/tags/politics"><i class="tag icon"></i>politics</a>
                    
                        <a class="item" href="http://knoone.info/tags/portland"><i class="tag icon"></i>portland</a>
                    
                        <a class="item" href="http://knoone.info/tags/science"><i class="tag icon"></i>science</a>
                    
                        <a class="item" href="http://knoone.info/tags/shopping"><i class="tag icon"></i>shopping</a>
                    
                        <a class="item" href="http://knoone.info/tags/sports"><i class="tag icon"></i>sports</a>
                    
                        <a class="item" href="http://knoone.info/tags/television"><i class="tag icon"></i>television</a>
                    
                        <a class="item" href="http://knoone.info/tags/texas"><i class="tag icon"></i>texas</a>
                    
                        <a class="item" href="http://knoone.info/tags/travel"><i class="tag icon"></i>travel</a>
                    
                        <a class="item" href="http://knoone.info/tags/uncategorized"><i class="tag icon"></i>uncategorized</a>
                    
                        <a class="item" href="http://knoone.info/tags/weather"><i class="tag icon"></i>weather</a>
                    
                        <a class="item" href="http://knoone.info/tags/website"><i class="tag icon"></i>website</a>
                    
                        <a class="item" href="http://knoone.info/tags/webstuff"><i class="tag icon"></i>webstuff</a>
                    
                        <a class="item" href="http://knoone.info/tags/wedding"><i class="tag icon"></i>wedding</a>
                    
                </div>
            </div>
            <a href="#" class="item">About</a>            
            <div class="right menu">           
                 
                     
                <a href="https://www.linkedin.com/in/kevinnoone" class="item"><i class="linkedin icon"></i></a>
                 
                
                <a href="https://twitter.com/cleverswine" class="item"><i class="twitter icon"></i></a>
                 
                
                <a href="https://github.com/cleverswine" class="item"><i class="github icon"></i></a>
                 
                 
                <a href="http://knoone.info/index.xml" class="item"><i class="rss icon"></i></a>
            </div>
        </div>
    </div>

    <div class="ui main container">
            

<div class="ui fluid card">
    <div class="content">
        <div class="header">Using cookies with HttpClient</div>
        <div class="meta">
            <span class="category">
                
                    hacking
                
            </span>
        </div>
        <div class="description">
            <p>This simple code snippet shows how to store and use cookies from a web request using the .Net <a href="http://msdn.microsoft.com/en-us/library/system.net.http.httpclient.aspx" target="_blank">HttpClient</a>. For example, if an API or site sends a token or authentication cookie, you may need to store it and send it on all subsequent requests to show that you are authenticated. This would be for a session-based service. The key is to create a single <a href="http://msdn.microsoft.com/en-us/library/system.net.cookiecontainer.aspx" target="_blank">CookieContainer</a> instance and a single <a href="http://msdn.microsoft.com/en-us/library/system.net.http.httpclienthandler.aspx" target="_blank">HttpClientHandler</a> instance to hold it. Assume the following class is registered as a singleton.</p>

<pre lang="csharp">public class WebClient
{
    private CookieContainer _cookieContainer;
    private HttpClientHandler _handler;

    private HttpClientHandler Handler
    {
        get
        {
            if (_handler == null)
            {
                _cookieContainer = new CookieContainer();
                _handler = new HttpClientHandler { CookieContainer = _cookieContainer, UseCookies = true, AllowAutoRedirect = false };
            }
            return _handler;
        }
    }

    private HttpClient GetClient()
    {
        // the second param prevents the Handler from being disposed with the client
        var client = new HttpClient(Handler, false);
        client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));
        return client;
    }

    public async Task Get&lt;T>(string path) where T : class
    {
        using (var client = GetClient())
        {
            var content = await client.GetStringAsync(path);
            return JsonConvert.DeserializeObject&lt;T>(content);
        }
    }
}</pre>

        </div>
    </div>
    <div class="extra content">
        <div class="right floated author">
            <time datetime="2013-08-06T18:06:41Z">06 Aug 2013</time>
        </div>
    </div>
</div>    


    </div>  

    <p>
        &copy; 2017 knoone.info. All rights reserved.
    </p>

</body>
</html>