#
# SABnzbd
#

# Using Ubuntu 16.04 LTS
FROM ubuntu:16.04

# Yours truly
MAINTAINER Bill Walker <falklian@gmail.com>

# Set TERM=xterm to prevent 'term not set' error
ENV TERM=xterm

# Enable multiverse to use non-free unrar
RUN sed -ri 's/(xenial(-updates|-security)? main restricted)/\1 multiverse/g' /etc/apt/sources.list

# Add SABnzbd repo and key
RUN echo "deb http://ppa.launchpad.net/jcfp/ppa/ubuntu xenial main" > \
    /etc/apt/sources.list.d/sabnzbd.list && \
    apt-key adv --keyserver hkp://keyserver.ubuntu.com:11371 --recv-keys \
    0x98703123E0F52B2BE16D586EF13930B14BB9F05F

# Update and install some stuff, then clean up
RUN apt-get update && \
    DEBIAN_FRONTEND=noninteractive apt-get -y dist-upgrade && \
    DEBIAN_FRONTEND=noninteractive apt-get -y install \
        sabnzbdplus \
        unrar && \
    apt-get -y autoremove --purge && \
    apt-get -y clean && \
    rm -rf /var/lib/apt/lists/* && \
    rm -rf /tmp/*
    
# SABnzbd runs on port 8080
EXPOSE 8080

# Set up data and downloads volumes for storing whatnots
VOLUME ["/data", "/downloads"]

# Path to executable
ENTRYPOINT ["/usr/bin/sabnzbdplus"]

# Commands to pass to executable
CMD ["-f", "/data/sabnzbd.ini", "-s", "0.0.0.0:8080"]
