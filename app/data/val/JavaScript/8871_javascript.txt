function handleRace(data_races) {
  var ch_race;
  var ch_side;
    for (var ra in data_races.races) {
        if (data_races.races[ra].id === character_data.race) {
            ch_race = data_races.races[ra].name;
            ch_side = data_races.races[ra].side;
        }
        else { }
    }
    document.querySelector('div.info_image span.rac').textContent = ch_race;
    //$('div.info_image span.rac').text(ch_race);
    //document.querySelector('div.info_image div.sid').textContent = ch_side;
    //$('div.info_image div.sid').text(ch_side);
}

function handleClass(data_classes) {
  var ch_class;
    for (var cl in data_classes.classes) {
        if (data_classes.classes[cl].id === character_data.class) {
            ch_class = data_classes.classes[cl].name;
        }
        else { }
    }
    document.querySelector('div.info_image span.clss').
      textContent = ch_class;
    //$('div.info_image span.clss').text(ch_class);
}

var character_data;

function fetch_char(data) {
  character_data = data;
  // fetch image - card format
  var region = document.querySelector('input[name=region]:checked').value;
  var str = data.thumbnail;
  var pieces = [];
  pieces = str.split('-a');
  var card = 'http://' + region + '.battle.net/static-render/' +
    region + '/' + pieces[0] + '-card.jpg';
  // type of images: -avarar, -card, -profilemain, -inset
  document.querySelector('div.info_image').style.backgroundImage =
    'url("' + card + '")';

  // character data
  var ch_name = data.name;
  document.querySelector('div.info_image span.titl').textContent = '';

  for (var tit in data.titles) {
    if (data.titles[tit].selected) {
      var my_title = data.titles[tit].name;
      my_title = my_title.replace('%s', '');
      document.querySelector('div.info_image span.titl').textContent = my_title;
    }
  }

  document.querySelector('div.info_image span.nam').textContent = ch_name;

  url = 'http://' + region + '.battle.net/api/wow/data/character/races';

  jsonp_request(url, 'handleRace');

  url2 = 'http://' + region + '.battle.net/api/wow/data/character/classes';

  jsonp_request(url2, 'handleClass');

  var ch_gender = (data.gender === 0) ? 'Male' : 'Female';

  var ch_level = data.level;
  document.querySelector('div.info_image span.levl').textContent = ch_level;

  var ch_guild = (data.guild) ? data.guild.name : '';
  document.querySelector('div.info_image div.gld').textContent = ch_guild;

  var ch_server = data.realm;
  document.querySelector('div.info_image div.srv').textContent = ch_server;

  var ch_achiv = data.achievementPoints;
  document.querySelector('div.info_image div.achiv').innerHTML =
    ('<div class="achiv_icon"></div> ' + ch_achiv);

  // create character history
  var history_li = document.createElement('li');
  history_li.dataset.name = ch_name;
  history_li.dataset.server = ch_server;
  history_li.dataset.region = region;
  history_li.innerHTML =
    '<aside>' +
      '<img src="' + 'http://' + region + '.battle.net/static-render/' +
        region + '/' + data.thumbnail +
      '"></img>' +
    '</aside>' +
    '<p>' + ch_name + '</p>' +
    '<p>' + ch_server + ' - ' + region.toUpperCase() + '</p>';
  document.querySelector('ul.history').insertBefore(history_li,
    document.querySelector('ul.history').firstChild);

  // recall character form history
  [].forEach.call(document.querySelectorAll('ul.history > li'),
    function(li) {
      li.addEventListener('click', function() {
        document.querySelector('input[name=region][value=' +
          this.dataset.region + ']').checked = true;

        document.querySelector('input[name=server_name]').value =
          this.dataset.server;

        document.querySelector('input[name=char_name]').value =
          this.dataset.name;
      });
    });

}

// ON CLICK FUNCTION TO FETCH CHARACTER PETS
(function() {
  document.getElementById('char_button').addEventListener('click',
    function() {
      var region = document.querySelector('input[name=region]:checked').value;

      var server_name = document.querySelector('input[name=server_name]').value;

      var char_name = document.querySelector('input[name=char_name]').value;

      var url = 'http://' + region + '.battle.net/api/wow/character/' +
        server_name + '/' + char_name +
        '?fields=guild,titles';

      jsonp_request(url, 'fetch_char');

      document.getElementById('general_panel').style.display = 'block';

      document.getElementById('home_panel').style.display = 'none';

  });
})();
//////////////////////////////////
