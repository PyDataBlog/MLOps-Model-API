if($.cookie('age') !== 'pass') {
  $('body').addClass('uh-oh');
  $('#age-verify').show();
}

//generate map
function showMap() {
  //set locations
  var location = new google.maps.LatLng(39.90658,-105.09859);

  var stylesArray = [
    {
      "stylers": [
        { "saturation": -100 }
      ]
    },{
      "featureType": "road",
      "elementType": "geometry",
      "stylers": [
        { "visibility": "simplified" }
      ]
    },{
      "elementType": "labels.text.stroke",
      "stylers": [
        { "visibility": "off" }
      ]
    },{
      "elementType": "labels.text.fill",
      "stylers": [
        { "lightness": 3 }
      ]
    },{
      "featureType": "administrative.land_parcel",
      "elementType": "geometry",
      "stylers": [
        { "visibility": "simplified" }
      ]
    }
  ];

  //set options
  var myOptions = {
    center: location,
    zoom: 14,
    styles: stylesArray,
    disableDefaultUI: true,
    scrollwheel: false,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  //create map
  var map = new google.maps.Map(document.getElementById('map'),
    myOptions);

  //Add a marker and modal box
  var image = new google.maps.MarkerImage('/assets/img/icn.map-marker.png',
  //Marker size
  new google.maps.Size(100, 160),
  //Origin
  new google.maps.Point(0,0),
  //Anchor
  new google.maps.Point(50, 160));

  //place a custom marker
  var marker = new google.maps.Marker({
    position: location,
    map: map,
    icon: image
  });

  map.controls[google.maps.ControlPosition.TOP_RIGHT].push(new ZoomPanControl(map));

  //create elements
  function CreateElement(tagName, properties) {
    var elem = document.createElement(tagName);
    for (var prop in properties) {
      if (prop == "style")
        elem.style.cssText = properties[prop];
      else if (prop == "class")
        elem.className = properties[prop];
      else
        elem.setAttribute(prop, properties[prop]);
    }
    return elem;
  }

  //add map custom map controls
  function ZoomPanControl(map) {
    this.map = map
    var t = this
    var zoomPanContainer = CreateElement("div", { 'class':'map-controls' })
    //Map Controls
    div = CreateElement("div", {'title': 'Zoom in', 'class':'zoom-in' })
    google.maps.event.addDomListener(div, "click", function() { t.zoom(ZoomDirection.IN); })
    zoomPanContainer.appendChild(div)
    div = CreateElement("div", {'title': 'Center', 'class':'center-map' })
    google.maps.event.addDomListener(div, "click", function() { map.setCenter(location); })
    zoomPanContainer.appendChild(div)
    div = CreateElement("div", {'title': 'Zoom out', 'class':'zoom-out' })
    google.maps.event.addDomListener(div, "click", function() { t.zoom(ZoomDirection.OUT); })
    zoomPanContainer.appendChild(div)
    return zoomPanContainer
  }
  ZoomPanControl.prototype.zoom = function(direction) {
    var zoom = this.map.getZoom();
    if (direction == ZoomDirection.IN && zoom < 19)
      this.map.setZoom(zoom + 1);
    else if (direction == ZoomDirection.OUT && zoom > 1)
      this.map.setZoom(zoom - 1);
  }
  var ZoomDirection = {
    IN: 0,
    OUT: 1
  }
}

//load articles
function loadPost(href) {
  $('#beer').fadeIn(400)
  $('#beer').load(href + ' #beer > *', function(response, status, xhr) {
    if ( status == "error" ) {
      console.log(xhr.status)
    } else {
      $('body').addClass('beer')
    }
  })
}

(function() {

  // Highlight current section while scrolling DOWN
  $('.section').waypoint(function(direction) {
      if (direction === 'down') {
        var $link = $('a[href="/' + this.id + '"]');
        $('ul.nav.navbar-nav li').removeClass('active');
        $link.parent().addClass('active');
      }
  }, { offset: '50%' });

  // Highlight current section while scrolling UP
  $('.section').waypoint(function(direction) {
      if (direction === 'up') {
        var $link = $('a[href="/' + this.id + '"]');
        $('ul.nav.navbar-nav li').removeClass('active');
        $link.parent().addClass('active');
      }
  }, {
      offset: function() {
          // This is the calculation that would give you
          // "bottom of element hits middle of window"
          return $.waypoints('viewportHeight') / 2 - $(this).outerHeight();
      }
  });

  // history.js
  if(!$('body').hasClass('blog')) {
    $('ul.nav.navbar-nav li:not(".external") a, .beer > a').on('click', addressUpdate)
  }

  function addressUpdate(ev) {
    ev.preventDefault()
    var $that = $(this)
    var separator = ' | '
    var title = $(document).find('title').text()
    title = title.substring(title.indexOf(separator), title.length)
    
    //set title
    if($('h3', this).length) {
      title = $('h3', this).text() + title
    } else {
      title = $that.text() + title
    }

    //update url + title
    var href = $that.attr('href')
    History.pushState(null, title, href)
    
    //load post
    if($that.parent().hasClass('beer')) {
      loadPost(href)
    //scroll to section
    } else {
      $('#beer').fadeOut(400, function() {
        $('body').removeClass('beer')
      }).empty()
      $('html, body').stop().animate({
        scrollTop: ($('#' + href.replace('/', '')).offset().top-88)
      }, 2000,'easeInOutExpo')
    }
  }

})();

//on page load
$(window).load(function() {
  //scroll to section
  var path = document.location.pathname
  var article = path.split('/')[2]
  path = path.substring(path.lastIndexOf('/') + 1, path.length)
  if ($('#' + path).length && !article) {
    $('html, body').stop().animate({
      scrollTop: ($('#' + path).offset().top-88)
    }, 2000,'easeInOutExpo')
  } else if (typeof article !== 'undefined') {
    $(document).scrollTop($('#blog').offset().top)
    $('body').addClass('fixed')
  }
})

google.maps.event.addDomListener(window, "load", showMap);

$(document).ready(function() {

  // resizeContent()
  
  // //attach on resize event
  // $(window).resize(function() {
  //  resizeContent()
  // });

  // $('.hero-photo').each(function() {
  //  var img = $('> img', this)
  //  $(this).backstretch(img.attr('src'))
  //  img.hide()
  // })

  //setup full-screen images
  $('.full-img').each(function() {
    var img = $('> img', this)
    $(this).backstretch(img.attr('src'))
    img.hide()
  })

  //slider
  $('.slider').slick({
    autoplay: true,
    infinite: true,
    arrows: false,
    speed: 800,
    cssEase: 'cubic-bezier(0.86, 0, 0.07, 1)',
    slidesToShow: 1,
    slidesToScroll: 1,
    responsive: [
      {
        breakpoint: 480,
        settings: {
          dots: true,
          arrows: false
        }
      }
    ]
  })

  $('.trucks, .beers').slick({
    infinite: true,
    arrows: true,
    prevArrow: '<button type="button" class="slick-prev"><i class="fa fa-angle-left"></i></button>',
    nextArrow: '<button type="button" class="slick-next"><i class="fa fa-angle-right"></i></button>',
    speed: 800,
    cssEase: 'cubic-bezier(0.86, 0, 0.07, 1)',
    slidesToShow: 5,
    responsive: [
      {
        breakpoint: 1100,
        settings: {
          slidesToShow: 4,
          slidesToScroll: 1
        }
      },
      {
        breakpoint: 900,
        settings: {
          slidesToShow: 3,
          slidesToScroll: 1
        }
      },
      {
        breakpoint: 640,
        settings: {
          slidesToShow: 2,
          slidesToScroll: 1
        }
      },
      {
        breakpoint: 480,
        settings: {
          slidesToShow: 1,
          slidesToScroll: 1,
          arrows: false,
          dots: true
        }
      }
    ]
  })

  //truck hover text
  // $('.truck').on('hover', function () {
  //   //stuff to do on mouse enter
  //   $('.overlay', this).stop().fadeIn(200)
  // }, 
  // function () {
  //   //stuff to do on mouse leave
  //   $('.overlay', this).stop().fadeOut(200)
  // });

  $(document).on({
    mouseenter: function () {
      //stuff to do on mouse enter
      $('.overlay', this).stop().fadeIn(200)
    },
    mouseleave: function () {
      //stuff to do on mouse leave
      $('.overlay', this).stop().fadeOut(200)
    }
  }, '.truck');

  //mobile help
  $(document).on('touchstart touchend', function(e) {
    e.preventDefault()
    $('.overlay', this).stop().fadeToggle(200)
  }, '.truck');

  $('#mc-form').ajaxChimp({
    url: 'http://nickdimatteo.us2.list-manage.com/subscribe/post?u=3d3f46742d639b10307a1d9d8&amp;id=a1365fcbea'
  });

  //age verification
  $('#age-verify #enter').on('click', function(e) {
    e.preventDefault();
    
    $.cookie('age', 'pass');
    
    $('#age-verify').fadeOut(400, function() {
      $('body').removeClass('uh-oh');
    });
  });

  //go to admin
  $(document).keyup(function(e) {
    if (e.keyCode == 27) {
      console.log('hello')
      window.location.href = '/admin';
    }
  });

})