#!/bin/sh

# Grid Engine options (lines prefixed with #$)
#$ -cwd                  
#  These options are:
#  job name: -N
#  use the current working directory: -cwd

# Initialise the environment modules
. /etc/profile.d/modules.sh

# Load modules
module load igmm/apps/python/2.7.10
module load igmm/apps/R/3.3.3


SCRATCH=/exports/eddie/scratch/dwragg
PROJECT="Epistasis"

SEEDFILE=
GTF=
OUT=

while getopts ":s:g:o:" opt; do
  case $opt in
    s) SEEDFILE=${OPTARG};;
    g) GTF=${OPTARG};;
    o) OUT=${OPTARG};;
  esac
done

if [[ -z ${SEEDFILE} ]] | [[ -z ${GTF} ]] | [[ -z ${OUT} ]]
then
  echo "Error"
  exit 1
fi

SEED=$(awk "NR==$SGE_TASK_ID" $SEEDFILE)

echo "Gene: ${SEED}"

GENE=$(echo ${SEED} | awk '{
  split($1, a, ".")
  print(a[1])
  }')

grep ${GENE} ${GTF} > ${OUT}/${SEED}.gtf
sed -i "s/${GENE}/${SEED}/g" ${OUT}/${SEED}.gtf 

