#!/bin/bash

#########################################################
# globals
#########################################################
OVERWRITE=
#########################################################
# functions
#########################################################
#########################################################
# usages
#########################################################
usage() {
   echo "usage: jsstrip.sh [-o] in.js [out.js]"
}
#########################################################
# main
#########################################################
shortoptions='o'
longoptions='overwrite'
getopt=$(getopt -o $shortoptions --longoptions  $longoptions -- "$@")
if [ $? != 0 ]; then
   usage
   exit 1;
fi

eval set -- "$getopt"
while true; do
   case "$1" in
      -h|--help)
         usage
         exit 1
      ;;
      -o|--overwrite)
         OVERWRITE=true
         shift 1
      ;;
      --)
         shift 1
         break
      ;;
      
      *)
         break
      ;;
   esac
done

INFILE=$1

JSB="../../../tools/node/lib/node_modules/js-beautify/js/bin/js-beautify.js"
java -jar bin/compiler.jar --language_in=ES5 --language_out=ES5 --charset UTF-8 -O WHITESPACE_ONLY $INFILE --js_output_file /tmp/.js 2>&1 | grep -v Multiline_string |grep -v ShaderCode | fgrep -v '^'
if [ -e $JSB ] ; then
	if [ -n "$OVERWRITE" ] ; then
		 $JSB  -o $INFILE  /tmp/.js 
	else
		 $JSB   /tmp/.js
	fi
else
	cp /tmp/.js $INFILE
fi
