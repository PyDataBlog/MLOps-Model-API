#!/usr/bin/env bash

apt-get update;

##########Installing mc##########
apt-get install -y mc;
apt-get install -y git;

#preparation for php5.6
apt-get install -y php5;
apt-get install -y php5-mcrypt;
apt-get install -y php5-mysql;
apt-get install -y php5-curl;
apt-get install -y php5-gd;
apt-get install -y php5-mysqlnd;

#mysql
debconf-set-selections <<< 'mysql-server mysql-server/root_password password 123';
debconf-set-selections <<< 'mysql-server mysql-server/root_password_again password 123';
apt-get install -y mysql-server;

mysql -uroot -p123 -e "CREATE DATABASE \`wp\` DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_unicode_ci";

#modRewrite
sudo a2enmod rewrite;
sudo sed -i 's/AllowOverride None/AllowOverride All/g' /etc/apache2/apache2.conf;
sudo sed -i "s/<VirtualHost \*:80>/<VirtualHost \*:80>\n<Directory \/var\/www\/html>\nOptions Indexes FollowSymLinks MultiViews\nAllowOverride All\nOrder allow,deny\nallow from all\n<\/Directory>/g" /etc/apache2/sites-available/000-default.conf;

#change Apache user
sudo sed -i 's/www-data/vagrant/g' /etc/apache2/envvars;

#set apache root
apt-get install -y curl;
if ! [ -L /var/www/html ]; then
  rm -rf /var/www/html;
  ln -fs /vagrant/public /var/www/html;
  cd /vagrant/;
  curl -sS https://getcomposer.org/installer | php;
  php ./composer.phar install;
fi

