#!/bin/bash
cd /usr/src/app

if [ ! -d "/usr/src/app/node_modules" ]; then
  # there's a problem handling symlinks on windows at the time of writing
  # https://github.com/yarnpkg/yarn/issues/1961#issuecomment-275879675
  yarn add fs-extra && yarn install --no-bin-links

  # fixes missing binaries caused by --no-bin-links
  curl -L https://gist.githubusercontent.com/flyingbuddha/8ae5cf28c089d55135582d38e5557474/raw/b4fa96ab44d9e761696b03c5a476b9d17f583efa/fix-bin-links.js | node
fi;

# go
yarn run docker-server
