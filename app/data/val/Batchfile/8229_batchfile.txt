@rem ***************************************************************************
@rem Licensed Materials - Property of IBM
@rem ï¿½ Copyright IBM Corporation 2015. All Rights Reserved.
@rem
@rem Note to U.S. Government Users Restricted Rights:  
@rem Use, duplication or disclosure restricted by GSA ADP Schedule 
@rem Contract with IBM Corp.
@rem ***************************************************************************
REM
REM Licensed Materials - Property of IBM
REM (c) Copyright IBM Corporation 2014. All Rights Reserved.
REM 
REM  Note to U.S. Government Users Restricted Rights:  
REM  Use, duplication or disclosure restricted by GSA ADP Schedule 
REM  Contract with IBM Corp. 
REM

@ECHO OFF

REM patchset-created --change <change id> --is-draft <boolean> --kind <change kind> --change-url <change url> --change-owner <change owner> --project <project name> --branch <branch> --topic <topic> --uploader <uploader> --commit <sha1> --patchset <patchset id>

REM
REM JAZZ_REPO_URL
REM NOTE: Starting with 5.0.2 release, this variable is deprecated (and, would be removed from this script in a future release).
REM The repository URL is expected to be a config property ('rtc.repourl') of the corresponding Git repository.
REM However, if it is not defined, we fall back on to this value.
REM (Implies that in case of differing values between this variable and the config property of that repository, the config value takes precedence)
REM
SET JAZZ_REPO_URL="https://localhost:9443/jazz"

REM
REM PYTHON_PATH
REM Absolute path to python 3.3.5 executable
REM
SET PYTHON_PATH="C:/Python33/python"

REM
REM HOOKS_PATH
REM Absolute path of the directory where RTC Git hooks are stored
REM
SET HOOKS_PATH="C:/gerrit/scripts"

REM Extract the required values from the command line string
REM The command line parameters and its order is assumed to be the following 
REM --change <change id> --is-draft <boolean> --kind <change kind> --change-url <change url> --change-owner <change owner> --project <project name> --branch <branch> --topic <topic> --uploader <uploader> --commit <sha1> --patchset <patchset id>
REM If the command line parameter or their order changes then below logic to extract the values should be changed accordingly.  

SET CHANGE_URL=%8
SHIFT
SHIFT
SET USER=%8
SHIFT
SHIFT
SET PROJECT=%8
SHIFT
SHIFT
SET REF_NAME=%8
SHIFT
SHIFT
SHIFT
SHIFT
SET COMMIT_SHA1=%8

REM
REM Customize Keys for each project
REM
REM GIT_REPO_KEY
REM NOTE: Starting with 5.0.2 release, this variable is deprecated (and, would be removed from this script in a future release).
REM The repository URL is expected to be a config property ('rtc.repokey') of the corresponding Git repository.
REM However, if it is not defined, we fall back on to this value.
REM (Implies that in case of differing values between this variable and the config property of that repository, the config value takes precedence)
REM
IF "%PROJECT%" == "TestGitRepo" (
	SET GIT_REPO_KEY="3ba37d811d36453f9a72186dc5bf37ec"
) ELSE IF "%PROJECT%" == "<Git-Repository-Name>" (
	SET GIT_REPO_KEY="<replace-with-the-repository-key>"
)

%PYTHON_PATH% %HOOKS_PATH%/AssociateCommitToWorkitem.py %JAZZ_REPO_URL% %GIT_REPO_KEY% %USER% %REF_NAME% %COMMIT_SHA1% %CHANGE_URL%
if ERRORLEVEL 1 EXIT /B 1
EXIT /B 0