<?php session_start(); ?>
<?php include('php/db.php'); ?>
<!DOCTYPE html>
<html>
    <head>
        <title>To Do - Paperclip</title>
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css' />
        <script src='https://code.jquery.com/jquery-3.1.0.min.js'></script>
        <script src='https://code.jquery.com/ui/1.12.0/jquery-ui.min.js'></script>
        <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'></script>
        <link rel='stylesheet' type='text/css' href='style/common.css' />
        <script src='js/common.js'></script>
        <script src='js/cards.js'></script>
        <script src='js/menu.js'></script>
        <style>
            @media(max-width:845px) { .DesktopMenu { display:none; } .mainBody { padding-left:20px; } .MobileMenu { display:inline; } }
            @media(min-width:846px) { .DesktopMenu { display:inline; } .mainBody { padding-left:230px; } .MobileMenu { display:none; } }
            @media(max-width:1095px) { .Card { width:100%; } }
            @media(min-width:1094px) { .Card { width:400px; } }
        </style>
        <script>
            function populateEdit(task) {
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var response = JSON.parse(this.responseText);
                        var TimeSelect = "";
                        switch(response.Time) {
                            case '5': TimeSelect = "<select name='Time'><option value='5' selected='selected'>5 mins</option><option value='15'>15 mins</option><option value='30'>30 mins</option><option value='60'>1 hour</option><option value='120'>2 hours</option><option value='180'>3 hours</option><option value='181'>>3 hours</option></select>"; break;
                            case '15': TimeSelect = "<select name='Time'><option value='5'>5 mins</option><option value='15' selected='selected'>15 mins</option><option value='30'>30 mins</option><option value='60'>1 hour</option><option value='120'>2 hours</option><option value='180'>3 hours</option><option value='181'>>3 hours</option></select>"; break;
                            case '30': TimeSelect = "<select name='Time'><option value='5'>5 mins</option><option value='15'>15 mins</option><option value='30' selected='selected'>30 mins</option><option value='60'>1 hour</option><option value='120'>2 hours</option><option value='180'>3 hours</option><option value='181'>>3 hours</option></select>"; break;
                            case '60': TimeSelect = "<select name='Time'><option value='5'>5 mins</option><option value='15'>15 mins</option><option value='30'>30 mins</option><option value='60' selected='selected'>1 hour</option><option value='120'>2 hours</option><option value='180'>3 hours</option><option value='181'>>3 hours</option></select>"; break;
                            case '120': TimeSelect = "<select name='Time'><option value='5'>5 mins</option><option value='15'>15 mins</option><option value='30'>30 mins</option><option value='60'>1 hour</option><option value='120' selected='selected'>2 hours</option><option value='180'>3 hours</option><option value='181'>>3 hours</option></select>"; break;
                            case '180': TimeSelect = "<select name='Time'><option value='5'>5 mins</option><option value='15'>15 mins</option><option value='30'>30 mins</option><option value='60'>1 hour</option><option value='120'>2 hours</option><option value='180' selected='selected'>3 hours</option><option value='181'>>3 hours</option></select>"; break;
                            case '181': TimeSelect = "<select name='Time'><option value='5'>5 mins</option><option value='15'>15 mins</option><option value='30'>30 mins</option><option value='60'>1 hour</option><option value='120'>2 hours</option><option value='180'>3 hours</option><option value='181' selected='selected'>>3 hours</option></select>"; break;
                            default: TimeSelect = "<select name='Time'><option value='5'>5 mins</option><option value='15'>15 mins</option><option value='30'>30 mins</option><option value='60'>1 hour</option><option value='120'>2 hours</option><option value='180'>3 hours</option><option value='181'>>3 hours</option></select>"; break; }
                        var PrioritySelect = "";
                        switch(response.Priority) {
                            case '3': PrioritySelect = "<select name='Priority'><option value='3' selected='selected'>High</option><option value='2'>Medium</option><option value='1'>Low</option></select>"; break;
                            case '2': PrioritySelect = "<select name='Priority'><option value='3'>High</option><option value='2' selected='selected'>Medium</option><option value='1'>Low</option></select>"; break;
                            case '1': PrioritySelect = "<select name='Priority'><option value='3'>High</option><option value='2'>Medium</option><option value='1' selected='selected'>Low</option></select>"; break;
                            default: PrioritySelect = "<select name='Priority'><option value='3'>High</option><option value='2'>Medium</option><option value='1'>Low</option></select>"; break; }
                        document.getElementById("EditForm").innerHTML = "<button onclick='HideEdit()' style='float:left;background-color:#FAFAFA; margin:5px; border:none;'><span class='glyphicon glyphicon-remove'></span></button><form method='POST' action='edit.php'><center><h2>Change Task</h2><br><input type='hidden' name='source-page' value='ToDo' /><input type='hidden' name='OldTask' value='"+response.Task+"' /><table style='font-size:18px;' class='AddTaskTable'><tr><td style='text-align:right;'>Task: </td><td><input type='text' name='Task' value='"+response.Task+"' /></td></tr><tr><td style='text-align:right;'>Time: </td><td>" + TimeSelect + "</td></tr><tr><td style='text-align:right;'>Priority: </td><td>" + PrioritySelect + "</td></tr></table><br><button type='submit' class='ConfirmAddButton'>Change</button></center></form>";
                    }
                };
                xhttp.open("GET", ("php/populate-edit.php?table=ToDo&id="+task), true);
                xhttp.send();
                ShowEdit();
            }
        </script>
        <?php
            include 'php/colouring.php';
            $todo = FetchMySQL("SELECT * FROM `ToDo` WHERE userID='0';");
            $num = count($todo);
        ?>
    </head>
    <body>
        <style>.AddTaskTable td { padding:5px; font-size:18px; }</style>
        <div class="AddNewWrapper" style="display:none;">
            <div class="AddNewBackground" style="display:none; width:100%; height:100%; position:fixed; top:0; left:0; background-color:#000; opacity:0.7; z-index:900;"></div>
            <center>
                <div class="AddNewForm" style="display:none; border-radius:2px; position:fixed; top:40px; left:0; background-color:#FFF; opacity:10.0; width:400px; height:250px; z-index:905; ">
                    <button onclick="HideAddNew()" style="float:left;background-color:#FAFAFA; margin:5px; border:none;"><span class="glyphicon glyphicon-remove"></span></button>
                    <form method="POST" action="add.php">
                        <center>
                            <h2>Add Task</h2><br>
                            <input type="hidden" name="source-page" value="ToDo" />
                            <table class="AddTaskTable">
                                <tr>
                                    <td style="text-align:right;">Task: </td>
                                    <td><input type="text" name="Task" /></td>
                                </tr>
                                <tr>
                                    <td style="text-align:right;">Time: </td>
                                    <td>
                                        <select name="Time">
                                            <option value="5">5 mins</option>
                                            <option value="15">15 mins</option>
                                            <option value="30">30 mins</option>
                                            <option value="60">1 hour</option>
                                            <option value="120">2 hours</option>
                                            <option value="180">3 hours</option>
                                            <option value="181">>3 hours</option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="text-align:right;">Priority: </td>
                                    <td>
                                        <select name="Priority">
                                            <option value="3">High</option>
                                            <option value="2">Medium</option>
                                            <option value="1">Low</option>
                                        </select>
                                    </td>
                                </tr>

                            </table><br>
                            <button type="submit" class="ConfirmAddButton">Add</button>
                        </center>
                    </form>
                </div>
                <div id="EditForm" style="display:none; border-radius:2px; position:fixed; top:40px; left:0; background-color:#FFF; opacity:10.0; width:400px; height:250px; z-index:905; "></div>
            </center>
        </div>

        <style>
        body { background-color:<?php echo body_bg_color(); ?>; }
        .mainBody { background-color:<?php echo body_bg_color(); ?>; }
        .userInfo { background-color:<?php echo active_menu_bg(); ?>; color:<?php echo body_bg_color(); ?>; }
        .menu > .nav-pills > li > a { color:#444; }
        .menu > .nav-pills > li.active > a, .menu > .nav-pills > li.active > a:focus { color: <?php echo body_bg_color(); ?>; background-color: <?php echo active_menu_bg(); ?>; }
        .menu > .nav-pills > li.active > a:hover { background-color:<?php echo active_menu_bg(); ?>; color:<?php echo body_bg_color(); ?>; }
        .MobileMenuMenu { display:inline-block; width:40%; }
        .MobileMenuMenu > center > .nav-pills > li > a { color:#444; }
        .MobileMenuMenu > center > .nav-pills > li.active > a, .menu > .nav-pills > li.active > a:focus { color: <?php echo body_bg_color(); ?>; background-color: <?php echo active_menu_bg(); ?>; }
        .MobileMenuMenu > center > .nav-pills > li.active > a:hover { background-color:<?php echo active_menu_bg(); ?>; color:<?php echo body_bg_color(); ?>; }
        .SignOutNav button { background-color:<?php echo active_menu_bg(); ?>; }
        .SignOutNav button:hover { background-color:<?php echo signout_hover(); ?>; }
        </style>

        <div class="DesktopMenu">
            <div class="sidebar">
                <div class="userInfo">
                    <br>
                    <center>
                        <h4 class="fullName"><?php echo $_SESSION["name"]; ?></h4>
                        <span class="email"><?php echo $_SESSION["email"]; ?></span>
                    </center>
                </div>
                <div class="menu">
                    <ul class="nav nav-pills nav-stacked green">
                        <li><a href="index.php"><span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span>&nbsp;&nbsp;Overview</a></li>
                        <li><a href="homework.php"><span class="glyphicon glyphicon-file" aria-hidden="true"></span>&nbsp;&nbsp;Homework</a></li>
                        <li class="active"><a href="#"><span class="glyphicon glyphicon-check" aria-hidden="true"></span>&nbsp;&nbsp;To Do</a></li>
                        <li><a href="appointments.php"><span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>&nbsp;&nbsp;Appointments</a></li>
                        
                        <li><a href="notes.php"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>&nbsp;&nbsp;Notes</a></li>
                        <li><a href="settings.php"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span>&nbsp;&nbsp;Settings</a></li>
                    <ul>
                </div>
                <nav class="navbar navbar-default navbar-fixed-bottom SignOutNav">
                    <div class="container">
                        <form action="signout.php" method="GET">
                            <button type="submit" style="color:#FAFAFA;" class="btn navbar-btn">Sign Out</button>
                        </form>
                    </div>
                </nav>
            </div>
        </div>

        <div class="MobileMenu">
            <div class="MobileMenuHeader" style="width:100%; background-color:#29b962; height:40px;">
                <button class="MobileMenuToggleButton" style="padding:5px; font-size:20px; background-color:#29b962; color:#FAFAFA; border:none; ">
                    <span onclick="ToggleMobileMenu()" class="glyphicon glyphicon-menu-hamburger"></span>
                </button>
            </div>
            <center>
                <div class="MobileMenuMenu">
                    <center>
                        <ul class="nav nav-pills nav-stacked green">
                            <li><a href="index.php"><span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span>&nbsp;&nbsp;Overview</a></li>
                            <li><a href="homework.php"><span class="glyphicon glyphicon-file" aria-hidden="true"></span>&nbsp;&nbsp;Homework</a></li>
                            <li class="active"><a href="#"><span class="glyphicon glyphicon-check" aria-hidden="true"></span>&nbsp;&nbsp;To Do</a></li>
                            <li><a href="appointments.php"><span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>&nbsp;&nbsp;Appointments</a></li>
                        <ul>
                    </center>
                </div>
                <div class="MobileMenuMenu">
                    <center>
                        <ul class="nav nav-pills nav-stacked green">
                            
                            <li><a href="notes.php"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>&nbsp;&nbsp;Notes</a></li>
                            <li><a href="settings.php"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span>&nbsp;&nbsp;Settings</a></li>
                        <ul>
                    </center>
                </div>
            </center>
        </div>

        <div class="mainBody">
            <div class="title">
                <h2>To Do&nbsp;
                <div class="btn-group">
                    <button type="button" class="btn btn-default btn-lg" onclick="ShowAddNew('')"><span class="glyphicon glyphicon-plus"></span></button>
                </div></h2>
            </div>
            <div class="rightIcon">
                <span class="glyphicon glyphicon-check" aria-hidden="true"></span>
            </div><br><br><br>

            <?php if ($num > 0): ?>
                <?php  foreach($todo as $item): ?>
                    <div class="Card">
                        <div class="CardTitle"><?php echo $item["Task"]; ?></div>
                        <div class="CardOverlay">
                            <table>
                                <tr>
                                    <td>
                                        <form action="remove.php" method="POST">
                                            <input type="hidden" name="source-page" value="ToDo" />
                                            <input type="hidden" name="Task" value="<?php echo $item["Task"]; ?>" />
                                            <button class="CardOverlayButton done" type="submit"><span style="font-size:15px; padding:4px;" class="glyphicon glyphicon-ok"></span></button>
                                        </form>
                                    </td>
                                    <td>
                                        <button onclick="populateEdit('<?php echo $item["Task"]; ?>')" class="CardOverlayButton edit" type="submit"><span style="font-size:15px; padding:4px;" class="glyphicon glyphicon-pencil"></span></button>
                                    </td>
                                    <td>
                                        <form action="remove.php" method="POST">
                                            <input type="hidden" name="source-page" value="ToDo" />
                                            <input type="hidden" name="Task" value="<?php echo $item["Task"]; ?>" />
                                            <button class="CardOverlayButton del" type="submit"><span style="font-size:15px; padding:4px;" class="glyphicon glyphicon-remove"></span></button>
                                        </form>
                                    </td>
                                </tr>
                            </table>
                        </div><br>
                        <div style="display:inline-block;">
                            <?php echo $item["Description"]; ?>
                            Time:
                            <?php
                                if (intval($item["Time"]) < 60): echo strval($item["Time"]);
                                else:
                                    if (intval($item["Time"]) > 180): echo ">3 hours";
                                    else:
                                        if ((intval($item["Time"])/60) == 1): echo strval(intval($item["Time"])/60) . " hour";
                                        else: echo strval(intval($item["Time"])/60) . " hours";
                                        endif;
                                    endif;
                                endif;
                            ?><br>
                        </div>
                    </div>
                <?php endforeach; ?>
            <?php else: ?>
                There are no to-do list items.
            <?php endif; ?>
            <br><br><br><br>
        </div>
    </body>
</html>
