<?php require_once('login_auth.php');
if (!($_SESSION['SESS_USER_TYPE']=='A'))
{
	header("location: login_access_denied.php");
	exit();
	
}
?>
<input type="button" value="Pending requests" id="pending_requests_button">
<input type="button" value="Pending Offers" id="pending_offers_button" >
<input type="button" value="Connected users" id="connected_button">
<input type="button" value="Delivered material" id="delivered_button">
<div class='itemcontainer' id="pending_requests">
<?php
include('prod_conn.php');
$link = mysql_connect("$dbhost","$dbuser","$dbpass");
if(!$link) {
	die('Failed to connect to server: ' . mysql_error());
	}
//Select database
$db = mysql_select_db("$dbdatabase");
if(!$db) {
	die("Unable to select database");
}
$request_query="SELECT * FROM kind_donations 
				JOIN items on kind_donations.item_id=items.item_id
				JOIN item_category on items.category_id=item_category.category_id 
				JOIN project_partners on kind_donations.partner_id=project_partners.partner_id
				WHERE initiative_type='0' AND kind_donations.status='Pending'";
$request_ex=mysql_query($request_query);
if(mysql_num_rows($request_ex)>0){
?>
<?php 
echo "<h3>Pending Requests</h3>";
echo "<table class='table-item' style='width:750px;border-radius:1em;border:1px solid transparent'>
		<tr style=''>
			<th style='background:#fff;width:30px;font-size:12px;padding:0px;margin:0px'>Category</th>
			<th>Item name</th>
			<th>Quantity</th>
			<th>Requested By</th>
			<th>Address</th>
			<th>Transport</th>
			<th></th>
		</tr>
	</table>";
$i=0;
while($row=mysql_fetch_array($request_ex)){	?>
	<div class="postedComment" id="<?php echo $row['donation_id']; ?>">
		<div class="itemdiv <?php echo $row['category']; ?>" id="item<?php echo $row['donation_id']; ?>">
			<table class="table-item">
				<tr>
					<td  style="font-size:13px;font-weight:bold;" id="item<?php echo $row['donation_id'];?>">
						<span class="link">
							<a><?php echo $row['donationitem']; ?>
							<span id="note<?php echo $row['donation_id'];?>">
								<p style="margin:5px;padding:5px;"><?php echo $row['note'];?></p>
							</span>
							</a>
						</span> 
					</td>
					<td><?php echo $row['request_quantity']." (".$row['unit_quantity']." ".$row['units_type'].")"; ?></td>
					<td><a href="<?php echo $row['partner_email']; ?>" target="_blank"><?php echo $row['name']; ?></a></td>
					<td><?php echo $row['request_address'].", ".$row['request_city'];?></td>
					<td><?php if($row['transport']==1) echo "<img src='images/npo.png' alt='Pick-Up' />"; else echo "<img src='images/donor.png' alt='Deliver' />" ?></td>
					<td><form name="donationrequest" method="POST" action="inkind_commitments.php"><input type="text" value="<?php echo $row['donation_id'];?>" name="id" hidden /><input type="submit" value="Activate" name="activate_request" /><input type="submit" value="Stall" name="stall_request" /></form></td>
				</tr>
			</table>
		</div>
	</div>
<?php
	}}
else {
		echo "There are no pending requests.";
	}
?>
</div>
<div class='itemcontainer' id="pending_offers">
<?php 
$offer_query="SELECT * FROM kind_donations 
				JOIN items on kind_donations.item_id=items.item_id
				JOIN item_category on items.category_id=item_category.category_id 
				JOIN donors on kind_donations.donor_id=donors.donor_id
				WHERE initiative_type='1' AND kind_donations.status='Pending'";
$offer_ex=mysql_query($offer_query);
if(mysql_num_rows($offer_ex)>0){
echo "<h3>Pending Offers</h3>";
echo "<table class='table-item' style='width:750px;border-radius:1em;border:1px solid transparent'>
		<tr style=''>
			<th style='background:#fff;width:30px;font-size:12px;padding:0px;margin:0px'>Category</th>
			<th>Item name</th>
			<th>Quantity</th>
			<th>Requested By</th>
			<th>Address</th>
			<th>Transport</th>
			<th></th>
		</tr>
	</table>";
$i=0;
while($row=mysql_fetch_array($offer_ex)){	?>
	<div class="postedComment" id="<?php echo $row['donation_id']; ?>">
		<div class="itemdiv <?php echo $row['category']; ?>" id="item<?php echo $row['donation_id']; ?>">
			<table class="table-item">
				<tr>
					<td  style="font-size:13px;font-weight:bold;" id="item<?php echo $row['donation_id'];?>">
						<span class="link">
							<a><?php echo $row['donationitem']; ?>
							<span id="note<?php echo $row['donation_id'];?>">
								<p style="margin:5px;padding:5px;"><?php echo $row['note'];?></p>
							</span>
							</a>
						</span> 
					</td>
					<td><?php echo $row['offer_quantity']." (".$row['unit_quantity']." ".$row['units_type'].")"; ?></td>
					<td><a href="<?php echo $row['preferred_email']; ?>" target="_blank"><?php echo $row['displayname']; ?></a></td>
					<td><?php echo $row['offer_address'].", ".$row['offer_city'];?></td>
					<td><?php if($row['transport']==1) echo "<img src='images/npo.png' alt='Pick-Up' />"; else echo "<img src='images/donor.png' alt='Deliver' />" ?></td>
					<td><form name="donationoffer" method="POST" action="inkind_commitments.php"><input type="text" value="<?php echo $row['donation_id'];?>" name="id" hidden /><input type="submit" value="Activate" name="activate_offer" /><input type="submit" value="Stall" name="stall_offer" /></form></td>
				</tr>
			</table>
		</div>
	</div>
<?php
	}}
else {
		echo "There are no pending offers.";
	}
?>
</div>
<div class='itemcontainer' id="connected">
<?php 
$connected_query="SELECT * FROM kind_donations 
				JOIN items on kind_donations.item_id=items.item_id
				JOIN item_category on items.category_id=item_category.category_id 
				JOIN project_partners on kind_donations.partner_id=project_partners.partner_id
				JOIN donors on kind_donations.donor_id=donors.donor_id
				WHERE kind_donations.status='Connected'";
$connected_ex=mysql_query($connected_query);
if(mysql_num_rows($connected_ex)>0){
?>
<?php 
echo "<h3>Connected users</h3>";
echo "<table class='table-item' style='width:750px;border-radius:1em;border:1px solid transparent'>
		<tr style=''>
			<th style='background:#fff;width:30px;font-size:12px;padding:0px;margin:0px'>Category</th>
			<th>Item name</th>
			<th>Quantity</th>
			<th>Requested By</th>
			<th>Address</th>
			<th>Transport</th>
			<th></th>
		</tr>
	</table>";
$i=0;
while($row=mysql_fetch_array($connected_ex)){	?>
	<div class="postedComment" id="<?php echo $row['donation_id']; ?>">
		<div class="itemdiv <?php echo $row['category']; ?>" id="item<?php echo $row['donation_id']; ?>">
			<table class="table-item">
				<tr>
					<td  style="font-size:13px;font-weight:bold;" id="item<?php echo $row['donation_id'];?>">
						<span class="link">
							<a><?php echo $row['donationitem']; ?>
							<span id="note<?php echo $row['donation_id'];?>">
								<p style="margin:5px;padding:5px;"><?php echo $row['note'];?></p>
							</span>
							</a>
						</span> 
					</td>
					<td><?php echo $row['request_quantity']." (".$row['unit_quantity']." ".$row['units_type'].")"; ?></td>
					<td><a href="<?php echo $row['partner_email']; ?>" target="_blank"><?php echo $row['name']; ?></a></td>
					<td><?php echo $row['request_address'].", ".$row['request_city'];?></td>
					<td><?php if($row['transport']==1) echo "<img src='images/npo.png' alt='Pick-Up' />"; else echo "<img src='images/donor.png' alt='Deliver' />" ?></td>
					<td><form name="donationconnect" method="POST" action="inkind_commitments.php"><input type="text" value="<?php echo $row['donation_id'];?>" name="id" hidden /><input type="submit" name="deliver" value="Delivered" /></form></td>
				</tr>
			</table>
		</div>
	</div>
<?php
	}}
else {
		echo "<p>There are no connected users.</p>";
	}
?>
</div>
<div class='itemcontainer' id="delivered">
<?php 
$delivered_query="SELECT * FROM kind_donations 
				JOIN items on kind_donations.item_id=items.item_id
				JOIN item_category on items.category_id=item_category.category_id 
				JOIN project_partners on kind_donations.partner_id=project_partners.partner_id
				WHERE kind_donations.status='Delivered'";
$delivered_ex=mysql_query($delivered_query);
if(mysql_num_rows($delivered_ex)>0){
?>
<?php 
echo "<h3>Completed transactions</h3>";
echo "<table class='table-item' style='width:750px;border-radius:1em;border:1px solid transparent'>
		<tr style=''>
			<th style='background:#fff;width:30px;font-size:12px;padding:0px;margin:0px'>Category</th>
			<th>Item name</th>
			<th>Quantity</th>
			<th>Requested By</th>
			<th>Address</th>
			<th>Transport</th>
			<th></th>
		</tr>
	</table>";
$i=0;
while($row=mysql_fetch_array($delivered_ex)){	?>
	<div class="postedComment" id="<?php echo $row['donation_id']; ?>">
		<div class="itemdiv <?php echo $row['category']; ?>" id="item<?php echo $row['donation_id']; ?>">
			<table class="table-item">
				<tr>
					<td  style="font-size:13px;font-weight:bold;" id="item<?php echo $row['donation_id'];?>">
						<span class="link">
							<a><?php echo $row['donationitem']; ?>
							<span id="note<?php echo $row['donation_id'];?>">
								<p style="margin:5px;padding:5px;"><?php echo $row['note'];?></p>
							</span>
							</a>
						</span> 
					</td>
					<td><?php echo $row['request_quantity']." (".$row['unit_quantity']." ".$row['units_type'].")"; ?></td>
					<td><a href="<?php echo $row['partner_email']; ?>" target="_blank"><?php echo $row['name']; ?></a></td>
					<td><?php echo $row['request_address'].", ".$row['request_city'];?></td>
					<td><?php if($row['transport']==1) echo "<img src='images/npo.png' alt='Pick-Up' />"; else echo "<img src='images/donor.png' alt='Deliver' />" ?></td>
					<td><input type="submit" value="Archive" /></td>
				</tr>
			</table>
		</div>
	</div>
<?php
	}}
else {
		echo "<p>There are no Delivered material.</p>";
	}
?>
</div>
