#region 1 - Prep your environment

#Sign in to your account for the Resource Manager model.
Login-AzureRmAccount

#Set your Azure subscription for the current session

Get-AzureRmSubscription|Select-AzureRmSubscription


#Get the available subscriptions by using the following command
Get-AzureRMSubscription | Sort SubscriptionName | Select SubscriptionName

#Set your Azure subscription for the current session. Replace everything within the quotes, including the < and > characters, with the correct names.
$subscr="<subscription name>"
Get-AzureRmSubscription –SubscriptionName $subscr | Select-AzureRmSubscription

#Register with the migration resource provider.
Register-AzureRmResourceProvider -ProviderNamespace Microsoft.ClassicInfrastructureMigrate

#check the registration
Get-AzureRmResourceProvider -ProviderNamespace Microsoft.ClassicInfrastructureMigrate

#sign in the classic model
Add-AzureAccount

#Get the available subscriptions
Get-AzureSubscription | Sort SubscriptionName | Select SubscriptionName
$subscr="<subscription name>"
Get-AzureSubscription –SubscriptionName $subscr | Select-AzureSubscription

Get-AzureRmSubscription|Select-AzureRmSubscription
#endregion

#region 2 - Prepare my Classic environment

#Prepare the virtual network for migration
$vnetName = "canitprosp2016"
Move-AzureVirtualNetwork -Prepare -VirtualNetworkName $vnetName


#endregion

#region 3 - Commit or Abort
#abort and roll back the preparation
Move-AzureVirtualNetwork -Abort -VirtualNetworkName $vnetName


#Commit the migration
Move-AzureVirtualNetwork -Commit -VirtualNetworkName $vnetName

#endregion
