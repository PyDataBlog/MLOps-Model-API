Function Get-DataHubDSServer
{
[CmdletBinding()]
Param (
[Parameter(Mandatory=$False,ValueFromPipeline=$True)]
[string[]]$ComputerNames
)
Begin { 
}
Process {
  If ($ComputerNames -ne $null) {
    Foreach ($CN in $ComputerNames) {
      $Server = Get-ADComputer -Server ds.nrk.no -Filter "Dnshostname -eq '$CN.ds.nrk.no'" -properties * | Select-object -Property Enabled,createTimeStamp,DistinguishedName,Name,DNSHostName,Description,OperatingSystem,OperatingSystemServicepack,OperatingSystemVersion,@{n="lastLogonDate";e={[datetime]::FromFileTime($_.lastLogonTimestamp)}},@{n="Cluster";e={$_.Description -match 'Cluster'}}      
      If ($Server -ne $null) {
        If (($Server.LastLogonDate).Year -lt 1980) { $Server.LastLogonDate = ([System.Convert]::ToDateTime("1.1.2000")) }        
        If ([String]::IsNullOrEmpty($Server.Description) -eq $False) {$Server.Description = $Server.Description.Replace("'","").Replace('"',"").Trim()}
        If ($Server.Name -match "^[\w\$\-\!\#\@\#\%]{1,15}$" -and [String]::IsNullOrEmpty($Server.createTimeStamp) -eq $False) { 
            $PropertyHash = @{Name=$Server.Name.Tolower();
                              AccountCreated=$Server.createTimeStamp;
                              AccountCreatedDate=[System.Convert]::ToDateTime($Server.createTimeStamp);
                              DNSHostName=$Server.DNSHostName;
                              Description=$Server.Description;
                              Cluster=[System.Convert]::ToBoolean($Server.Cluster);
                              OperatingSystem=$Server.OperatingSystem;
                              OperatingSystemServicePack=$Server.OperatingSystemServicePack;
                              OperatingSystemVersion=$Server.OperatingSystemVersion;
                              LastLogonDate=$Server.LastLogonDate;
                              DistinguishedName=$Server.DistinguishedName;
                              Enabled=$Server.Enabled }
            Write-Output (New-Object -TypeName PSObject -Property $PropertyHash)
        }
      }
    }
  } Else {
    $Servers = @(Get-ADComputer -Server ds.nrk.no -filter "OperatingSystem -like '*Server*' -or Description -like '*Cluster*'" -properties * | Select-object -Property Enabled,createTimeStamp,DistinguishedName,Name,DNSHostName,Description,OperatingSystem,OperatingSystemServicepack,OperatingSystemVersion,@{n="lastLogonDate";e={[datetime]::FromFileTime($_.lastLogonTimestamp)}},@{n="Cluster";e={$_.Description -match 'Cluster'}})
    Foreach ($Server in $Servers) { 
      If (($Server.LastLogonDate).Year -lt 1980) { $Server.LastLogonDate = ([System.Convert]::ToDateTime("1.1.2000")) }        
      If ([String]::IsNullOrEmpty($Server.Description) -eq $False) {$Server.Description = $Server.Description.Replace("'","").Replace('"',"").Trim()}
      If ($Server.Name -match "^[\w\$\-\!\#\@\#\%]{1,15}$" -and [String]::IsNullOrEmpty($Server.createTimeStamp) -eq $False) { 
        $PropertyHash = @{Name=$Server.Name.ToLower();
                          AccountCreated=$Server.createTimeStamp;
                          AccountCreatedDate=[System.Convert]::ToDateTime($Server.createTimeStamp);
                          DNSHostName=$Server.DNSHostName;
                          Description=$Server.Description;
                          Cluster=[System.Convert]::ToBoolean($Server.Cluster);
                          OperatingSystem=$Server.OperatingSystem;
                          OperatingSystemServicePack=$Server.OperatingSystemServicePack;
                          OperatingSystemVersion=$Server.OperatingSystemVersion;
                          LastLogonDate=$Server.LastLogonDate;
                          DistinguishedName=$Server.DistinguishedName;
                          Enabled=$Server.Enabled }
        Write-Output (New-Object -TypeName PSObject -Property $PropertyHash)
      }
    }
  }
}
End { 
}
}
