Write-Host $env:computername -ForegroundColor green

configuration IACDSCLab
{
    param(
        [string[]]$NodeName #remeber it's just a function, nothing else.
    )

    Import-DscResource –ModuleName PSDesiredStateConfiguration
    Import-DscResource -ModuleName xTimeZone
    Import-DscResource -ModuleName xNetworking
    Import-DscResource -ModuleName cNetworking
    Import-DscResource -ModuleName xComputerManagement

    Node $AllNodes.Where{$_.Role -eq "Demo"}.Nodename  {
        
        #Set Freindly name -ne featurename

        WindowsFeature Telnet {
           Ensure = "Present"
           Name   = "Telnet-Client"
        }

        File scripts #Set Freindly name
        {
            Ensure          = "Present"
            DestinationPath = 'c:\scripts'
            Type            = "Directory"
        }

        Service RemoteRegistry {
            Name = 'RemoteRegistry'
            Ensure = 'Present'
            StartupType = 'Automatic'
            State = 'Running'
        }
        
        xTimeZone SystemTimeZone {
            TimeZone = 'Central Standard Time'
            IsSingleInstance = 'Yes'
        }

        xIPAddress NewIPAddress
        {
            IPAddress      = $Node.IPAddress
            InterfaceAlias = "Ethernet"
            SubnetMask     = 24
            AddressFamily  = "IPV4"
 
        }

        xDefaultGatewayAddress NewDefaultGateway
        {
            AddressFamily = 'IPv4'
            InterfaceAlias = 'Ethernet'
            Address = $Node.DefaultGateway
            DependsOn = '[xIPAddress]NewIpAddress'

        }

        cDNSServerAddress DnsServerAddress
        {
            Address        = $Node.DNSIPAddress
            InterfaceAlias = 'Ethernet'
            AddressFamily  = 'IPV4'
        }
        
        xComputer NewName {
            Name = $Node.MachineName
        }

        LocalConfigurationManager            
        {            
            ActionAfterReboot = 'ContinueConfiguration'            
            ConfigurationMode = 'ApplyAndAutoCorrect'            
            RebootNodeIfNeeded = $true            
        }                         
                               
    }
}

$ConfigData = @{             
    AllNodes = @(             
        @{             
            Nodename = 'Localhost'
            Role = 'Demo'          
            MachineName = 'ZDC01'            
            IPAddress = '192.168.2.2'
            DefaultGateway = '192.168.2.1'
            DNSIPAddress = '127.0.0.1'
        }
                      
    )             
}  

Set-Location C:\dsc

IACDSCLab -ConfigurationData $ConfigData

#Meta.mof

break

#Configure LCM
Set-DscLocalConfigurationManager -Path .\IACDSCLab -Verbose -Force
Get-DscLocalConfigurationManager

#use wait and verbose to see output
Start-DscConfiguration  -Path C:\dsc\IACDSCLab -Wait -Verbose -Force