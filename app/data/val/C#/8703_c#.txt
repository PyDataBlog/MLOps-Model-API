using System.Collections.Generic;
using System.Security.Cryptography;
using System.Text;

namespace drawMe.Services.Generators
{
    public static class UserSecretGenerator
    {
        public static string GetSecret(string email, string firstName, string lastName, string[] assignableSecrets)
        {
            var data = $"{lastName}##${email}##{lastName}";
            byte[] hash;

            using (var hasher = MD5.Create())
            {
                hasher.Initialize();
                hasher.ComputeHash(Encoding.UTF8.GetBytes(data));
                hash = hasher.Hash;
            }

            StringBuilder sBuilder = new StringBuilder();
            var nonNumberCount = 0;

            for (int i = 0; i < hash.Length; i++)
            {
                sBuilder.Append(hash[i].ToString("x2"));
            }

            var chain = sBuilder.ToString();

            foreach (var element in chain)
            {
                if (!char.IsNumber(element))
                {
                    nonNumberCount++;
                }
            }

            while (assignableSecrets.Length < nonNumberCount - 1)
            {
                nonNumberCount = nonNumberCount / 2;
            }

            return assignableSecrets[nonNumberCount];
        }
    }
}