require 'resque'
require 'httpclient'
require './app/match'

Resque.redis = Redis.new host: '127.0.0.1', port: 6379

courses = ["ACCT", "AFRS", "AIS", "AMST", "ANTH", "ARAB", "ART", "AH", "ASAM", "AxST", "ASTR", "ATEP", "ATHL", "BIOL", "CBA", "BLAW", "KHMR", "CHzE", "CHEM", "CHLS", "CDFS", "CHIN", "CzE", "CLSC", "COTA", "COMM", "CzD", "CWL", "CECS", "CEM", "CAFF", "COUN", "CRJU", "DANC", "DESN", "DPT", "ECON", "EDLD", "EDCI", "EDEC", "EDEL", "EDME", "EDRG", "EDSE", "EDSS", "EDSP", "EDAD", "ELIB", "EDzP", "ETEC", "EzE", "ENGR", "EzT", "ENGL", "ESzP", "FCS", "FCSE", "FMD", "FEA", "FIN", "FSCI", "FREN", "GEOG", "GEOL", "GERM", "GERN", "GBA", "GK", "HHS", "HCA", "HzSC", "HEBW", "HIST", "HFHM", "HDEV", "HRM", "IzS", "INTL", "IxST", "ITAL", "JAPN", "JOUR", "KIN", "KOR", "LAT", "LAS", "CxLA", "LxST", "LING", "MGMT", "MKTG", "MATH", "MTED", "MAPB", "MAE", "MICR", "MzS", "MUS", "NSCI", "NRSG", "NUTR", "PHIL", "PHSC", "PzT", "PHYS", "POSC", "PSY", "PPA", "REC", "RxST", "RGR", "RUSS", "SCED", "SCAE", "SzW", "SOC", "SPAN", "STAT", "SDHE", "SRL", "SxI", "SCM", "THEA", "UNIV", "UHP", "VIET", "WGSS"]

client = HTTPClient.new
courses.each do |c|
  print "=> #{c}"
  r = client.get_content "http://csulb.edu/depts/enrollment/cgi-bin/soc_feed.pl?term=spring&year=2014&subject=#{c}&format=xml"
  Resque.enqueue Match, r
  puts " ... Done"
end
