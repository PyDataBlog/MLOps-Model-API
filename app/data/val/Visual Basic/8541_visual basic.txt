Imports System.Windows.Forms
Imports Visomes.MySQL
Imports Visomes.SGV.Core
Imports System.Diagnostics
Imports MySql.Data.MySqlClient
Imports System.IO
Imports Visomes.Validation

Public Class ViewExecutanteDataOs
    Private nomeCompletoFuncionario As String
    Private valid As New Validating()

    Public ReadOnly Property Matricula() As String
        Get
            Return Me.txtCodExecutante.Text
        End Get
    End Property

    Public ReadOnly Property NomeCompleto() As String
        Get
            Return nomeCompletoFuncionario
        End Get
    End Property

    Public ReadOnly Property DataExecusao() As Date
        Get
            Return CDate(mtbDtExec.Text)
        End Get
    End Property

    Private Sub OK_Button_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles OK_Button.Click
        If (Not ValidatesOutPut) Or _
            (String.IsNullOrEmpty(Me.txtCodExecutante.Text) Or _
            Not Me.mtbDtExec.MaskFull) Then
            MessageBox.Show("Campos inválidos", Core.STR_NOME_SISTEMA)
        Else
            Me.DialogResult = System.Windows.Forms.DialogResult.OK
            Me.Close()
        End If
    End Sub

    Private Sub Cancel_Button_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles Cancel_Button.Click
        Me.DialogResult = System.Windows.Forms.DialogResult.Cancel
        Me.Close()
    End Sub

    ''' <summary>
    ''' BUSCA EXECUTANTE
    ''' </summary>
    ''' <remarks></remarks>
    Private Sub btnBuscaExc_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnBuscaExc.Click
        Dim frm As New ListFuncionario(" f.status=1 AND u.idUsuario IN " _
                                     & "(SELECT idUsuario FROM usuario_sub_area WHERE idSubArea IN " _
                                     & "( SELECT idSubArea FROM" _
                                     & " usuario_sub_area WHERE idUsuario = " & Core.Usuario.ID & "))")
        If frm.ShowDialog = Windows.Forms.DialogResult.OK Then
            Me.txtCodExecutante.Text = frm.GetRow.Cells(0).Value.ToString()
            Me.nomeCompletoFuncionario = frm.GetRow.Cells(1).Value.ToString()
        End If
        frm.Dispose()
        Me.DialogResult = Windows.Forms.DialogResult.None
    End Sub

    ''' <summary>
    ''' DATA DE EXECUSÃO
    ''' </summary>
    ''' <remarks></remarks>
    Private Sub mtbDtExec_Validating(ByVal sender As System.Object, ByVal e As System.ComponentModel.CancelEventArgs) Handles mtbDtExec.Validating
        If mtbDtExec.MaskFull And valid.Data(mtbDtExec.Text) Then
            epvOs.SetError(mtbDtExec, "")
            ErrorSavamento.Replace("Data em formato incorreto" & vbCrLf, "")
            ValidatesOutPut = True
        ElseIf Not mtbDtExec.MaskFull And Not _
        mtbDtExec.Text.Replace(" ", "").Replace("/", "").Length = 0 Then
            epvOs.SetError(mtbDtExec, "Data em formato incorreto")
            ValidatesOutPut = False
        Else
            epvOs.SetError(mtbDtExec, "")
            ErrorSavamento.Replace("Data em formato incorreto" & vbCrLf, "")
            ValidatesOutPut = True
        End If
    End Sub
End Class
