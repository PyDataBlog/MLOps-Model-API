Public Class PullDBSizeData
    Inherits System.Web.UI.Page

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
        If IsPostBack Then
        Else

            g_IO_Execute_SQL("truncate table DATABASE_FILE_SIZES", False)

            Dim strsql As String = "Select SERVER_ID, FQDN, SERVER_NAME FROM SERVERS ORDER BY SERVER_NAME"
            Dim tblServers As DataTable = g_IO_Execute_SQL(strsql, False)
            Dim queryExecutedCount As Integer = 1
            For Each rowServer In tblServers.Rows
                'run a check to see if rows already exist for that server
                strsql = "Select * from database_file_sizes where server_name = '" & rowServer("SERVER_NAME") & "'"
                Dim tblCheck As DataTable = g_IO_Execute_SQL(strsql, False)
                If tblCheck.Rows.Count < 1 Then
                    Dim strInsert As String = "INSERT INTO [DATABASE_FILE_SIZES] ([server_name] ,[product_version],[product_edition],[fileid],[groupid],[size_mb]" & _
                                         ",[size_gb],[maxsize],[growth],[status],[perf],[name],[filename],[collection_dttm])" & _
                                         "Select * from " & rowServer("FQDN") & ".DBA.DBO.udt_Database_FileSizes"
                    g_IO_Execute_SQL(strInsert, False)
                    'Increment
                    litMessage.Text &= queryExecutedCount & " - " & rowServer("server_name") & "<br>"
                    queryExecutedCount += 1
                End If
            Next

        End If
    End Sub

End Class