Public Class EditSurveyForm
    Public EditSurveyController As EditSurveyController
    Public SurveyIdx As Integer = 0
    Public Survey As SurveyObject
    Public EditScanForm As EditScanForm
    Public EditPositionerForm As EditPositionerForm
    Public EditSwitchDriverForm As EditSwitchDriverForm
    Public EditSwitchForm As EditSwitchForm
    Public SurveyObjectController As SurveyObjectController

    Public Sub New(ByRef aEditSurveyController As EditSurveyController, ByRef survey As SurveyObject)
        Me.EditSurveyController = aEditSurveyController
        'Me.survey = Me.EditSurveyController.EditDeleteMissionForm.MissionObjectController.aMain.missionObj.getSurveyObject(index)
        Me.survey = survey

        InitializeComponent()

        'populate the name in a combo box 
        Me.cmbBxSurvey.Text = Me.survey.getName

        'populate the scans in the combo box
        Me.cmbBxScanNames.Items.Clear()
        Try

        For ii As Integer = 0 To Me.survey.getNumberOfScansDefined - 1
            Me.cmbBxScanNames.Items.Add(Me.survey.getScanObject(ii).getName)
            Next
        Catch ex As Exception

        End Try

        'populate the switch drivers in the combo box
        For ii As Integer = 0 To Me.survey.getdefinedSwitchDrivers - 1
            Me.cmbBxSwitchDvr.Items.Add(Me.survey.getSwitchDriver(ii).getname)
        Next

        'Me.numUpDwnSwitches.Maximum = Me.survey.getNumOfSwitches
        Me.cmbBxSwitches.MaxDropDownItems = Me.survey.getNumOfSwitches + 1
        For ii As Integer = 0 To Me.survey.getNumOfSwitches - 1
            Me.cmbBxSwitches.Items.Add(ii + 1)
        Next
     
        'populate the switch drivers in the combo box
        Me.cmbBxPositioners.MaxDropDownItems = Me.survey.getNumPositioners + 1
        For ii As Integer = 0 To Me.survey.getNumPositioners - 1
            Me.cmbBxPositioners.Items.Add(ii + 1)
        Next

        'populate the analyzer combo box drop down
        With Me.EditSurveyController.EditDeleteMissionForm.EditTransporterController.EditDeleteMissionForm.EditTransporterController.EditDeleteMissionForm.MissionObjectController.aMain.missionObj
            For ii As Integer = 0 To .getNumberAnalyzersDefined
                If .getAnalyzer(ii) Is Nothing Then
                    Exit For
                Else
                    Me.cmbBxAzr.Items.Add("Analyzer " & ii)
                End If
            Next
        End With

        If Me.survey.getAnalyzerAssignmentIdx < 0 Then
            Me.survey.getAnalyzerAssignmentIdx = 0
        End If

        Me.lblAzrName.Text = "Anaylzer " & Me.survey.getAnalyzerAssignmentIdx

        For Each positioner In Me.survey.getPositioner
            If positioner Is Nothing Then Exit For
            'display last azimuth collected
            Me.numUpDownLastAzimuth.Value = positioner.getLastAzimuth

            'display the total revolutions 
            Me.numUpDwnTotalScans.Value = positioner.getTotalRevolutions
        Next

        Me.Text = "Edit Survey "
        Me.StartPosition = FormStartPosition.Manual
        Me.Left = 30
        Me.Top = 30
        Me.Visible = True

    End Sub

    Private Sub cmbBxScanNames_SelectedIndexChanged(sender As System.Object, e As System.EventArgs) Handles cmbBxScanNames.SelectedIndexChanged
        'loop through the scan names to find which scan is desired to be edited
        For ii As Integer = 0 To Me.survey.getNumberOfScansDefined - 1
            If Me.cmbBxScanNames.SelectedItem = (Me.survey.getScanObject(ii).getName) Then
                Me.EditScanForm = New EditScanForm(Me.EditSurveyController, Me.survey, ii, Me)
                Exit For
            End If
        Next

    End Sub

    Private Sub btnCancel_Click(sender As System.Object, e As System.EventArgs) Handles btnCancel.Click
        Try
            If Me.cmbBxSurvey.Text <> Me.survey.getName Then
                'remove old name from cmb boxes
                Me.EditSurveyController.EditDeleteMissionForm.EditTransporterController.EditTransporterForm.cmbBxScanNames.Items.Remove(Me.survey.getName)
                'save new name
                Me.survey.getName = Trim(Me.cmbBxSurvey.Text)
                Me.EditSurveyController.EditDeleteMissionForm.EditTransporterController.EditTransporterForm.cmbBxScanNames.Items.Add(Me.survey.getName)

            End If
        Catch ex As Exception
            MsgBox("unable to save new survey name: " & ex.Message)
        End Try

        For Each positioner In Me.survey.getPositioner
            If positioner Is Nothing Then Exit For
            'display last azimuth collected
            positioner.getLastAzimuth = Me.numUpDownLastAzimuth.Value

            'display the total revolutions 
            positioner.getTotalRevolutions = Me.numUpDwnTotalScans.Value
        Next

        If Me.cmbBxAzr.SelectedIndex >= 0 Then
            Me.survey.getAnalyzerAssignmentIdx = Me.cmbBxAzr.SelectedIndex
        End If

        Try
            Me.EditSurveyController.EditDeleteMissionForm.MissionObjectController.aMain.MissionController.serializeMissionObject()
        Catch ex As Exception
            MsgBox("Unable to save survey" & ex.Message)
        End Try

        Me.Close()
    End Sub

    Private Sub cmbBxSwitchDvr_SelectedIndexChanged(sender As System.Object, e As System.EventArgs) Handles cmbBxSwitchDvr.SelectedIndexChanged
        For ii As Integer = 0 To Me.survey.getdefinedSwitchDrivers - 1
            If Me.cmbBxSwitchDvr.SelectedItem = Me.survey.getSwitchDriver(ii).getname Then
                Me.EditSwitchDriverForm = New EditSwitchDriverForm(Me.survey.getSwitchDriver(ii), ii)
            End If
        Next

    End Sub

    Private Sub Button1_Click(sender As System.Object, e As System.EventArgs) Handles Button1.Click
        Me.SurveyObjectController = New SurveyObjectController(Me.survey)
        Me.EditSurveyController.EditDeleteMissionForm.MissionObjectController.aMain.NewSurveyObj = Me.survey
        Me.SurveyObjectController.aMain = Me.EditSurveyController.EditDeleteMissionForm.MissionObjectController.aMain
        Me.SurveyObjectController.newScanForm = New NewScanForm(Me.SurveyObjectController, Me.cmbBxScanNames.Items.Count + 1, Me.cmbBxScanNames.Items.Count + 1, Me)

    End Sub

    Public Sub UpdateSurvey()
        Try
            Me.survey.getNumberOfScansDefined += 1
            Me.cmbBxScanNames.Items.Add(Me.survey.getScanObject(Me.cmbBxScanNames.Items.Count).getName)
            Me.cmbBxScanNames.Refresh()
        Catch ex As Exception
            MsgBox("unable to add scan: " & Me.cmbBxScanNames.Items.Count + 1)
        End Try
    End Sub

    Private Sub btnAddSwitchDrvr_Click(sender As System.Object, e As System.EventArgs) Handles btnAddSwitchDrvr.Click
        Me.survey.getdefinedSwitchDrivers += 1
        Me.survey.getSwitchDriver(Me.survey.getdefinedSwitchDrivers - 1) = New SwitchDriverObject
        Me.EditSwitchDriverForm = New EditSwitchDriverForm(Me.survey.getSwitchDriver(Me.survey.getdefinedSwitchDrivers - 1), Me.survey.getdefinedSwitchDrivers - 1, True)

    End Sub

    Private Sub Button2_Click(sender As System.Object, e As System.EventArgs) Handles Button2.Click
        Try
            If MsgBox("Are you sure you want to delete this survey?", MsgBoxStyle.OkCancel) = MsgBoxResult.Ok Then

                Dim tmp = Me.cmbBxSurvey.Text
                With Me.EditSurveyController.EditDeleteMissionForm.MissionObjectController.aMain

                    For ii As Integer = 0 To .missionObj.getNumberTransportsDefined - 1
                        'find the right Transporter mission
                        If Me.EditSurveyController.EditDeleteMissionForm.selectedMission = .missionObj.getTransporterObject(ii).getName Then
                            'now find the right survey mission
                            For jj As Integer = 0 To .missionObj.getTransporterObject(ii).getNumSurveysDefined
                                If tmp = .missionObj.getTransporterObject(ii).getSurveyObject(jj).getName Then
                                    .missionObj.getTransporterObject(ii).getSurveyObject = .removeArrayMember(.missionObj.getTransporterObject(ii).getSurveyObject, .missionObj.getTransporterObject(ii).getSurveyObject(jj), GetType(SurveyObject))
                                    .missionObj.getTransporterObject(ii).getSurveyObject(jj) = Nothing
                                    .missionObj.getTransporterObject(ii).getNumSurveysDefined -= 1
                                    'update the survey scan box on the edit transport form
                                    Me.EditSurveyController.EditDeleteMissionForm.EditTransporterController.EditTransporterForm.cmbBxScanNames.Items.Clear()
                                    For kk As Integer = 0 To .missionObj.getTransporterObject(ii).getNumSurveysDefined - 1
                                        Me.EditSurveyController.EditDeleteMissionForm.EditTransporterController.EditTransporterForm.cmbBxScanNames.Items.Add(.missionObj.getTransporterObject(ii).getSurveyObject(kk).getName)
                                    Next
                                    Me.EditSurveyController.EditDeleteMissionForm.EditTransporterController.EditTransporterForm.cmbBxScanNames.Text = ""
                                    Exit For
                                End If
                            Next
                        End If
                    Next


                End With
                Me.Close()
            End If

        Catch ex As Exception
            MsgBox("Unble to remove survey from the mission object: " & ex.Message)
        End Try
    End Sub

    Private Sub cmbBxAzr_SelectedIndexChanged(sender As System.Object, e As System.EventArgs) Handles cmbBxAzr.SelectedIndexChanged
        Me.lblAzrName.Text = "Analyzer " & Me.cmbBxAzr.SelectedIndex
    End Sub

    Private Sub Button3_Click(sender As System.Object, e As System.EventArgs) Handles btnAddPositioner.Click
        Try
            Dim tmp As Integer = Me.cmbBxPositioners.MaxDropDownItems
            Me.survey.getPositioner(Me.cmbBxPositioners.MaxDropDownItems - 1) = New PositionerObject
            Me.EditPositionerForm = New EditPositionerForm(Me.survey.getPositioner(Me.cmbBxPositioners.MaxDropDownItems - 1), (Me.cmbBxPositioners.MaxDropDownItems - 1), Me.survey, False, Me)
        Catch ex As Exception
            MsgBox("error tring to add a positioner: " & ex.Message)
        End Try
    End Sub

    Private Sub cmbBxPositioners_SelectedIndexChanged(sender As System.Object, e As System.EventArgs) Handles cmbBxPositioners.SelectedIndexChanged
        Try
            Dim tmp As Integer = Me.cmbBxPositioners.SelectedIndex
            Me.EditPositionerForm = New EditPositionerForm(Me.survey.getPositioner(Me.cmbBxPositioners.SelectedIndex), Me.cmbBxPositioners.SelectedIndex, Me.survey, True, Me)
        Catch ex As Exception
            MsgBox("error getting positioners: " & ex.Message)
        End Try
    End Sub

    Private Sub cmbBxSwitches_SelectedIndexChanged(sender As System.Object, e As System.EventArgs) Handles cmbBxSwitches.SelectedIndexChanged
        Try
            Me.EditSwitchForm = New EditSwitchForm(Me.survey, Me.survey.getSwitches(Me.cmbBxSwitches.SelectedIndex), Me.cmbBxSwitches.SelectedIndex, Me)
        Catch ex As Exception
            MsgBox("error getting switch  " & ex.Message)
        End Try
    End Sub

    Private Sub btnAddSwitch_Click(sender As System.Object, e As System.EventArgs) Handles btnAddSwitch.Click
        Try
            If Me.survey.getNumOfSwitches > 6 Then
                MsgBox("error: cannot handle more than 7 switches ")
                Return
            End If

            Me.survey.getNumOfSwitches += 1
            Me.survey.getSwitches(Me.survey.getNumOfSwitches - 1) = New SwitchObject
            Me.EditSwitchForm = New EditSwitchForm(Me.survey, Me.survey.getSwitches(Me.survey.getNumOfSwitches - 1), Me.survey.getNumOfSwitches - 1, Me, True)
        Catch ex As Exception
        End Try

    End Sub

   
End Class