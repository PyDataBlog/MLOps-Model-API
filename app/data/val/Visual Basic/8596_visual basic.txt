' Data snapshot in file data_excerpt_1.png in this repository

Option Explicit

Sub NewSearch()

    Application.ScreenUpdating = False ' reduce unnecessary cost
    Dim Customer, Product
    Dim ws As Worksheet
    Dim Q, A As Double
    Dim CusAnchor, ProdAnchor, SRCAnchor, ItemAnchor, QAnchor, AAnchor As Range
    Dim mo, ro, yr As Integer
    
    ' Create 2 worksheets containing quantities and dollar amounts of sales
    Set ws = Worksheets.Add(after:=Worksheets(Sheets.Count))
    ws.Name = "Qty"
    Set ws = Worksheets.Add(after:=Worksheets(Sheets.Count))
    ws.Name = "Amt"
    
    ' Set pointers on the 3 worksheets
    Set ItemAnchor = Worksheets("SRC").Range("A5")
    Set QAnchor = Worksheets("Qty").Range("A1")
    Set AAnchor = Worksheets("Amt").Range("A1")
    
    ' Initialize the pointers
    QAnchor.Value = "Company"
    QAnchor.Offset(0, 1).Value = "Product"
    AAnchor.Value = "Company"
    AAnchor.Offset(0, 1).Value = "Product"
    
    ro = 0
    yr = 0
    
    ' Create column names on new sheets according to column number, starting from Jan 2016 (01/2016) 
    For j = 1 To Month(Date) + 12 * (Year(Date) - 2016) - 1 ' as of last month
        If j Mod 12 <> 0 Then
            QAnchor.Offset(0, j + 1) = "'" & MonthName(j Mod 12, True) & " " & Int(j / 12 + 16)
            AAnchor.Offset(0, j + 1) = "'" & MonthName(j Mod 12, True) & " " & Int(j / 12 + 16)
        Else
            QAnchor.Offset(0, j + 1) = "'" & "Dec" & " " & Int(j / 12 + 16)
            AAnchor.Offset(0, j + 1) = "'" & "Dec" & " " & Int(j / 12 + 16)
        End If
    Next j
    
    ' Fill new sheets with data
    For i = 1 To 20000 ' the upper limit should be adjusted according to real-world-setting; in my case 20,000 works
    
        mo = Month(ItemAnchor.Offset(i, 3))
        yr = Year(ItemAnchor.Offset(i, 3))

        If ItemAnchor.Offset(i, 6).Value <> "" Or ItemAnchor.Offset(i, 5).Value <> "" Then
        ' There are blank rows between companies, which should be skipped
            
            If ItemAnchor.Offset(i, 6).Value <> ItemAnchor.Offset(i - 1, 6).Value Or ItemAnchor.Offset(i, 5).Value <> ItemAnchor.Offset(i - 1, 5).Value Then
            ' Check if the current item is different than the previous
                
                ro = ro + 1 
                ' If a different item, the pointer moves
                
                QAnchor.Offset(ro, 0).Value = ItemAnchor.Offset(i, 6).Value
                QAnchor.Offset(ro, 1).Value = ItemAnchor.Offset(i, 5).Value
                AAnchor.Offset(ro, 0).Value = ItemAnchor.Offset(i, 6).Value
                AAnchor.Offset(ro, 1).Value = ItemAnchor.Offset(i, 5).Value
                
                For j = 1 To Month(Date) + 12 * (Year(Date) - 2016) - 1 ' as of last month
                    If j Mod 12 <> 0 Then
                        QAnchor.Offset(ro, j + 1) = 0
                        AAnchor.Offset(ro, j + 1) = 0
                    Else
                        QAnchor.Offset(ro, j + 1) = 0
                        AAnchor.Offset(ro, j + 1) = 0
                    End If
                Next j
                
            ElseIf Customer = ItemAnchor.Offset(i - 1, 6).Value And Product = ItemAnchor.Offset(i - 1, 5).Value Then
                ro = ro
                ' The pointer keeps there until a different
            End If

            Q = QAnchor.Offset(ro, (yr Mod 2016) * 12 + mo + 1).Value
            A = AAnchor.Offset(ro, (yr Mod 2016) * 12 + mo + 1).Value
            
            QAnchor.Offset(ro, (yr Mod 2016) * 12 + mo + 1).Value = QAnchor.Offset(ro, (yr Mod 2016) * 12 + mo + 1).Value + ItemAnchor.Offset(i, 7).Value
            AAnchor.Offset(ro, (yr Mod 2016) * 12 + mo + 1).Value = AAnchor.Offset(ro, (yr Mod 2016) * 12 + mo + 1).Value + ItemAnchor.Offset(i, 8).Value
        Else
            ' -_-#
        End If
    Next i

    ' Decorative steps below
    
    QAnchor.CurrentRegion.EntireColumn.AutoFit
    AAnchor.CurrentRegion.EntireColumn.AutoFit
    
    QAnchor.CurrentRegion.Font.Name = "Times New Roman"
    AAnchor.CurrentRegion.Font.Name = "Times New Roman"
    
    Range(QAnchor, QAnchor.End(xlToRight)).Interior.ColorIndex = 37
    Range(AAnchor, AAnchor.End(xlToRight)).Interior.ColorIndex = 37
    
    Range(QAnchor, QAnchor.End(xlToRight)).HorizontalAlignment = xlCenter
    Range(AAnchor, AAnchor.End(xlToRight)).HorizontalAlignment = xlCenter
    
    Range(QAnchor.Offset(1, 2), QAnchor.End(xlDown).End(xlToRight)).NumberFormat = "#,##0"
    Range(AAnchor.Offset(1, 2), AAnchor.End(xlDown).End(xlToRight)).NumberFormat = "$#,##0.00"
    
    ' Return to the source sheet
    Worksheets("SRC").Select
    
End Sub

