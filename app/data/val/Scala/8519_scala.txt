package mr.merc.view.move

class MovementList(val list: List[Movement]) extends Movement {
  private val moves = list.toVector
  private var current = 0

  private def incrementCurrent(): Unit = {
    current += 1
  }

  def currentMovement: Movement = moves(current)

  override def start(): Unit = {
    super.start()
    if (!isOver) {
      callStartWhileNotIsOver()
    }
  }

  private def callStartWhileNotIsOver(): Unit = {
    if (!currentMovement.isStarted) {
      currentMovement.start()
    }

    while (!isOver && currentMovement.isOver) {
      incrementCurrent()
      if (!isOver) {
        currentMovement.start()
      }
    }
  }

  override def isOver: Boolean = current == list.size

  override def drawables = currentMovement.drawables

  override def update(time: Int): Unit = {
    super.update(time)

    callStartWhileNotIsOver()
    currentMovement.update(time)

    if (currentMovement.isOver) {
      incrementCurrent()
      if (!isOver) {
        callStartWhileNotIsOver()
      }
    }
  }
}