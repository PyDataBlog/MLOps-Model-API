class AddPublicationDateRangeToSource < ActiveRecord::Migration
  def self.up
    rename_column :sources, :published_on_day,   :published_from_day
    rename_column :sources, :published_on_month, :published_from_month
    rename_column :sources, :published_on_year,  :published_from_year

    change_table :sources do |t|
      t.integer :published_to_day, :published_to_month, :published_to_year
      t.date :published_from, :published_to
    end

    Source.find_each do |source|
      source.update_attributes!(
        :published_to_year  => source.published_from_year,
        :published_to_month => source.published_from_month,
        :published_to_day   => source.published_from_day)
    end

    add_index :sources, :published_from
    add_index :sources, :published_to
  end

  def self.down
    remove_column :sources, :published_from, :published_to
    remove_column :sources, :published_to_day, :published_to_month, :published_to_year

    rename_column :sources, :published_from_day,   :published_on_day
    rename_column :sources, :published_from_month, :published_on_month
    rename_column :sources, :published_from_year,  :published_on_year
  end
end
