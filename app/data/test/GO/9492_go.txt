package dodo

// NewPropertyIndex PropertyIndex constructor.
func NewPropertyIndex() *propertyIndex {

	return &propertyIndex{
		propertyIndexMap: map[string]map[string]int{},
	}
}

type propertyIndex struct {
	propertyIndexMap map[string]map[string]int
}

func (p *propertyIndex) index(container, property string) *int {

	indexMap, exists := p.propertyIndexMap[container]
	if !exists {
		return nil
	}

	index, exists := indexMap[property]
	if !exists {
		return nil
	}

	return &index
}

func (p *propertyIndex) incrementIndex(container, property string) *int {

	indexMap, exists := p.propertyIndexMap[container]
	if !exists {
		indexMap = map[string]int{}
		p.propertyIndexMap[container] = indexMap
	}

	index, exists := indexMap[property]
	if !exists {
		index = 0
		indexMap[property] = index
	} else {
		index++
		indexMap[property] = index
	}

	return &index
}
