#!/bin/bash

desktopFilesFolder=/usr/share/applications
desktopFilesArray=()
desktopFilesNameArray=()
numberOfDesktopFile=0
echo "Which application icon you want to hide or show?"
for desktopFile in $desktopFilesFolder/*.desktop; do
  icon=$(sed --quiet 's/.*\(Icon=\).*/\1/p' $desktopFile)
  if [[ $icon == "Icon=" ]]; then
    name=$(sed -n -e '/Name=/p' $desktopFile | cut -f2- -d=)
    desktopFilesNameArray[$numberOfDesktopFile]=$name
    desktopFilesArray[$numberOfDesktopFile]=$desktopFile
    echo "($numberOfDesktopFile) $name"
    ((numberOfDesktopFile++))
  fi
done
choosenDesktopFileNumber=-1
read choosenDesktopFileNumber
re='^[0-9]+$'
if ! [[ $choosenDesktopFileNumber =~ $re ]] ; then
  echo "error: Not a number" >&2; exit 1
fi
echo You choosed ${desktopFilesNameArray[$choosenDesktopFileNumber]}
read -s -n 1 -r -p "Continue [Y/n]?" cont
if [[ $cont =~ ^(y|Y|'')$ ]]; then
  icon=$(sed --quiet 's/.*\(Icon=\).*/\1/p' ${desktopFilesArray[$choosenDesktopFileNumber]})
  if [[ $icon == "Icon=" ]]; then
    outTrue=$(sed --quiet 's/.*\(NoDisplay=true\).*/\1/p' ${desktopFilesArray[$choosenDesktopFileNumber]})
    if [[ $outTrue == "NoDisplay=true" ]]; then
      echo -e "\nThe icon is actually NOT visible."
      read -s -n 1 -r -p "Do you want to make it visible [Y/n]?" response
      if [[ $response =~ ^(y|Y|'')$ ]]; then
        sed -i '/NoDisplay=true/d' ${desktopFilesArray[$choosenDesktopFileNumber]}
        echo -e "\nSucess"
      elif [[ $response =~ ^(n|N)$ ]]; then
        echo -e "\nAborted"
      fi
    else
      echo -e "\nThe icon is actually visible."
      read -s -n 1 -r -p "Should I try to hide it [Y/n]?" response
      if [[ $response =~ ^(y|Y|'')$ ]]; then
        sed -i '/Icon=/a NoDisplay=true' ${desktopFilesArray[$choosenDesktopFileNumber]}
        echo -e "\nSucess"
      elif [[ $response =~ ^(n|N)$ ]]; then
        echo -e "\nAborted"
      fi
    fi
  else
    echo -e "\nNo icon exist to hide/show."
  fi
else
  echo -e "\nAborted"
fi
