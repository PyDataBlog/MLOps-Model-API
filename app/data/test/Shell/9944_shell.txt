#!/bin/bash -e

. ../env/env

brief="a complete rewrite of the NASM assembler"
intro="
 YASM is a complete rewrite of the NASM assembler. It is designed from the
 ground up to allow for multiple syntaxes to be supported (e.g., NASM, TASM,
 GAS, etc.) in addition to multiple output object formats.  Another primary
 module of the overall design is an optimizer module.  Actually it supports
 ix86 and AMD64, next will be PowerPC
"

version=1.3.0
srcfil=yasm-$version.tar.gz
srcdir=yasm-$version

srcurl=http://www.tortall.net/projects/yasm/releases/$srcfil
srcmd5=fc9e586751ff789b34b1f21d572d96af

build_src() {
    tar -xf $srcfil && cd $srcdir

    # This sed prevents it compiling 2 programs (vsyasm and ytasm) that are
    # only of use on Microsoft Windows:
    sed -i 's#) ytasm.*#)#' Makefile.in

    ./configure --prefix=/usr
    make $JOBS
    make DESTDIR=$OUTPUTDIR install

    cleanup_src
}

build
