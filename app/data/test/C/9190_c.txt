#include "main_inc.h"


int mainIwdg(void)
{
    /*系统延时定时器初始化*/
    SysTickDelay_DriverRegister(SysTickDelayF103_Init, SysTickDelayF103_DelayMs,
        SysTickDelayF103_DelayUs);
    SysTickDelay_Init();

    /*系统LED初始化*/
    DeviceLed_DriverRegister(BOARD_LED_RED, DeviceLedF103_RedInit, DeviceLedF103_RedSet,
        DeviceLedF103_RedGet, DeviceLedF103_RedReversal);
    DeviceLed_DriverRegister(BOARD_LED_GREEN, DeviceLedF103_GreenInit, DeviceLedF103_GreenSet,
        DeviceLedF103_GreenGet, DeviceLedF103_GreenReversal);
    DeviceLed_Init(BOARD_LED_RED, BOARD_LED_EXTINGUISH);
    DeviceLed_Init(BOARD_LED_GREEN, BOARD_LED_EXTINGUISH);

    /*串口初始化*/
    /*注册驱动函数*/
    DeviceUsart1_DriverRegister(DeviceUsart1F103_Init, DeviceUsart1F103_SendChar,
        DeviceUsart1F103_SendBuffer, DeviceUsart1F103_SendString, DeviceUsart1F103_ReadRecv,
        DeviceUsart1F103_ClearRecv);
    /*初始化*/
    DeviceUsart1_Init(115200);
    printf("UASRT1 Init\r\n");

    /*独立看门狗初始化*/
    DeviceIWDG_DriverRegister(DeviceIWDGF103_Init, DeviceIWDGF103_Feed);
    DeviceIWDG_Init(IWDG_PRESCALER_64, 625);

    while (1)
    {
        /*流水灯闪烁*/
        DeviceLed_Set(BOARD_LED_RED, BOARD_LED_LIGHTEN);
        SysTickDelay_DelayMs(50);
        DeviceLed_Set(BOARD_LED_RED, BOARD_LED_EXTINGUISH);
        SysTickDelay_DelayMs(50);
        DeviceLed_Set(BOARD_LED_GREEN, BOARD_LED_LIGHTEN);
        SysTickDelay_DelayMs(50);
        DeviceLed_Set(BOARD_LED_GREEN, BOARD_LED_EXTINGUISH);
        SysTickDelay_DelayMs(50);
        /*独立看门狗喂狗,不喂狗1S复位*/
        //DeviceIWDG_Feed();
    }
}