FROM registry1-eu1.moneysupermarket.com:5000/docker-centos6-puppet-ruby215:latest
MAINTAINER Paul Gilligan<Paul.Gilligan@moneysupermarket.com>

# -----------------------------------------------------------------------------
# Base Install
# -----------------------------------------------------------------------------
RUN yum update -y && yum install --setopt=tsflags=nodocs -y java-1.7.0-openjdk-devel unzip ntp wget
RUN cd /opt && wget http://download.jboss.org/jbossas/7.1/jboss-as-7.1.1.Final/jboss-as-7.1.1.Final.zip
RUN cd /opt && wget http://sourceforge.net/projects/ejbca/files/ejbca6/ejbca_6_2_0/ejbca_ce_6_2_0.zip
RUN cd /opt && unzip jboss-as-7.1.1.Final.zip
RUN cd /opt && unzip ejbca_ce_6_2_0.zip
RUN cd /opt && rm jboss-as-7.1.1.Final.zip
RUN cd /opt && rm ejbca_ce_6_2_0.zip

# -----------------------------------------------------------------------------
# Ant Install
# -----------------------------------------------------------------------------
RUN cd /opt && wget http://apache.mirror.anlx.net//ant/binaries/apache-ant-1.9.4-bin.tar.gz
RUN cd /opt && tar xvfz apache-ant-1.9.4-bin.tar.gz 
RUN cd /opt && rm apache-ant-1.9.4-bin.tar.gz

# -----------------------------------------------------------------------------
# Base Configure
# -----------------------------------------------------------------------------
ENV TERM vt220
ENV APPSRV_HOME /opt/jboss-as-7.1.1.Final

RUN useradd -u 600 -m -G users,wheel jboss
RUN chown -R jboss /opt/jboss-as-7.1.1.Final && chmod 755 /opt/jboss-as-7.1.1.Final
RUN chown -R jboss /opt/ejbca_ce_6_2_0       && chmod 755 /opt/ejbca_ce_6_2_0
 
EXPOSE 8080 8442 8443 9990 9999

# -----------------------------------------------------------------------------
# add supervisord
# -----------------------------------------------------------------------------
ADD etc/services-config/supervisor/supervisord.conf /var/tmp/supervisord.conf
RUN cat /var/tmp/supervisord.conf >> /etc/services-config/supervisor/supervisord.conf

# -----------------------------------------------------------------------------
# Finish up
# -----------------------------------------------------------------------------
EXPOSE 22
CMD ["/usr/bin/supervisord", "--configuration=/etc/supervisord.conf"]


