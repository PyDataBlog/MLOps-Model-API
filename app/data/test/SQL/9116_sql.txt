-- 1、 列出至少有一个员工的所有部门编号、名称，并统计出这些部门的平均工资、最低工资、最高工资。
SELECT d.deptno, d.dname, AVG(sal), MIN(sal), MAX(sal)
  FROM emp e, dept d
 WHERE e.deptno(+) = d.deptno
 GROUP BY d.deptno, d.dname;
 
-- 2、 列出薪金比“SMITH”或“ALLEN”多的所有员工的编号、姓名、部门名称、其领导姓名。
SELECT e.empno 员工编号, e.ename 姓名,e.sal, d.dname 部门名称, em.ename 领导姓名
FROM emp e, dept d, emp em
WHERE e.deptno = d.deptno
AND e.mgr = em.empno
AND e.ename <> 'SMITH'
AND e.ename <> 'ALLEN'
AND e.sal > ANY (SELECT sal FROM emp WHERE ename = 'SMITH' OR ename = 'ALLEN');

-- 3、 列出所有员工的编号、姓名及其直接上级的编号、姓名，显示的结果按领导年工资的降序排列。
SELECT e.empno  员工编号,
       e.ename  员工姓名,
       em.empno 上级编号,
       em.ename 上级姓名
  FROM emp e, emp em
 WHERE e.mgr = em.empno
 ORDER BY em.sal * 12 DESC;
-- 4、列出受雇日期早于其直接上级的所有员工的编号、姓名、部门名称、部门位置、部门人数。
SELECT e.empno, e.ename, d.dname, d.loc, temp.部门人数
  FROM emp e,
       emp em,
       dept d,
       (SELECT deptno, COUNT(empno) 部门人数 FROM emp GROUP BY deptno) temp
 WHERE e.mgr = em.empno
   AND e.deptno = d.deptno
   AND e.hiredate < em.hiredate;

-- 5、列出部门名称和这些部门的员工信息（数量、平均工资），同时列出那些没有员工的部门。
SELECT d.dname, temp.部门人数, temp.部门平均工资
  FROM (SELECT deptno, COUNT(empno) 部门人数, AVG(sal) 部门平均工资
          FROM emp
         GROUP BY deptno) temp,
       dept d
 WHERE temp.deptno(+) = d.deptno;

-- 6、列出所有“CLERK”（办事员）的姓名及其部门名称，部门的人数，工资等级。
SELECT e.ename, d.dname, temp.人数, s.grade
  FROM emp e,
       (SELECT deptno, COUNT(deptno) 人数 FROM emp GROUP BY deptno) temp,
       dept d,
       salgrade s
 WHERE e.job = 'CLERK'
   AND e.deptno = d.deptno
   AND e.deptno = temp.deptno
   AND e.sal BETWEEN s.losal AND s.hisal;
-- 7、列出最低薪金大于1500的各种工作及从事此工作的全部雇员人数及所在部门名称、位置、平均工资。
SELECT e.job, t.人数, d.dname, d.loc, temp.平均工资
FROM (SELECT deptno, AVG(sal) 平均工资 FROM emp GROUP BY deptno) temp,
            dept d,
            emp e,
            (SELECT job, COUNT(empno) 人数
               FROM emp
              GROUP BY job
             HAVING MIN(sal) > 1500) t
 WHERE e.deptno = d.deptno
   AND t.job = e.job
   AND e.deptno = temp.deptno;


-- 8、列出在部门“SALES”（销售部）工作的员工姓名、基本工资、雇佣日期、部门名称、假定不知道销售部的部门编号。
SELECT e.ename, e.sal, e.hiredate, d.dname
  FROM emp e NATURAL
  JOIN dept d
 WHERE d.dname = 'SALES';
-- 9、列出薪金高于公司平均薪金的所有员工，所在部门，上级领导，公司的工资等级。
SELECT e.ename, e.deptno, e.mgr, s.grade
FROM emp e, salgrade s
WHERE e.sal BETWEEN s.losal AND s.hisal
AND  e.sal > (SELECT AVG(sal) FROM emp);
-- 10、列出与“SCOTT”从事相同工作的所有员工及部门名称，部门人数。
SELECT e.*, d.dname, temp.人数
FROM (SELECT deptno, COUNT(empno) 人数 FROM emp GROUP BY deptno) temp,
     dept d,
     emp e
WHERE e.job = (SELECT job FROM emp WHERE ename = 'SCOTT')
AND e.deptno = d.deptno
AND e.deptno = temp.deptno;
-- 11、列出公司各个工资等级雇员的数量、平均工资。
SELECT * FROM emp;
SELECT e.empno, e.ename, e.sal, temp.平均工资
  FROM emp e,
       (SELECT deptno, AVG(sal) 平均工资 FROM  emp GROUP BY deptno) temp
 WHERE e.deptno = temp.deptno
   AND sal > 平均工资;
-- 12、列出薪金高于在部门30工作的所有员工的薪金的员工姓名和薪金、部门名称。

-- 13、列出在每个部门工作的员工数量、平均工资和平均服务期限。
SELECT COUNT(empno), AVG(sal),AVG(SYSDATE - hiredate)
  FROM emp
  GROUP BY deptno;
-- 14、列出所有员工的姓名、部门名称和工资。
SELECT e.ename, d.dname, e.sal
  FROM emp e,
       dept d
  WHERE e.deptno = d.deptno;
-- 15、列出所有部门的详细信息和部门人数。
SELECT d.deptno,
       d.dname,
       d.loc,
       COUNT(e.empno)
  FROM emp e,
       dept d
 WHERE e.deptno(+) = d.deptno
 GROUP BY d.deptno, d.dname, d.loc;
-- 16、列出各种工作的最低工资及从事此工作的雇员姓名。
SELECT temp.最低工资, e.ename
  FROM emp e, (SELECT job, MIN(sal) 最低工资 FROM emp GROUP BY job) temp
 WHERE e.job = temp.job
   AND e.sal = temp.最低工资;

-- 17、列出各个部门的MANAGER（经理）的最低薪金、姓名、部门名称、部门人数
SELECT e.ename, temp.最低薪金, d.dname, temp.人数
FROM (SELECT deptno, MIN(sal)最低薪金, COUNT(empno)人数  FROM emp WHERE job = 'MANAGER' GROUP BY deptno) temp,
     emp e,
     dept d
WHERE  e.deptno = d.deptno
AND  e.job = 'MANAGER'
AND   e.sal = temp.最低薪金

-- 18、列出所有员工的年工资，所在部门名称，按年薪从低到高排序。
SELECT temp.年薪, d.dname
 FROM (SELECT ename , sal , deptno,
       CASE  WHEN comm > 0 THEN (sal + comm) * 12
       ELSE sal * 12 END "年薪"
       FROM emp) temp,
       dept d
 WHERE temp.deptno = d.deptno
 ORDER BY 年薪;
-- 19、查出某个员工的上级主管及所在部门名称，并要求出这些主管中的薪水超过3000。
SELECT e.ename, em.ename, d.dname
FROM emp e, emp em, dept d
WHERE e.mgr = em.empno
AND em.deptno = d.deptno
AND em.sal > 3000;
-- 20、求出部门名称中，带‘S’字符的部门员工的工资合计、部门人数。
SELECT d.deptno, SUM(e.sal), COUNT(e.deptno)
  FROM dept d,
       emp e
 WHERE d.deptno = e.deptno(+)
   AND d.dname LIKE '%S%'
  GROUP BY d.deptno;
-- 21、给任职日期超过30年或者在87年雇佣的雇员加薪，加薪原则：10部门增长10%，20部门增长20%，30部门增长30%，依次类推。
UPDATE emp SET 
sal =(1+deptno/100)*sal 
WHERE months_between(SYSDATE,hiredate)/12>30 OR to_char(hiredate,'yyyy')=1987;
SELECT * FROM emp; 
