# Input File
$REI_VLANS = Import-CSV C:\Scripts\REI_VLANS.csv

# Parse the input file and add the virtual port groups accordingly
ForEach ($VLAN in $REI_VLANS) {
    $MyCluster = $VLAN.Cluster
    $MyvSwitch = $VLAN.vSwitch
    $MyVLANname = $VLAN.VLANname
    $MyVLANid = $VLAN.VLanId

    # Query the cluster to retrieve the hosts
    $MyVMHosts = Get-Cluster $MyCluster | Get-VMHost | sort Name | % {$_.Name}
    
    # Loop through the hosts and add the virtual port group to our vswitch based on the input 
    ForEach ($VMHost in $MyVMHosts) {
        Get-VirtualSwitch -VMHost $VMHost -Name $MyvSwitch | New-VirtualPortgroup -Name $MyVLANname -VlanId $MyVLANid 
    }


}