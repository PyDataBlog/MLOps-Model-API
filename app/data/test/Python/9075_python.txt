# binary tag: refers to tags that have open and close element
#   eg: [a]some content[/a]
# standalone tag: refers to tags that are self contained
#   eg: [b some content]

# Assuming that the text input is well formatted
# open input and output file
with open('textin.txt', 'r') as f1, open('textout.txt', 'w') as f2:
  lines = f1.readlines()
  # keep track of all binary tags (i.e. closeable tag)
  closeables = set()
  for line in lines:
    if line.startswith('[/'): # closing tag
      tag = line[2:].split(']')[0] #
      closeables.add(tag) # add to set
  
  # each line updates its position = prev position + directive
  # and give a new directive to the next line (1 for indent)
  # we start at 0, we use 3 blank spaces for indent
  position = 0; indent = '   '; directive = 0
  for line in lines:
    if line.startswith('[/'): # we are closing
      position -= 1 # since we are closing, unindent immediately
      position = position + directive
      directive = 0 # done
      f2.write(indent*position+line)
    elif line.startswith('['):
      # get the tag
      tag = line[1:].split(']',1)[0].split(' ',1)[0]
      if tag in closeables: # tag is binary
        position = position + directive
        directive = 1 # indent next line
      else: # tag is standalone
        position = position + directive
        directive = 0 # done
      f2.write(indent*position+line)
    else:
      # we don't touch lines in between
      f2.write(line)

