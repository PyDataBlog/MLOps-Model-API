Imports MySql

Public Class Register
    Inherits System.Web.UI.Page

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load

    End Sub

    Protected Sub CreateUser_CreatingUser(sender As Object, e As LoginCancelEventArgs) Handles CreateUser.CreatingUser
        Dim myConnectionString As String

        myConnectionString = "server=localhost;" _
              & "uid=root;" _
              & "pwd=;" _
              & "database=crmdb;"
        Try
            Dim conn As New MySql.Data.MySqlClient.MySqlConnection
            Dim cmd As New MySql.Data.MySqlClient.MySqlCommand
            Dim reader As MySql.Data.MySqlClient.MySqlDataReader

            conn.ConnectionString = myConnectionString
            conn.Open()
            ' Label1.Text = conn.State
            cmd.Connection = conn
            cmd.CommandText = "SELECT user_name FROM users where user_name='" & CreateUser.UserName & "';"
            reader = cmd.ExecuteReader

            If reader.HasRows = True Then
                While reader.Read()
                    lblAgent.Text = "Agent found " & reader(0).ToString
                End While
            Else
                lblAgent.Text = "Agent not found in SugarCRM"
                e.Cancel = True
            End If
            conn.Close()
        Catch ex As MySql.Data.MySqlClient.MySqlException

        End Try

    End Sub

    Protected Sub CreateUser_CreatedUser(sender As Object, e As EventArgs) Handles CreateUser.CreatedUser

    End Sub
End Class