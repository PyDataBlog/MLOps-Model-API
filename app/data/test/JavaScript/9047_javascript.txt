'use strict';

/**
 * Created by zhaoxueyong on 2017/1/14.
 */
angular.module('browserApp').
  controller('ColuslifeCtrl', function ($scope, $http) {
    $scope.countryName = "China";
    var mapObj = null;
    $scope.init_map = function(){
      console.log("init map now");
      mapObj = new AMap.Map("mapbody", {
        level: 7,
        building: false,
        point: false
      });
      var marker = new AMap.Marker({
        position: new AMap.LngLat(120.58, 31.335),
        title: 'SuZhouLeYuan'
      });
      marker.setMap(mapObj);
    };

    $('#btnLocation').on("click", function(){
      var locations = null;
      if (null === locations){
        $http({
          method: 'GET',
          url: 'http://127.0.0.1:8000/coluslife/locations',
          timeout: 5
        }).then(
          function successCallback(response){
            console.log(response.data);
            locations = response.data;
            for (var i = 0; i < locations.length; i++){
              var loc = locations[i];
              placeMarker(loc);
            }
          },
          function errorCallback(error){
            console.error(error);
          });
      }
    });

    var placeMarker = function(location){
      var marker = new AMap.Marker({
        position: new AMap.LngLat(location.fields.gislng, location.fields.gislat),
        title: location.fields.name
      });
      marker.setMap(mapObj);
    }
  });
